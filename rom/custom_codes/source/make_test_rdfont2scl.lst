 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 1 - 1/16/2012 18:32:51


       1/       0 :                     
       2/       0 :                     ;LAST UPDATE: 12.01.2012 savelij
       3/       0 :                     
       4/       0 :                     		include ../../macros.a80
(1)    1/       0 :                     
(1)    2/       0 :                     		RELAXED ON
(1)    3/       0 :                     		CPU Z80UNDOC
(1)    4/       0 :                     
(1)    5/       0 :                     DZ		MACRO DEFZ
(1)    6/       0 :                     		DB DEFZ,0
(1)    7/       0 :                     		ENDM 
(1)    8/       0 :                     
(1)    9/       0 :                     DC		MACRO DEFC
(1)   10/       0 :                     		IF STRLEN(DEFC)>1
(1)   11/       0 :                     		DB SUBSTR(DEFC,0,STRLEN(DEFC)-1)
(1)   12/       0 :                     		ENDIF
(1)   13/       0 :                     		IF STRLEN(DEFC)>0
(1)   14/       0 :                     		DB CHARFROMSTR(DEFC,STRLEN(DEFC)-1)|80H
(1)   15/       0 :                     		ENDIF
(1)   16/       0 :                     		ENDM
(1)   17/       0 :                     
(1)   18/       0 :                     SUM_HOB		MACRO STR,AA,BB,CC
(1)   19/       0 :                     		DB STR
(1)   20/       0 :                     		DW AA
(1)   21/       0 :                     		DW BB
(1)   22/       0 :                     		DB 0
(1)   23/       0 :                     		DB CC
(1)   24/       0 :                     $$I := 0
(1)   25/       0 :                     $$S := 0
(1)   26/       0 :                     		REPT 9
(1)   27/       0 :                     $$N := CHARFROMSTR (STR,STRLEN(STR)+$$S-9)
(1)   28/       0 :                     $$I := ($$I+$$S+$$N+($$N*256))&0XFFFF
(1)   29/       0 :                     $$S := $$S+1
(1)   30/       0 :                     		ENDM
(1)   31/       0 :                     $$I := ($$I+$$S+LOW (AA)+(LOW (AA)*0X100))&0XFFFF
(1)   32/       0 :                     $$S := $$S+1
(1)   33/       0 :                     $$I := ($$I+$$S+HIGH (AA)+(HIGH (AA)*0X100))&0XFFFF
(1)   34/       0 :                     $$S := $$S+1
(1)   35/       0 :                     $$I := ($$I+$$S+LOW (BB)+(LOW (BB)*0X100))&0XFFFF
(1)   36/       0 :                     $$S := $$S+1
(1)   37/       0 :                     $$I := ($$I+$$S+HIGH (BB)+(HIGH (BB)*0X100))&0XFFFF
(1)   38/       0 :                     $$S := $$S+1
(1)   39/       0 :                     $$I := ($$I+$$S+LOW (CC)+(LOW (CC)*0X100))&0XFFFF
(1)   40/       0 :                     $$S := $$S+1
(1)   41/       0 :                     $$I := ($$I+$$S+HIGH (CC)+(HIGH (CC)*0X100))&0XFFFF
(1)   42/       0 :                     $$S := $$S+1
(1)   43/       0 :                     		DW $$I
(1)   44/       0 :                     		ENDM
(1)   45/       0 :                     
(1)   46/       0 :                     DUPL		MACRO LEN,FILL
(1)   47/       0 :                     DUPL:
(1)   48/       0 :                     $$N		EQU (LEN) / 1024
(1)   49/       0 :                     $$M		EQU (LEN) # 1024
(1)   50/       0 :                     		REPT $$N
(1)   51/       0 :                     		DB 1024 DUP(FILL)
(1)   52/       0 :                     		ENDM
(1)   53/       0 :                     		IF $$M <> 0
(1)   54/       0 :                     		DB $$M DUP(FILL)
(1)   55/       0 :                     		ENDIF
(1)   56/       0 :                     		ENDM
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80(../../macros.a80) - page 2 - 1/16/2012 18:32:51


(1)   57/       0 :                     
(1)   58/       0 :                     HIGH		FUNCTION X,((X >> 8) & 0XFF)
(1)   59/       0 :                     LOW		FUNCTION X,(X & 0XFF)
(1)   60/       0 :                     
       5/       0 :                     
       6/       0 : =6000H              ADR_LOADING	EQU 0X6000
       7/       0 : =6000H              START_CODE	EQU ADR_LOADING
       8/       0 :                     
       9/    5EE9 :                     		ORG START_CODE-0X117
      10/    5EE9 :                     ;‡€ƒŽ‹Ž‚ŽŠ SCL ”€‰‹€
      11/    5EE9 : 53 49 4E 43 4C 41   START_SCL	DB "SINCLAIR",1,"tstrdfntB"
                    49 52 01 74 73 74 
                    72 64 66 6E 74 42 
      12/    5EFB : 35 00 35 00         		DW BASIC_FULL,BASIC_FULL
      13/    5EFF : 08                  		DB SIZE_SECTORS+1
      14/    5F00 :                     
      15/    5F00 :                     		include basic4monoloader.a80
(1)    1/    5F00 :                     
(1)    2/    5F00 :                     ;BASIC BLOCK FOR MONOLOADER
(1)    3/    5F00 :                     
(1)    4/    5F00 : 00 01 30 00         BASIC_START	DW 0X100,BASIC_END-STROKA1
(1)    5/    5F04 : E7 C3 A7 3A         STROKA1		DB 0XE7,0XC3,0XA7,0X3A			;BORDER NOT PI:
(1)    6/    5F08 : D9 C3 A7 3A         		DB 0XD9,0XC3,0XA7,0X3A			;INK NOT PI:
(1)    7/    5F0C : DA C3 A7 3A         		DB 0XDA,0XC3,0XA7,0X3A			;PAPER NOT INK:
(1)    8/    5F10 : FD B0 22 32 34 35   		DB 0XFD,0XB0,0X22,"24575",0X22,0X3A	;CLEAR VAL "ADDRESS":
                    37 35 22 3A 
(1)    9/    5F1A : F9 C0 B0 22 32 33   		DB 0XF9,0XC0,0XB0,0X22,"23905",0X22	;RANDOMIZE USR VAL "ADDRESS"
                    39 30 35 22 
(1)   10/    5F24 : 3A EA               		DB 0X3A,0XEA
(1)   11/    5F26 :                     
(1)   12/    5F26 : ED 5B F4 5C         		LD DE,(0X5CF4)
(1)   13/    5F2A : 01 05 07            		LD BC,SIZE_SECTORS*256+5
(1)   14/    5F2D : 21 00 60            		LD HL,ADR_LOADING
(1)   15/    5F30 : E5                  		PUSH HL
(1)   16/    5F31 : C3 13 3D            		JP 0X3D13
(1)   17/    5F34 :                     
(1)   18/    5F34 : 0D 80 AA            BASIC_END	DB 0X0D,0X80,0XAA
(1)   19/    5F37 : 01 00               		DW 1					;ŽŒ… ‘’ŽŠˆ ‡€“‘Š€
(1)   20/    5F39 :                     
(1)   21/    5F39 : =35H                BASIC_FULL	EQU BASIC_END-BASIC_START+1
(1)   22/    5F39 :                     
(1)   23/    5F39 : (MACRO)             		DUPL 0X100-BASIC_FULL-4,0		;„ŽŽ‹…ˆ… „Ž ‘…Š’Ž€ 256 €‰’
(1)   23/    5F39 :                     DUPL:
(1)   23/    5F39 : =0H                 $$N             EQU (0X100-BASIC_FULL-4) / 1024
(1)   23/    5F39 : =C7H                $$M             EQU (0X100-BASIC_FULL-4) # 1024
(1)   23/    5F39 :                                     REPT $$N
(1)   23/    5F39 :                                     DB 1024 DUP(0)
(1)   23/    5F39 :                                     ENDM
(1)   23/    5F39 : =>TRUE                              IF $$M <> 0
(1)   23/    5F39 : 00 00 00 00 00 00                   DB $$M DUP(0)
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80(basic4monoloader.a80) - page 3 - 1/16/2012 18:32:51


                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 
(1)   23/    6000 : [23]                                ENDIF
(1)   24/    6000 :                     	
(1)   25/    6000 :                     	
      16/    6000 :                     END_HEADER
      17/    6000 :                     
      18/    6000 : F3                  START_COD	DI
      19/    6001 : 21 00 60            		LD HL,START_CODE
      20/    6004 : E5                  		PUSH HL
      21/    6005 : 21 22 60            		LD HL,START_UNPACK
      22/    6008 : 11 00 5B            		LD DE,0X5B00
      23/    600B : 01 6E 00            		LD BC,END_UNPACK-START_UNPACK
      24/    600E : D5                  		PUSH DE
      25/    600F : ED B0               		LDIR
      26/    6011 : 21 B9 66            		LD HL,END_COD-1
      27/    6014 : 11 FF FF            		LD DE,0XFFFF
      28/    6017 : 01 2A 06            		LD BC,END_COD-END_UNPACK
      29/    601A : ED B8               		LDDR
      30/    601C : 21 00 60            		LD HL,START_CODE
      31/    601F : EB                  		EX DE,HL
      32/    6020 : 23                  		INC HL
      33/    6021 : C9                  		RET
      34/    6022 :                     		
      35/    6022 :                     START_UNPACK	include ../../dec40.a80
(1)    1/    6022 :                     ;Z80 depacker for megalz V4 packed files   (C) fyrex^mhm
(1)    2/    6022 :                     
(1)    3/    6022 :                     ; DESCRIPTION:
(1)    4/    6022 :                     ;
(1)    5/    6022 :                     ; Depacker is fully relocatable, not self-modifying,
(1)    6/    6022 :                     ;it's length is 110 bytes starting from DEC40.
(1)    7/    6022 :                     ;Register usage: AF,AF',BC,DE,HL. Must be CALL'ed, return is done by RET.
(1)    8/    6022 :                     ;Provide extra stack location for store 2 bytes (1 word). Depacker does not
(1)    9/    6022 :                     ;disable or enable interrupts, as well as could be interrupted at any time
(1)   10/    6022 :                     ;(no f*cking wicked stack usage :).
(1)   11/    6022 :                     
(1)   12/    6022 :                     ; USAGE:
(1)   13/    6022 :                     ;
(1)   14/    6022 :                     ; - put depacker anywhere you want,
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80(../../dec40.a80) - page 4 - 1/16/2012 18:32:51


(1)   15/    6022 :                     ; - put starting address of packed block in HL,
(1)   16/    6022 :                     ; - put location where you want data to be depacked in DE,
(1)   17/    6022 :                     ;   (much like LDIR command, but without BC)
(1)   18/    6022 :                     ; - make CALL to depacker (DEC40).
(1)   19/    6022 :                     ; - enjoy! ;)
(1)   20/    6022 :                     
(1)   21/    6022 :                     ; PRECAUTIONS:
(1)   22/    6022 :                     ;
(1)   23/    6022 :                     ; Be very careful if packed and depacked blocks coincide somewhere in memory.
(1)   24/    6022 :                     ;Here are some advices:
(1)   25/    6022 :                     ;
(1)   26/    6022 :                     ; 1. put packed block to the highest addresses possible.
(1)   27/    6022 :                     ;     Best if last byte of packed block has address #FFFF.
(1)   28/    6022 :                     ;
(1)   29/    6022 :                     ; 2. Leave some gap between ends of packed and depacked block.
(1)   30/    6022 :                     ;     For example, last byte of depacked block at #FF00,
(1)   31/    6022 :                     ;     last byte of packed block at #FFFF.
(1)   32/    6022 :                     ;
(1)   33/    6022 :                     ; 3. Place nonpackable data to the end of block.
(1)   34/    6022 :                     ;
(1)   35/    6022 :                     ; 4. Always check whether depacking occurs OK and neither corrupts depacked data
(1)   36/    6022 :                     ;     nor hangs computer.
(1)   37/    6022 :                     ;
(1)   38/    6022 :                     
(1)   39/    6022 :                     DEC40
(1)   40/    6022 : 3E 80                       LD      A,0X80
(1)   41/    6024 : 08                          EX      AF,AF'
(1)   42/    6025 : ED A0               MS      LDI
(1)   43/    6027 : 01 FF 02            M0      LD      BC,0X2FF
(1)   44/    602A : 08                  M1      EX      AF,AF'
(1)   45/    602B : 87                  M1X     ADD     A,A
(1)   46/    602C : 20 03                       JR      NZ,M2
(1)   47/    602E : 7E                          LD      A,(HL)
(1)   48/    602F : 23                          INC     HL
(1)   49/    6030 : 17                          RLA
(1)   50/    6031 : CB 11               M2      RL      C
(1)   51/    6033 : 30 F6                       JR      NC,M1X
(1)   52/    6035 : 08                          EX      AF,AF'
(1)   53/    6036 : 10 0F                       DJNZ    X2
(1)   54/    6038 : 3E 02                       LD      A,2
(1)   55/    603A : CB 29                       SRA     C
(1)   56/    603C : 38 18                       JR      C,N1
(1)   57/    603E : 3C                          INC     A
(1)   58/    603F : 0C                          INC     C
(1)   59/    6040 : 28 0F                       JR      Z,N2
(1)   60/    6042 : 01 3F 03                    LD      BC,0X33F
(1)   61/    6045 : 18 E3                       JR      M1
(1)   62/    6047 :                     
(1)   63/    6047 : 10 25               X2      DJNZ    X3
(1)   64/    6049 : CB 39                       SRL     C
(1)   65/    604B : 38 D8                       JR      C,MS
(1)   66/    604D : 04                          INC     B
(1)   67/    604E : 18 DA                       JR      M1
(1)   68/    6050 :                     X6
(1)   69/    6050 : 81                          ADD     A,C
(1)   70/    6051 :                     N2
(1)   71/    6051 : 01 FF 04                    LD      BC,0X4FF
(1)   72/    6054 : 18 D4                       JR      M1
(1)   73/    6056 :                     N1
(1)   74/    6056 : 0C                          INC     C
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80(../../dec40.a80) - page 5 - 1/16/2012 18:32:51


(1)   75/    6057 : 20 28                       JR      NZ,M4
(1)   76/    6059 : 08                          EX      AF,AF'
(1)   77/    605A : 04                          INC     B
(1)   78/    605B : CB 19               N5      RR      C
(1)   79/    605D : D8                          RET     C
(1)   80/    605E : CB 10                       RL      B
(1)   81/    6060 : 87                          ADD     A,A
(1)   82/    6061 : 20 03                       JR      NZ,N6
(1)   83/    6063 : 7E                          LD      A,(HL)
(1)   84/    6064 : 23                          INC     HL
(1)   85/    6065 : 17                          RLA
(1)   86/    6066 : 30 F3               N6      JR      NC,N5
(1)   87/    6068 : 08                          EX      AF,AF'
(1)   88/    6069 : 80                          ADD     A,B
(1)   89/    606A : 06 06                       LD      B,6
(1)   90/    606C : 18 BC                       JR      M1
(1)   91/    606E :                     X3
(1)   92/    606E : 10 04                       DJNZ    X4
(1)   93/    6070 : 3E 01                       LD      A,1
(1)   94/    6072 : 18 0F                       JR      M3
(1)   95/    6074 : 10 08               X4      DJNZ    X5
(1)   96/    6076 : 0C                          INC     C
(1)   97/    6077 : 20 08                       JR      NZ,M4
(1)   98/    6079 : 01 1F 05                    LD      BC,0X51F
(1)   99/    607C : 18 AC                       JR      M1
(1)  100/    607E :                     X5
(1)  101/    607E : 10 D0                       DJNZ    X6
(1)  102/    6080 : 41                          LD      B,C
(1)  103/    6081 : 4E                  M4      LD      C,(HL)
(1)  104/    6082 : 23                          INC     HL
(1)  105/    6083 : 05                  M3      DEC     B
(1)  106/    6084 : E5                          PUSH    HL
(1)  107/    6085 : 69                          LD      L,C
(1)  108/    6086 : 60                          LD      H,B
(1)  109/    6087 : 19                          ADD     HL,DE
(1)  110/    6088 : 4F                          LD      C,A
(1)  111/    6089 : 06 00                       LD      B,0
(1)  112/    608B : ED B0                       LDIR
(1)  113/    608D : E1                          POP     HL
(1)  114/    608E : 18 97                       JR      M0
(1)  115/    6090 :                     END_DEC40
(1)  116/    6090 :                     
      36/    6090 :                     END_UNPACK
      37/    6090 :                     		BINCLUDE test_rdfont_pack.rom
      38/    66BA :                     END_COD
      39/    66BA :                     
      40/    66BA : (MACRO)             		DUPL 0XFF-LOW ($)+1,0
      40/    66BA :                     DUPL:
      40/    66BA : =0H                 $$N             EQU (0XFF-LOW ($)+1) / 1024
      40/    66BA : =46H                $$M             EQU (0XFF-LOW ($)+1) # 1024
      40/    66BA :                                     REPT $$N
      40/    66BA :                                     DB 1024 DUP(0)
      40/    66BA :                                     ENDM
      40/    66BA : =>TRUE                              IF $$M <> 0
      40/    66BA : 00 00 00 00 00 00                   DB $$M DUP(0)
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 6 - 1/16/2012 18:32:51


                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 
      40/    6700 : [40]                                ENDIF
      41/    6700 :                     
      42/    6700 : =>TRUE              		IF (END_COD-START_COD)&0XFF
      43/    6700 : =7H                 SIZE_SECTORS	EQU ((END_COD-START_COD)>>8)+1
      44/    6700 : =>FALSE             		ELSE
      45/    6700 :                     SIZE_SECTORS	EQU ((END_COD-START_COD)>>8)
      46/    6700 : [42]                		ENDIF
      47/    6700 :                     
 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 7 - 1/16/2012 18:32:51


  symbol table (* = unused):
  ------------------------

 ADR_LOADING :                 6000 - | *ARCHITECTURE :  i386-unknown-win32 - |
 BASIC_END :                   5F34 C |  BASIC_FULL :                    35 - |
 BASIC_START :                 5F00 C | *BIGENDIAN :                      0 - |
*BRANCHEXT :                      0 - | *CASESENSITIVE :                  1 - |
*CONSTPI :        3.141592653589793 - | *DATE :                   1/16/2012 - |
*DEC40 :                       6022 C |  END_COD :                     66BA C |
*END_DEC40 :                   6090 C | *END_HEADER :                  6000 C |
 END_UNPACK :                  6090 C | *FALSE :                          0 - |
*FULLPMMU :                       1 - | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
*LISTON :                         1 - |  M0 :                          6027 C |
 M1 :                          602A C |  M13 :                           C7 - |
 M1X :                         602B C |  M2 :                          6031 C |
 M3 :                          6083 C |  M37 :                           46 - |
 M4 :                          6081 C | *MACEXP :                         1 - |
*MOMCPU :                      80DC - | *MOMCPUNAME :              Z80UNDOC - |
 MS :                          6025 C |  N1 :                          6056 C |
 N13 :                            0 - |  N2 :                          6051 C |
 N37 :                            0 - |  N5 :                          605B C |
 N6 :                          6066 C | *NESTMAX :                      100 - |
*PACKING :                        0 - | *PADDING :                        1 - |
*RELAXED :                        1 - |  SIZE_SECTORS :                   7 - |
 START_COD :                   6000 C |  START_CODE :                  6000 - |
*START_SCL :                   5EE9 C |  START_UNPACK :                6022 C |
 STROKA1 :                     5F04 C | *TIME :                    18:32:51 - |
*TRUE :                           1 - | *VERSION :                     142F - |
 X2 :                          6047 C |  X3 :                          606E C |
 X4 :                          6074 C |  X5 :                          607E C |
 X6 :                          6050 C |

     63 symbols
     32 unused symbols

 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 8 - 1/16/2012 18:32:51


  defined macros:
  ---------------

DC                                    | DUPL                                 
DZ                                    | SUM_HOB                              

      4 macros

 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 9 - 1/16/2012 18:32:51


  defined functions:
  ------------------

LOW                                   | HIGH                                 

 AS V1.42 Beta [Bld 78] - source file make_test_rdfont2scl.a80 - page 10 - 1/16/2012 18:32:51


  codepages:
  ----------

STANDARD (0 changed characters)


0.11 seconds assembly time

    248 lines source file
    266 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
