UNK_5B00:	DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
UNK_5B08:	DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
UNK_5B5C:	DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
UNK_5BFF:	DS 1			; DATA XREF: ROM:3D73O
KSTATE0:	DS 1
KSTATE1:	DS 1			; DATA XREF: ROM:LOC_2A4BW ROM:2A7EW ...
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
REPDEL:		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
STRMS:		DS 1			; DATA XREF: ROM:00F0O	ROM:2698O
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
CHARS:		DS 1
		DS 1
RASP:		DS 1
		DS 1
ERR_NR:		DS 1			; DATA XREF: ROM:00A1O
					; NUMDSK2BYTE+17FEW ...
FLAGS:		DS 1			; DATA XREF: GET_PARAMS-1539O
					; ROM:END_COMO	...
TV_FLAG:	DS 1			; DATA XREF: ROM:25F2O
ERR_SP:		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
NEWPPC:		DS 1
		DS 1
NSPPS:		DS 1
PPC:		DS 1
		DS 1
		DS 1
BORDCR:		DS 1
		DS 1
		DS 1
VARS:		DS 1
		DS 1
		DS 1
		DS 1
CHANS:		DS 1
		DS 1
CURCHL:		DS 1
		DS 1
PROG:		DS 1
		DS 1
		DS 1
		DS 1
DATADD:		DS 1
		DS 1
E_LINE:		DS 1
		DS 1
K_CUR:		DS 1
		DS 1
CH_ADD:		DS 1
		DS 1
		DS 1
		DS 1
WORKSP:		DS 1
		DS 1
STKBOT:		DS 1
		DS 1
STKEND:		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
DF_SZ:		DS 1			; DATA XREF: ROM:0105O
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
UDG:		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
ATTR_P:		DS 1
		DS 1
ATTR_T:		DS 1
		DS 1
		DS 1
MEMBOT:		DS 1			; DATA XREF: CREATE_VARS+8O
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
RAMTOP:		DS 1
		DS 1
P_RAMT:		DS 2			; DATA XREF: ROM:3D79O
TRD_5CB6:	DS 1			; DATA XREF: ROM:00A5O	ROM:0266R ...
					;    INTERFACE1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
		DS 1
TRD_5CC2:	DS 1			; DATA XREF: ROM:00FDO	ROM:0167O ...
					;  #C9.   TR-DOS 	BASIC
TRD_5CC3:	DS 1			; DATA XREF: CP_INTERFACE1+15O
		DS 1
		DS 1
		DS 1
		DS 1
TRD_5CC8:	DS 1			; DATA XREF: ROM:2F99W	GET_TYPE_DSKO
					; 	  A
TRD_5CC9:	DS 1			; 	  B
TRD_5CCA:	DS 1			; 	  C
TRD_5CCB:	DS 1			; 	  D
TRD_5CCC:	DS 1			; DATA XREF: RD_0SEC2BUF+1W
					; READ_NUM_SECR ...
					;  		  
TRD_5CCD:	DS 1			; #80- 
TRD_5CCE:	DS 1			; #00- ,#FF-	
TRD_5CCF:	DS 2			;   WORK_SP
TRD_5CD1:	DS 1
TRD_5CD2:	DS 1
TRD_5CD3:	DS 1
TRD_5CD4:	DS 1
TRD_5CD5:	DS 1
TRD_5CD6:	DS 1			; DATA XREF: GET_PARAMS-153FW
					; INPUT_EXTFILENAME+2R	...
					; #FF-   
TRD_5CD7:	DS 1			; DATA XREF: ADD_FILESIZEW
					; MOVE_FILE+29R ...
TRD_5CD8:	DS 1
TRD_5CD9:	DS 1
TRD_5CDA:	DS 1			; DATA XREF: CP_FREESEC+AW
					; SETUP_DSK_DEST+5R ...
TRD_5CDB:	DS 1			; DATA XREF: ROM:0439W	ROM:0476R ...
TRD_5CDC:	DS 1
TRD_5CDD:	DS 1			; DATA XREF: GET_OVERWRITE_+11O
					; ROM:LOC_5CBR	...
					;  
		DS 1
TRD_5CDF:	DS 1
		DS 1
TRD_5CE1:	DS 1
		DS 1
TRD_5CE3:	DS 1
		DS 1
TRD_5CE5:	DS 1			; DATA XREF: CP_EXT_SHARPR ROM:06F9R ...
					;  
TRD_5CE6:	DS 2			; DATA XREF: ROM:0614O
					; COPY_FILE_ON2DSK+EO ...
					;  <C>- , <B>-	
TRD_5CE8:	DS 2			; 	
TRD_5CEA:	DS 1			; 	 	
TRD_5CEB:	DS 1			; 			
		DS 1
TRD_5CED:	DS 1			; DATA XREF: ROM:0617O
					; COPY_FILE_ON2DSK+BO ...
					; 		 
		DS 1			; 		 
TRD_5CEF:	DS 1			;  1   INTERFACE1
		DS 1
TRD_5CF1:	DS 1
TRD_5CF2:	DS 1
		DS 1
TRD_5CF4:	DS 1			; DATA XREF: COPY_FILE_ON2DSK+36R
					; COPY_FILE_ON2DSK+48W	...
TRD_5CF5:	DS 1			; DATA XREF: COM_05+43R COM_05+66O ...
TRD_5CF6:	DS 1			; DATA XREF: ROM:046DR	ROM:04BCR ...
TRD_5CF7:	DS 1
TRD_5CF8:	DS 1
TRD_5CF9:	DS 1
TRD_5CFA:	DS 1			; DATA XREF: ROM:2F93W	GET_TIME_HEADO
		DS 1
TRD_5CFC:	DS 1
		DS 1
TRD_5CFE:	DS 1
TRD_5CFF:	DS 1
TRD_5D00:	DS 1
		DS 1
TRD_5D02:	DS 1
		DS 1
TRD_5D04:	DS 1
		DS 1
TRD_5D06:	DS 1			;      
TRD_5D07:	DS 1			; DATA XREF: ERASE_FILE:CP_ERASED_FILESR
					; ERASE_FILE+1W ...
TRD_5D08:	DS 1
TRD_5D09:	DS 1
		DS 1
		DS 1
TRD_5D0C:	DS 1			; DATA XREF: CP_INTERFACE1+11R
					; CREATE_BUF+4O ...
TRD_5D0D:	DS 1
TRD_5D0E:	DS 1			; DATA XREF: GET_PARAMS-15FAW
					; PRINT_ERROR+1R ...
					; #FE- BASIC, TR-DOS
TRD_5D0F:	DS 1			; DATA XREF: GET_NUM_TRACK-3CB8R
					; ROM:0251W ...
					; 	 TR-DOS
TRD_5D10:	DS 1			;   
TRD_5D11:	DS 1
		DS 1
TRD_5D13:	DS 1			; 	ERR_SP
		DS 1
TRD_5D15:	DS 1			;  0, 	TR-DOS. 	
TRD_5D16:	DS 1			; DATA XREF: ROM:02D7R	ROM:02DFR ...
TRD_5D17:	DS 1			; DATA XREF: ROM:017DW
					; GET_NUM_TRACK-3CD3O ...
					;  ,  #AA
TRD_5D18	EQU #5D18
TRD_5D19	EQU #5D19
TRD_5D1A	EQU #5D1A		;    
TRD_5D1C	EQU #5D1C		;  SP
TRD_5D1E	EQU #5D1E
TRD_5D1F	EQU #5D1F
TRD_5D20	EQU #5D20		;  3   
TRD_5D21	EQU #5D21
TRD_5D23	EQU #5D23
TRD_5D25	EQU #5D25
TRD_5D26	EQU #5D26
TRD_5D33	EQU #5D33
TRD_5E06	EQU #5E06
TRD_5E07	EQU #5E07
TRD_5E08	EQU #5E08
TRD_5E09	EQU #5E09
TRD_5E0A	EQU #5E0A
TRD_5E0C	EQU #5E0C
TRD_5E0F	EQU #5E0F
TRD_5E10	EQU #5E10
TRD_5E19	EQU #5E19
TRD_5E1A	EQU #5E1A
TRD_5E34	EQU #5E34
TRD_5F00	EQU #5F00
WORD_5F10	EQU #5F10
BYTE_5F12	EQU #5F12

;
; +-------------------------------------------------------------------------+
; |   THIS FILE	HAS BEEN GENERATED BY THE INTERACTIVE DISASSEMBLER (IDA)    |
; |	   COPYRIGHT (C) 2009 BY HEX-RAYS, <SUPPORT@HEX-RAYS.COM>	    |
; |			 LICENSE INFO: CA-A47E-3386-12			    |
; |				 LICENSED USER				    |
; +-------------------------------------------------------------------------+
;
; INPUT	MD5   :	0DA70A5D2A0E733398E005B96B7E4BA6
; ---------------------------------------------------------------------------
; FILE NAME   :	Y:\SPECCY\UNREALSPECCY\TR5_03.ROM
; FORMAT      :	BINARY FILE
; BASE ADDRESS:	0000H RANGE: 0000H - 4000H LOADED LENGTH: 4000H
; PROCESSOR	  : Z80	[]
; TARGET ASSEMBLER: ZILOG MACRO	ASSEMBLER
; ===========================================================================
; SEGMENT TYPE:	PURE CODE
		SEGMENT	ROM
LOC_0:					; DATA XREF: COPY_SECTORS+94O
		DI
		LD	DE, 0FFFFH
		LD	A, 7
LOC_6:
		JR	LOC_9
; =============== S U B	R O U T	I N E =======================================
SUB_8:					; CODE XREF: ROM:LOC_3D44P
; FUNCTION CHUNK AT 0013 SIZE 00000005 BYTES
; FUNCTION CHUNK AT 001B SIZE 00000005 BYTES
; FUNCTION CHUNK AT 0024 SIZE 00000004 BYTES
; FUNCTION CHUNK AT 002B SIZE 00000008 BYTES
; FUNCTION CHUNK AT 003A SIZE 0000002C BYTES
; FUNCTION CHUNK AT 0069 SIZE 00000010 BYTES
		NOP
LOC_9:					; CODE XREF: ROM:LOC_6J
		OUT	(0FEH),	A
		LD	A, 3FH
		JR	LOC_13
; END OF FUNCTION SUB_8
; ---------------------------------------------------------------------------
		DB    0
; =============== S U B	R O U T	I N E =======================================
; ATTRIBUTES: THUNK
J_PRINT_A_:				; CODE XREF: ROM:04C1P	ROM:04CAP ...
		JP	PRINT_A_
; END OF FUNCTION J_PRINT_A_
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_13:					; CODE XREF: SUB_8+5J
		LD	I, A
		JP	LOC_1B
; END OF FUNCTION CHUNK	FOR SUB_8
; =============== S U B	R O U T	I N E =======================================
; ATTRIBUTES: THUNK
J_PRINT_MSG:				; CODE XREF: ROM:0262P	ROM:0270P ...
		JP	PRINT_MSG
; END OF FUNCTION J_PRINT_MSG
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_1B:					; CODE XREF: SUB_8+DJ
		NOP
		NOP
		NOP
		JR	LOC_24
; END OF FUNCTION CHUNK	FOR SUB_8
; =============== S U B	R O U T	I N E =======================================
; ATTRIBUTES: THUNK
J_RST_20:				; CODE XREF: ROM:0102P	ROM:014CP ...
		JP	CALL2BASIC
; END OF FUNCTION J_RST_20
; ---------------------------------------------------------------------------
		RET
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_24:					; CODE XREF: SUB_8+16J
		LD	H, D
		LD	L, E
		JR	LOC_2B
; END OF FUNCTION CHUNK	FOR SUB_8
; =============== S U B	R O U T	I N E =======================================
; ATTRIBUTES: THUNK
SUB_28:					; CODE XREF: INITFREEACCESS+3P
					; GET_ADRTEKSYM+2P ...
		JP	SUB_2323
; END OF FUNCTION SUB_28
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_2B:					; CODE XREF: SUB_8+1EJ	SUB_8+27J
		LD	(HL), 2
		DEC	HL
		CP	H
		JR	NZ, LOC_2B
		JR	LOC_3A
; END OF FUNCTION CHUNK	FOR SUB_8
; ---------------------------------------------------------------------------
		DB [ 5 ], 0FFH
; ---------------------------------------------------------------------------
		EI
		RET
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_3A:					; CODE XREF: SUB_8+29J	SUB_8+3DJ
		OR	A
		SBC	HL, DE
		ADD	HL, DE
		INC	HL
		JR	NC, LOC_47
		DEC	(HL)
		JR	Z, LOC_47
		DEC	(HL)
		JR	Z, LOC_3A
LOC_47:					; CODE XREF: SUB_8+37J	SUB_8+3AJ
		DEC	HL
LOC_48:
		LD	(P_RAMT), HL
		LD	DE, 3EAFH
		LD	BC, 0A8H
		LD	A, E
		EX	DE, HL
		LD	SP, 6000H
		LD	(TRD_5F00), HL
		LD	HL, LOC_79
		PUSH	HL
		LD	HL, LOC_3D2F
		PUSH	HL
		LD	HL, 0B8EDH
		JR	LOC_69
; END OF FUNCTION CHUNK	FOR SUB_8
; ---------------------------------------------------------------------------
		JP	MAGIC
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR SUB_8
LOC_69:					; CODE XREF: SUB_8+5CJ
		LD	(WORD_5F10), HL
		PUSH	AF
		LD	A, 0C9H
		LD	(BYTE_5F12), A
		POP	AF
		LD	HL, (TRD_5F00)
		JP	WORD_5F10
; END OF FUNCTION CHUNK	FOR SUB_8
; ---------------------------------------------------------------------------
LOC_79:					; DATA XREF: SUB_8+51O
		EX	DE, HL
		INC	HL
		LD	(UDG), HL
		DEC	HL
		LD	BC, 1E40H
		LD	(RASP),	BC
		LD	(RAMTOP), HL
		LD	HL, 3C00H
		LD	(CHARS), HL
		LD	HL, (RAMTOP)
		LD	(HL), 3EH
		DEC	HL
		LD	SP, HL
		DEC	HL
		DEC	HL
		LD	(ERR_SP), HL
		LD	DE, 1303H
		PUSH	DE
		IM	1
		LD	IY, ERR_NR
		LD	HL, TRD_5CB6	;    INTERFACE1
		LD	(CHANS), HL
		LD	DE, 15AFH
		LD	BC, 15H
		EX	DE, HL
		CALL	COPY_BAS2VARS
		EX	DE, HL
		DEC	HL
		LD	(DATADD), HL
		INC	HL
		LD	(PROG),	HL
		LD	(VARS),	HL
		LD	(HL), 80H
		INC	HL
		LD	(E_LINE), HL
		LD	(HL), 0DH
		INC	HL
		LD	(HL), 80H
		INC	HL
		LD	(WORKSP), HL
		LD	(STKBOT), HL
		LD	(STKEND), HL
		LD	A, 38H
		LD	(ATTR_P), A
		LD	(ATTR_T), A
		LD	(BORDCR), A
		LD	HL, 523H
		LD	(REPDEL), HL
		DEC	(IY+0C6H)
		DEC	(IY+0CAH)
		LD	HL, 15C6H
		LD	DE, STRMS
		LD	BC, 0EH
		CALL	COPY_BAS2VARS
		SET	1, (IY+1)
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		LD	(HL), 0C9H
		RST	20H
; ---------------------------------------------------------------------------
		DW 0EDFH		;   
; ---------------------------------------------------------------------------
		LD	HL, DF_SZ
		LD	(HL), 2
		LD	HL, 128BH
		PUSH	HL
		LD	A, 0AAH
		LD	(UNK_5B00), A
		EI
		JP	LOC_3D31
; =============== S U B	R O U T	I N E =======================================
COPY_BAS2VARS:				; CODE XREF: ROM:00B2P	ROM:00F6P
		LD	(TRD_5F00), HL
		LD	HL, LOC_3D2F
		PUSH	HL
		LD	HL, 0B0EDH
		LD	(WORD_5F10), HL
		LD	HL, (TRD_5F00)
		JP	WORD_5F10
; END OF FUNCTION COPY_BAS2VARS
; ---------------------------------------------------------------------------
LOC_12A:				; CODE XREF: ROM:1830J	ROM:1D5EJ
		CALL	DELETE_BUF
		CALL	CLEAR_SCREEN
		LD	HL, (E_LINE)
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		LD	A, D
		OR	E
		EX	DE, HL
		JR	Z, LOC_140
		XOR	A
		LD	(TRD_5D10), A	;   
LOC_140:				; CODE XREF: ROM:013AJ
		PUSH	HL
		CALL	RESTORE_SP
		POP	HL
		LD	(NEWPPC), HL
		XOR	A
		LD	(NSPPS), A
		RST	20H
; ---------------------------------------------------------------------------
		DW 16B0H		;     
; ---------------------------------------------------------------------------
		LD	HL, (PROG)
		DEC	HL
		LD	(DATADD), HL
		LD	SP, (ERR_SP)
		LD	A, (TRD_5D10)	;   
		OR	A
		LD	HL, 1B76H
		JR	Z, LOC_166
		RST	20H
; ---------------------------------------------------------------------------
		DW 1BB0H		;  "OK"
; ---------------------------------------------------------------------------
LOC_166:				; CODE XREF: ROM:0161J
		PUSH	HL
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		PUSH	HL
		RET
; ---------------------------------------------------------------------------
LOC_16C:				; CODE XREF: ROM:3D1EJ
		CALL	CP_INTERFACE1
		CALL	CREATE_BUF
		LD	A, 0FFH
		LD	(TRD_5D15), A	;  0, 	TR-DOS. 	
		XOR	A
		LD	(TRD_5CF7), A
		LD	A, 0AAH
		LD	(TRD_5D17), A	;  ,  #AA
		LD	HL, 201H
		LD	(TRD_5D1A), HL	;     
		LD	HL, 0
		ADD	HL, SP
		LD	(TRD_5D1C), HL	;   SP
		DEC	HL
		DEC	HL
		LD	SP, HL
		CALL	MARK_SP
		LD	HL, (RAMTOP)
		LD	DE, (CH_ADD)
		SBC	HL, DE
		EX	DE, HL
		JR	NC, LOC_1A5
		OR	A
		LD	DE, 101H
		SBC	HL, DE
LOC_1A5:				; CODE XREF: ROM:019DJ
		LD	(CH_ADD), HL
LOC_1A8:				; CODE XREF: ROM:01B1J
		CALL	CP_0D_OR_80
LOC_1AB:				; CODE XREF: ROM:01B6J
		JP	Z, END_COMAND
		CP	0EAH
		INC	HL
		JR	NZ, LOC_1A8
		CALL	CP_0D_OR_80
		JR	Z, LOC_1AB
		CP	3AH
		JP	NZ, END_COMAND
		INC	HL
		CALL	PACK_COMSTR
		LD	HL, (TRD_5D11)
		JP	LOC_30A
; =============== S U B	R O U T	I N E =======================================
CP_0D_OR_80:				; CODE XREF: ROM:LOC_1A8P ROM:01B3P
		LD	A, (HL)
		CP	0DH
		RET	Z
		CP	80H
		RET	Z
		OR	A
		RET
; END OF FUNCTION CP_0D_OR_80
; ---------------------------------------------------------------------------
		CALL	REWRITE_9SEC
; START	OF FUNCTION CHUNK FOR GET_NUM_TRACK
END_COMAND:				; CODE XREF: ROM:LOC_1ABJ ROM:01BAJ ...
		LD	HL, 0
		LD	(TRD_5CF8), HL
		CALL	DELETE_BUF
		CALL	CLEAR_WORKSPACE
		LD	HL, TRD_5D17	;  ,  #AA
		LD	(HL), 0AAH
		LD	HL, TRD_5D1F
		LD	A, (HL)
		OR	A
		LD	(HL), 0
		JR	NZ, LOC_1F3
		CALL	DEL_5BYTES
		CALL	FIND_ENDSTR
LOC_1F3:				; CODE XREF: GET_NUM_TRACK-3CC7J
		LD	SP, (TRD_5D1C)	;   SP
		LD	HL, (TRD_5D1A)	;     
		LD	BC, (TRD_5D0F)	; 	 TR-DOS
		LD	B, 0
		JP	(HL)
; END OF FUNCTION CHUNK	FOR GET_NUM_TRACK
; ---------------------------------------------------------------------------
CP_ERROR:				; DATA XREF: ROM:2852O
		CALL	RESTORE_SP
		BIT	7, (IY+0)
		RET	NZ
		LD	DE, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		LD	SP, (ERR_SP)
		PUSH	DE
		RET
; =============== S U B	R O U T	I N E =======================================
FIND_ENDSTR:				; CODE XREF: GET_NUM_TRACK-3CC2P
					; FIND_ENDSTR+9J
		CALL	GET_SYMSTR
		CP	0DH
		RET	Z
		CALL	PRINT_NEXT_SYM
		JR	FIND_ENDSTR
; END OF FUNCTION FIND_ENDSTR
; =============== S U B	R O U T	I N E =======================================
MARK_SP:				; CODE XREF: ROM:0190P	ROM:0246P ...
		LD	HL, (ERR_SP)
		LD	(TRD_5D13), HL	; 	ERR_SP
		LD	HL, (TRD_5D1C)	;   SP
		DEC	HL
		DEC	HL
		LD	(ERR_SP), HL
		LD	DE, LOC_3D16
		LD	(HL), E
		INC	HL
		LD	(HL), D
		RET
; END OF FUNCTION MARK_SP
; =============== S U B	R O U T	I N E =======================================
RESTORE_SP:				; CODE XREF: ROM:0141P	ROM:CP_ERRORP ...
		LD	HL, (TRD_5D13)	; 	ERR_SP
		LD	(ERR_SP), HL
		RET
; END OF FUNCTION RESTORE_SP
; ---------------------------------------------------------------------------
IN_COMMAND_CPU:				; CODE XREF: ROM:3D35J
		LD	HL, 0
		LD	(TRD_5CF7), HL
		ADD	HL, SP
		LD	(TRD_5D1C), HL	;   SP
		DEC	HL
		DEC	HL
		LD	SP, HL
		CALL	MARK_SP
		LD	HL, TRD_5D17	;  ,  #AA
		LD	A, (HL)
		CP	0AAH
		LD	A, 0
		LD	(TRD_5D0F), A	; 	 TR-DOS
		JP	Z, COMMAND_CPU
		LD	(HL), 0AAH
		CALL	CLEAR_SCREEN
		CALL	OPEN_CHAN_2
		LD	HL, ZASTAVKA
		RST	18H
		CALL	OUT_COLOR_LINE
		LD	A, (TRD_5CB6)	;    INTERFACE1
		CP	0F4H
		JR	Z, LOC_271
		LD	HL, BYTE_1000
		RST	18H
LOC_271:				; CODE XREF: ROM:026BJ
		LD	A, (UNK_5B00)
		CP	0AAH
		JR	NZ, COMMAND_CPU
		CALL	CP_INTERFACE1
; START	OF FUNCTION CHUNK FOR GET_PARAMS
LOC_27B:				; CODE XREF: GET_PARAMS+3J
		LD	HL, (E_LINE)
		LD	A, 0FEH
		LD	(TRD_5D0E), A	; #FE- BASIC, TR-DOS
		LD	(HL), 0F7H
		INC	HL
		LD	(HL), 22H
		INC	HL
		LD	(HL), 62H
		INC	HL
		LD	(HL), 6FH
		INC	HL
		LD	(HL), 6FH
		INC	HL
		LD	(HL), 74H
		INC	HL
		LD	(HL), 22H
		INC	HL
		LD	(K_CUR), HL
		LD	(HL), 0DH
		INC	HL
		LD	(HL), 80H
		INC	HL
		LD	(WORKSP), HL
		LD	(STKBOT), HL
		LD	(STKEND), HL
		SET	3, (IY+1)
		JR	LOC_2EF
; END OF FUNCTION CHUNK	FOR GET_PARAMS
; =============== S U B	R O U T	I N E =======================================
LDI3_HL2DE:				; CODE XREF: GET_PARAMS-1577P
					; RESTORE_COMSTR+7P
		LD	B, 3
LOC_2B2:				; CODE XREF: LDI3_HL2DE+6J
		LD	A, (HL)
		LD	(DE), A
		INC	HL
		INC	DE
		DJNZ	LOC_2B2
		RET
; END OF FUNCTION LDI3_HL2DE
; =============== S U B	R O U T	I N E =======================================
STOP_MOTOR:				; CODE XREF: ROM:02DCP	ROM:02E2P
		LD	B, 20H
LOC_2BB:				; CODE XREF: STOP_MOTOR+FJ
		PUSH	BC
		XOR	8
		OUT	(0FFH),	A
		PUSH	AF
		LD	A, 5
		CALL	PAUSE_C_A
		POP	AF
		POP	BC
		DJNZ	LOC_2BB
		RET
; END OF FUNCTION STOP_MOTOR
; ---------------------------------------------------------------------------
COMMAND_CPU:				; CODE XREF: ROM:0254J	ROM:0276J
					; DATA XREF: ...
		LD	HL, (TRD_5D1C)	;   SP
		DEC	HL
		DEC	HL
		LD	SP, HL
		CALL	CP_INTERFACE1
		CALL	OPEN_CHAN_0
		LD	A, (TRD_5D16)
		OR	3
		CALL	STOP_MOTOR
		LD	A, (TRD_5D16)
		CALL	STOP_MOTOR
		XOR	A
		LD	(TRD_5D15), A	;  0, 	TR-DOS. 	
		CALL	GET_COMMAND
		CALL	PACK_COM_STR
; START	OF FUNCTION CHUNK FOR GET_PARAMS
LOC_2EF:				; CODE XREF: GET_PARAMS-15CCJ
		CALL	CLEAR_DOWN_SCR
		LD	HL, COMMAND_CPU
		LD	(TRD_5D1A), HL	;     
		XOR	A
		LD	(TRD_5D0F), A	; 	 TR-DOS
		LD	HL, (E_LINE)
		PUSH	HL
		LD	DE, TRD_5D20	;   3   
		CALL	LDI3_HL2DE
		POP	HL
		LD	(TRD_5D11), HL
LOC_30A:				; CODE XREF: ROM:01C4J
		LD	A, (HL)
		LD	B, A
		AND	80H
		LD	A, B
		JR	Z, LOC_31A
		CP	0FEH
		JR	Z, LOC_31A
		PUSH	AF
		CALL	ACTIV_DEF_DSK
		POP	AF
LOC_31A:				; CODE XREF: GET_PARAMS-156BJ
					; GET_PARAMS-1567J
		LD	HL, CODE_BYTE_COM
		DEC	HL
		LD	C, 0
LOC_320:				; CODE XREF: GET_PARAMS-154FJ
		INC	C
		LD	D, A
		LD	A, 15H
		CP	C
		JP	C, END_COMAND
		LD	A, D
		INC	HL
		CP	(HL)
		JR	NZ, LOC_320
		CP	0FEH
		CALL	NZ, CREATE_BUF
		LD	A, 9
		LD	(TRD_5D06), A	;      
		XOR	A
		LD	(TRD_5D0F), A	; 	 TR-DOS
		LD	(TRD_5CD6), A	; #FF-   
		LD	(TRD_5D10), A	;   
		LD	HL, FLAGS
		RES	7, (HL)
		LD	B, 0
		LD	HL, SPIS_ADR_COM
		DEC	C
		SLA	C
		ADD	HL, BC
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		EX	DE, HL
		PUSH	HL
		LD	DE, END_COM
		PUSH	DE
		JP	(HL)
; END OF FUNCTION CHUNK	FOR GET_PARAMS
; ---------------------------------------------------------------------------
END_COM:				; DATA XREF: GET_PARAMS-1526O
		LD	HL, FLAGS
		SET	7, (HL)
		POP	HL
		JP	(HL)
; ---------------------------------------------------------------------------
ZASTAVKA:	DB 16H			; DATA XREF: ROM:025FO
		DB 1
		DB 5
		.ASCII '* TR-DOS VER 5.03 *'
		DB 0DH
		DB 0DH
		DB 7FH
		.ASCII ' 1986 TECHNOLOGY RESEARCH LTD.'
		DB 16H
		DB 5
		DB 0BH
		.ASCII '(U.K.)'
		DB 16H
		DB 7
		DB 5
		.ASCII 'BETA 128'
		DB 0
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR CP_END_DIR
END_OUT_DIR:				; CODE XREF: CP_END_DIR+2AD5J
		CALL	READ_9SEC
		CALL	PRINT_0D
		CALL	PRINT_0D
LOC_3B5:				; DATA XREF: ROM:LOC_2A41R
		LD	BC, (TRD_5E0A)
		CALL	PRINT_CHISLO
		LD	HL, TXT_FREE_
		RST	18H
; END OF FUNCTION CHUNK	FOR CP_END_DIR
; START	OF FUNCTION CHUNK FOR COM_18
GOTO_END:				; CODE XREF: COM_18+EJ
		JP	END_COMAND
; END OF FUNCTION CHUNK	FOR COM_18
; =============== S U B	R O U T	I N E =======================================
PRINT_ERROR:				; CODE XREF: GET_NUM_TRACK:PRINT_TXTERRP
					; COM_05:LOC_1D29P
		PUSH	AF
		LD	A, (TRD_5D0E)	; #FE- BASIC, TR-DOS
		CP	0FEH
		JR	NZ, CP4PRINT_HEAD
		POP	AF
		RET
; ---------------------------------------------------------------------------
CP4PRINT_HEAD:				; CODE XREF: PRINT_ERROR+6J
		POP	AF
		LD	(TRD_5D0F), A	; 	 TR-DOS
		LD	A, (TRD_5D15)	;  0, 	TR-DOS. 	
		OR	A
		CALL	Z, PRINT_MSG
		RET
; END OF FUNCTION PRINT_ERROR
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR ERASE_FILE
ERR_NOFILES:				; CODE XREF: ROM:054CJ	ERASE_FILE-206J ...
		LD	HL, TXT_NOFILES_
		LD	A, 1
		JP	PRINT_TXTERR
; ---------------------------------------------------------------------------
ERR_OK:					; CODE XREF: ROM:056FJ	ERASE_FILE-203J ...
		LD	HL, TXT_OK_	; "O.K."
		XOR	A
		JP	PRINT_TXTERR
; END OF FUNCTION CHUNK	FOR ERASE_FILE
; =============== S U B	R O U T	I N E =======================================
RD_0SEC2BUF:				; CODE XREF: ROM:04B0P	ROM:1237P ...
		XOR	A
		LD	(TRD_5CCC), A	;  		  
; END OF FUNCTION RD_0SEC2BUF
; =============== S U B	R O U T	I N E =======================================
READ_NUM_SEC:				; CODE XREF: CP_END_BUF+FP
					; RD_HEAD_COPY+12P
		LD	DE, (TRD_5CCC)	;  		  
		LD	D, 0
; END OF FUNCTION READ_NUM_SEC
; START	OF FUNCTION CHUNK FOR READ_9SEC
READ_SEC4NEM:				; CODE XREF: READ_9SEC+6J
		CALL	CREATE_BUF
		LD	HL, TRD_5D25
		LD	B, 1
		JP	COM_05
; END OF FUNCTION CHUNK	FOR READ_9SEC
; =============== S U B	R O U T	I N E =======================================
READ_9SEC:				; CODE XREF: CP_END_DIR:END_OUT_DIRP
					; COM_18P ...
; FUNCTION CHUNK AT 03F2 SIZE 0000000B BYTES
		CALL	CREATE_BUF
		LD	DE, 8
		JR	READ_SEC4NEM
; END OF FUNCTION READ_9SEC
; =============== S U B	R O U T	I N E =======================================
COM_18:					; CODE XREF: ROM:0473P	ROM:0561P ...
; FUNCTION CHUNK AT 03C0 SIZE 00000003 BYTES
		CALL	READ_9SEC
		LD	A, (TRD_5E0C)
		CP	10H
		JR	Z, CP_TYPE_DSK
		LD	HL, TXT_DISCERROR_
		RST	18H
		JR	GOTO_END
; ---------------------------------------------------------------------------
CP_TYPE_DSK:				; CODE XREF: COM_18+8J
		CALL	GET_TYPE_DSK
		RES	0, (HL)
		RES	1, (HL)
		LD	A, (TRD_5E08)
		BIT	0, A
		JR	NZ, LOC_425
		SET	0, (HL)
LOC_425:				; CODE XREF: COM_18+1CJ
		BIT	3, A
		RET	NZ
		SET	1, (HL)
		RET
; END OF FUNCTION COM_18
; =============== S U B	R O U T	I N E =======================================
CP_SECOND_SYM:				; CODE XREF: ROM:CATP ROM:LISTP ...
		LD	HL, (TRD_5D11)
		INC	HL
		LD	A, (HL)
		CP	0DH
		RET
; END OF FUNCTION CP_SECOND_SYM
; ---------------------------------------------------------------------------
CAT:					; DATA XREF: ROM:SPIS_ADR_COMO
		CALL	CP_SECOND_SYM
		LD	BC, 2
		LD	(TRD_5CDB), BC
		JR	Z, LOC_46A
		CP	23H ; '#'
		JR	NZ, CODES
		LD	(CH_ADD), HL
		CALL	SET_NUM_CHAN
		CALL	GET_SYMSTR
		CP	0DH
		JR	Z, LOC_46A
		CP	2CH ; ','
		JP	NZ, SINTAX_ERROR
		CALL	PRINT_NEXT_SYM
		CALL	PUT_NUMDSK_STK
		JR	LOC_460
; ---------------------------------------------------------------------------
CODES:					; CODE XREF: ROM:0441J
		CALL	SET_AND_PUT
LOC_460:				; CODE XREF: ROM:045BJ
		CALL	EXIT_IF_SINTAX
		CALL	GET_STKBOT_
		EX	DE, HL
		CALL	SETUP_DSK
LOC_46A:				; CODE XREF: ROM:043DJ	ROM:044EJ
		CALL	EXIT_IF_SINTAX
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF9), A
		CALL	COM_18
		LD	A, (TRD_5CDB)
LOC_479:				; CODE XREF: ROM:28DDJ
		CP	2
		PUSH	AF
		CALL	Z, CLEAR_SCREEN
		POP	AF
		CP	11H
		JP	NC, SINTAX_ERROR
		CALL	OPENSTREAM
		LD	A, 0FFH
		LD	(TRD_5CF8), A
		LD	HL, TXT_TITLE_	; "TITLE:"
		RST	18H
		LD	HL, TRD_5E1A
		RST	18H
		CALL	PRINT_0D
		LD	A, (TRD_5E09)
		LD	HL, TRD_5E19
		SUB	(HL)
		PUSH	HL
		CALL	PRINT_CHISLO_A_
		LD	HL,  TXT_NOFILES+2
		RST	18H
		POP	HL
		LD	C, (HL)
		CALL	CONV2_2BYTES
		LD	HL, TXT_DELFILE_ ; " DEL. FILE"
		RST	18H
		CALL	RD_0SEC2BUF
		LD	HL, TRD_5D25
LOC_4B6:				; CODE XREF: ROM:04F4J
		CALL	CP_END_DIR
		CALL	PRINT_0D
		LD	A, (TRD_5CF6)
		ADD	A, 41H
		RST	10H
		LD	B, 2
LOC_4C4:				; CODE XREF: ROM:04F2J
		CALL	CP_END_DIR
		PUSH	BC
		LD	A, 3AH
		RST	10H
		PUSH	HL
		CALL	PRINT_FILENAME
		LD	BC, 0DH
		POP	HL
		PUSH	HL
		ADD	HL, BC
		LD	C, (HL)
		PUSH	BC
		LD	A, C
		LD	B, 2
		CP	0AH
		JR	C, LOC_4DF
		DEC	B
LOC_4DF:				; CODE XREF: ROM:04DCJ
		CP	64H
		JR	NC, LOC_4E8
LOC_4E3:				; CODE XREF: ROM:04E6J
		LD	A, 20H
		RST	10H
		DJNZ	LOC_4E3
LOC_4E8:				; CODE XREF: ROM:04E1J
		POP	BC
		CALL	PRINT_CHISLO
		POP	HL
		POP	BC
		LD	DE, 10H
		ADD	HL, DE
		DJNZ	LOC_4C4
		JR	LOC_4B6
; =============== S U B	R O U T	I N E =======================================
CP_END_DIR:				; CODE XREF: ROM:LOC_4B6P ROM:LOC_4C4P
; FUNCTION CHUNK AT 03AC SIZE 00000014 BYTES
; FUNCTION CHUNK AT 2FC6 SIZE 00000010 BYTES
		PUSH	HL
		PUSH	BC
		LD	A, (TRD_5CF9)
		LD	HL, TRD_5CF6
		CP	(HL)
		CALL	NZ, COM_01
		POP	BC
		POP	HL
		JP	CP_END_CAT
; END OF FUNCTION CP_END_DIR
; =============== S U B	R O U T	I N E =======================================
ADD_10:					; CODE XREF: FIND_END_BUFDIR+18P
					; CP_END_DIR+2ADAP
		LD	DE, 10H
		ADD	HL, DE
		RET
; END OF FUNCTION ADD_10
; =============== S U B	R O U T	I N E =======================================
CP_END_BUF:				; CODE XREF: FIND_END_BUFDIR+EP
					; FIND_FILENAME+BP ...
		PUSH	HL
		PUSH	BC
		LD	BC, 0A1DBH
		ADD	HL, BC
		JR	C, READ_SEC2BUF
		POP	BC
		POP	HL
		RET
; ---------------------------------------------------------------------------
READ_SEC2BUF:				; CODE XREF: CP_END_BUF+6J
		LD	HL, TRD_5CCC	;  		  
		INC	(HL)
		CALL	READ_NUM_SEC
		POP	BC
		POP	HL
		LD	HL, TRD_5D25
		RET
; END OF FUNCTION CP_END_BUF
; =============== S U B	R O U T	I N E =======================================
NUMDSK2BYTE:				; CODE XREF: ROM:1022P	SETUP_DSK+8P
; FUNCTION CHUNK AT 1D1A SIZE 0000000F BYTES
		AND	0DFH
		SBC	A, 41H
		JP	C, SINTAX_ERROR
		CP	4
		JP	NC, SINTAX_ERROR
		RET
; END OF FUNCTION NUMDSK2BYTE
; =============== S U B	R O U T	I N E =======================================
CP_ON_STKBOT:				; CODE XREF: ROM:101EP	SET_FILENAME+AP
		CALL	GET_STKBOT_
		LD	A, C
		CP	B
		JP	Z, SINTAX_ERROR
		RET
; END OF FUNCTION CP_ON_STKBOT
; ---------------------------------------------------------------------------
NEW:					; DATA XREF: ROM:3010O
		CALL	INPUT_2STR2STKBOT
		CALL	EXIT_IF_SINTAX
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		CALL	SET_CP_FILENAME
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF8), A
		JP	NZ, ERR_NOFILES
		PUSH	BC
		CALL	RD_HEAD_FILENAME
		CALL	SET_CP_FILENAME
		PUSH	AF
		LD	A, (TRD_5CF8)
		LD	HL, TRD_5CF6
		CP	(HL)
		JP	NZ, SINTAX_ERROR
		CALL	COM_18
		POP	AF
		JP	Z, FILE_EXISTS
		POP	BC
LOC_569:				; CODE XREF: ROM:17A2J	ROM:1B56J
		CALL	SET_HEAD_FILENAME
		CALL	REWRITE_9SEC
		JP	ERR_OK
; =============== S U B	R O U T	I N E =======================================
CP_HIGH_ERR:				; CODE XREF: GET_PARAMS+9P
					; GET_PARAMS+1AP ...
		LD	A, (TRD_5D10)	;   
		OR	A
		RET
; END OF FUNCTION CP_HIGH_ERR
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR ERASE_FILE
CP_ERASED_FILES:			; CODE XREF: ERASE_FILE+19J
		LD	A, (TRD_5D07)
		OR	A
		JP	Z, ERR_NOFILES
		JP	ERR_OK
; END OF FUNCTION CHUNK	FOR ERASE_FILE
; =============== S U B	R O U T	I N E =======================================
GET_OVERWRITE_:				; CODE XREF: ROM:062FP	ROM:06EDP
		PUSH	BC
		CALL	CLEAR_SCREEN
		LD	A, (TRD_5CF6)
		ADD	A, 41H
		CALL	PRINT_A_
		LD	A, 3AH
		CALL	PRINT_A_
		LD	HL, TRD_5CDD	;  
		CALL	PRINT_FILENAME
		LD	HL, ASC_2820	; "FILE EXISTS"
		CALL	PRINT_MSG
		CALL	GET_KEYS
		CP	59H
		PUSH	AF
		CALL	CLEAR_SCREEN
		POP	AF
		POP	BC
		RET	NZ
		PUSH	BC
		CALL	CLEAR_SCREEN
		POP	BC
		CALL	ERASE_FILE
		XOR	A
		RET
; END OF FUNCTION GET_OVERWRITE_
; =============== S U B	R O U T	I N E =======================================
CP_EXT_SHARP:				; CODE XREF: ROM:062AP	ROM:06E8P ...
		LD	A, (TRD_5CE5)	;  
		CP	23H
		JR	Z, FIND_FILENAME_0A
		XOR	A
		RET
; ---------------------------------------------------------------------------
FIND_FILENAME_0A:			; CODE XREF: CP_EXT_SHARP+5J
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		CALL	FIND_FILENAME
		LD	A, 9
		LD	(TRD_5D06), A	;      
		RET
; END OF FUNCTION CP_EXT_SHARP
; ---------------------------------------------------------------------------
LOC_5CB:				; CODE XREF: ROM:06B6J
		LD	A, (TRD_5CDD)	;  
		CP	2AH
		JP	NZ, ERR_NOFILES
		CALL	GET_STKBOT_
		EX	DE, HL
		CALL	SETUP_DSK
		LD	A, (HL)
		CP	2AH
		JP	NZ, SINTAX_ERROR
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF9), A
		LD	A, (TRD_5CF9)
		CALL	COM_01
		CALL	COM_18
		LD	A, 0FFH
		LD	(TRD_5D0D), A
LOC_5F4:				; CODE XREF: ROM:0612J	ROM:0632J ...
		LD	A, (TRD_5CF8)
		CALL	COM_01
		CALL	COM_18
		LD	A, (TRD_5D0D)
		INC	A
		LD	(TRD_5D0D), A
		LD	C, A
		CALL	RD_HEAD_FILENAME
		LD	A, (TRD_5CDD)	;  
		CP	0
		JP	Z, ERR_OK
		CP	1
		JR	Z, LOC_5F4
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		LD	DE, TRD_5CED	; 		 
		LD	BC, 7
		LDIR
		LD	A, (TRD_5CF9)
		CALL	COM_01
		CALL	FIND_FILENAME
		JR	NZ, LOC_634
		CALL	CP_EXT_SHARP
		JR	NZ, LOC_634
		CALL	GET_OVERWRITE_
		JR	NZ, LOC_5F4
LOC_634:				; CODE XREF: ROM:0628J	ROM:062DJ
		CALL	COPY_FILE_ON2DSK
		CALL	REWRITE_9SEC
		JR	LOC_5F4
; =============== S U B	R O U T	I N E =======================================
COPY_FILE_ON2DSK:			; CODE XREF: ROM:LOC_634P ROM:LOC_6F3P
; FUNCTION CHUNK AT 1C45 SIZE 00000005 BYTES
		CALL	READ_9SEC
		LD	A, (TRD_5E09)
		CP	80H
		JP	Z, LOC_1C45
		LD	HL, TRD_5CED	; 		 
		LD	DE, TRD_5CE6	;  <C>- , <B>-	
		LD	BC, 7
		LDIR
		LD	DE, (TRD_5CEA)	; 	 	
		LD	D, 0
		OR	A
		LD	HL, (TRD_5E0A)
		SBC	HL, DE
		JP	C, LOC_1C45
		LD	(TRD_5E0A), HL
		LD	HL, (TRD_5E06)
		LD	(TRD_5CEB), HL	; 			
		PUSH	HL
		CALL	COPY_FILE
		POP	HL
		LD	(TRD_5CEB), HL	; 			
		LD	HL, (TRD_5CF4)
		LD	(TRD_5E06), HL
		LD	HL, TRD_5E09
		INC	(HL)
		LD	C, (HL)
		DEC	C
		LD	B, 0
		PUSH	BC
		LD	DE, 9
		LD	(TRD_5CF4), DE
		CALL	REWRITE_9SEC
		POP	BC
		CALL	SET_HEAD_FILENAME
		RET
; END OF FUNCTION COPY_FILE_ON2DSK
; ---------------------------------------------------------------------------
COPY:					; DATA XREF: ROM:3026O
		LD	HL, (TRD_5D11)
		INC	HL
		LD	A, (HL)
		AND	0DFH
		CP	53H ; 'S'
		JP	Z, COPY_S
		CP	42H ; 'B'
		JP	Z, COPY_B
		CALL	INPUT_2STR2STKBOT
		CALL	EXIT_IF_SINTAX
		CALL	RESERVED_RAM
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		CALL	SET_CP_FILENAME
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF8), A
		JP	NZ, LOC_5CB
		CALL	RD_HEAD_FILENAME
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		LD	DE, TRD_5CED	; 		 
		LD	BC, 7
		LDIR
		CALL	SET_CP_FILENAME
		PUSH	AF
		PUSH	BC
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF9), A
		LD	A, (TRD_5CF8)
		CALL	COM_01
		CALL	COM_18
		LD	A, (TRD_5CF9)
		CALL	COM_01
		CALL	COM_18
		POP	BC
		POP	AF
		JR	NZ, LOC_6F3
		CALL	CP_EXT_SHARP
		JR	NZ, LOC_6F3
		CALL	GET_OVERWRITE_
		JP	NZ, ERR_OK
LOC_6F3:				; CODE XREF: ROM:06E6J	ROM:06EBJ ...
		CALL	COPY_FILE_ON2DSK
		CALL	REWRITE_9SEC
		LD	A, (TRD_5CE5)	;  
		CP	23H
		JP	NZ, ERR_OK
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		INC	(HL)
		LD	A, (TRD_5CF8)
		CALL	COM_01
		CALL	CP_EXT_SHARP
		JP	NZ, ERR_OK
		CALL	RD_HEAD_FILENAME
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		LD	DE, TRD_5CED	; 		 
		LD	BC, 7
		LDIR
		LD	A, (TRD_5CF9)
		CALL	COM_01
		CALL	COM_18
		JR	LOC_6F3
; =============== S U B	R O U T	I N E =======================================
COPY_FILE:				; CODE XREF: COPY_FILE_ON2DSK+2FP
					; COPY_FILE+44J
		LD	A, (TRD_5CF1)
		OR	A
		RET	Z
		PUSH	HL
		LD	HL, TRD_5D23
		SUB	(HL)
		POP	HL
		JR	NC, LOC_775
		LD	A, (TRD_5CF1)
		LD	B, A
		XOR	A
		LD	(TRD_5CF1), A
LOC_744:				; CODE XREF: COPY_FILE+50J
		PUSH	BC
		LD	A, (TRD_5CF8)
		CALL	COM_01
		POP	BC
		PUSH	BC
		LD	HL, (TRD_5CCF)	;   WORK_SP
		PUSH	HL
		LD	DE, (TRD_5CF2)
		CALL	COM_05
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CF2), HL
		LD	A, (TRD_5CF9)
		CALL	COM_01
		POP	HL
		POP	BC
		LD	DE, (TRD_5CEB)	; 			
		CALL	COM_06
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CEB), HL	; 			
		JR	COPY_FILE
; ---------------------------------------------------------------------------
LOC_775:				; CODE XREF: COPY_FILE+BJ
		LD	(TRD_5CF1), A
		PUSH	HL
		LD	HL, TRD_5D23
		LD	B, (HL)
		POP	HL
		XOR	A
		JR	LOC_744
; END OF FUNCTION COPY_FILE
; =============== S U B	R O U T	I N E =======================================
ERASE_FILE:				; CODE XREF: GET_OVERWRITE_+2EP
; FUNCTION CHUNK AT 03D9 SIZE 0000000F BYTES
; FUNCTION CHUNK AT 0577 SIZE 0000000A BYTES
		XOR	A
		LD	(TRD_5D07), A
		JR	ERASE_FILES
; ---------------------------------------------------------------------------
ERASE:					; DATA XREF: ROM:3012O
		CALL	SET_AND_PUT
		CALL	EXIT_IF_SINTAX
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		XOR	A
		LD	(TRD_5D07), A
		CALL	FIND_FILE
		CALL	ERASE_FILES
		JP	NZ, CP_ERASED_FILES
		JP	ERR_OK
; ---------------------------------------------------------------------------
ERASE_FILES:				; CODE XREF: ERASE_FILE+4J
					; ERASE_FILE+16P ...
		LD	A, (TRD_5CDD)	;  
		LD	(TRD_5D08), A
		RET	NZ
		LD	HL, TRD_5D07
		INC	(HL)
		PUSH	BC
		CALL	READ_9SEC
		LD	A, (TRD_5E09)
		POP	BC
		INC	C
		CP	C
		JR	NZ, LOC_7BC
		DEC	A
		LD	(TRD_5E09), A
		XOR	A
LOC_7BC:				; CODE XREF: ERASE_FILE+34J
		PUSH	AF
		JR	Z, LOC_7C3
		LD	HL, TRD_5E19
		INC	(HL)
LOC_7C3:				; CODE XREF: ERASE_FILE+3CJ
		PUSH	BC
		CALL	REWRITE_9SEC
		POP	BC
		DEC	C
		CALL	RD_HEAD_FILENAME
		POP	AF
		JP	Z, LOC_7D2
		LD	A, 1
LOC_7D2:				; CODE XREF: ERASE_FILE+4CJ
		LD	(TRD_5CDD), A	;  
		PUSH	AF
		CALL	WR_HEAD_FILENAME
		LD	A, (TRD_5D08)
		LD	(TRD_5CDD), A	;  
		POP	AF
		JR	Z, WR_NEW_FREE_SEC
		CALL	FIND_FILENAME
		JR	ERASE_FILES
; ---------------------------------------------------------------------------
WR_NEW_FREE_SEC:			; CODE XREF: ERASE_FILE+5FJ
		CALL	READ_9SEC
		LD	HL, (TRD_5CEB)	; 			
		LD	(TRD_5E06), HL
		LD	DE, (TRD_5CEA)	; 	 	
		LD	HL, (TRD_5E0A)
		LD	D, 0
		ADD	HL, DE
		LD	(TRD_5E0A), HL
		JP	REWRITE_9SEC
; END OF FUNCTION ERASE_FILE
; ---------------------------------------------------------------------------
		DB [ 800H ], 0FFH
BYTE_1000:	DB 16H			; DATA XREF: ROM:026DO
		DB 9
		DB 5
		.ASCII 'INTERFACE ONE FITTED'
		DB 0
; ---------------------------------------------------------------------------
COM_STAR:				; DATA XREF: ROM:300AO
		CALL	SET_AND_PUT
		CALL	EXIT_IF_SINTAX
		CALL	CP_ON_STKBOT
		LD	A, (DE)
		CALL	NUMDSK2BYTE
		LD	(TRD_5D19), A
		CALL	COM_01
		JP	ERR_OK
; =============== S U B	R O U T	I N E =======================================
; 	 .  #5C5D  #5CD6
INPUT_EXTFILENAME:			; CODE XREF: ROM:0540P	ROM:06AAP ...
		LD	B, 43H
		LD	A, (TRD_5CD6)	; #FF-   
		OR	A
		JR	NZ, LOC_104D
		CALL	GET_SYMSTR
		CP	0AFH
		LD	B, 43H
		JR	Z, LOC_104D
		CP	0E4H
		LD	B, 44H
		JR	Z, LOC_104D
		CP	23H
		LD	B, 23H
		JR	Z, LOC_104D
		LD	B, 42H
LOC_104D:				; CODE XREF: INPUT_EXTFILENAME+6J
					; INPUT_EXTFILENAME+FJ	...
		LD	HL, TRD_5CE5	;  
		LD	(HL), B
		RET
; END OF FUNCTION INPUT_EXTFILENAME
; =============== S U B	R O U T	I N E =======================================
GET_KEYS:				; CODE XREF: GET_OVERWRITE_+1DP
					; ROM:LOC_1375P ...
		DI
		PUSH	HL
		PUSH	BC
		PUSH	DE
LOC_1056:				; CODE XREF: GET_KEYS+9J GET_KEYS+EJ
		RST	20H
; ---------------------------------------------------------------------------
		DW 28EH			;  
; ---------------------------------------------------------------------------
		LD	C, 0
		JR	NZ, LOC_1056
		RST	20H
; ---------------------------------------------------------------------------
		DW 31EH			;    
; ---------------------------------------------------------------------------
		JR	NC, LOC_1056
		DEC	D
		LD	E, A
		RST	20H
; ---------------------------------------------------------------------------
		DW 333H			; 	
; ---------------------------------------------------------------------------
		POP	DE
		POP	BC
		POP	HL
		AND	0DFH
		EI
		RET
; END OF FUNCTION GET_KEYS
; =============== S U B	R O U T	I N E =======================================
OUT_COLOR_LINE:				; CODE XREF: ROM:0263P
		LD	HL, 58E5H
		LD	B, 0AH
LOC_1073:				; CODE XREF: OUT_COLOR_LINE+8J
		LD	(HL), 7
		INC	HL
		DJNZ	LOC_1073
		LD	(HL), 2
		INC	HL
		LD	(HL), 16H
		INC	HL
		LD	(HL), 34H
		INC	HL
		LD	(HL), 25H
		INC	HL
		LD	(HL), 28H
		INC	HL
		LD	(HL), 7
		LD	HL, 40EEH
		LD	B, 8
		XOR	A
LOC_108F:				; CODE XREF: OUT_COLOR_LINE+33J
		PUSH	BC
		SCF
		RLA
		PUSH	HL
		PUSH	AF
		LD	B, 5
LOC_1096:				; CODE XREF: OUT_COLOR_LINE+2AJ
		INC	HL
		LD	(HL), A
		DJNZ	LOC_1096
		POP	AF
		POP	HL
		POP	BC
		LD	DE, 100H
		ADD	HL, DE
		DJNZ	LOC_108F
		RET
; END OF FUNCTION OUT_COLOR_LINE
; ---------------------------------------------------------------------------
		DB 0C9H
ASC_10A5:	.ASCII ' DEL. FILE(S)'  ; DATA XREF: ROM:1298O ROM:126EO
		DB 0
ASC_10B3:	.ASCII 'TITLE:'         ; DATA XREF: ROM:LOC_123EO
		DB 0A0H
BYTE_10BA:	DB 17H			; DATA XREF: ROM:124BO
		DB 11H
		.ASCII ' DISK DRIVE: '
		DB 0
BYTE_10CA:	DB 17H,	10H, 20H, 0	; DATA XREF: ROM:12DDO
BYTE_10CE:	DB 17H			; DATA XREF: ROM:127AO
		DB 10H
		.ASCII ' 40 TRACK S. SIDE'
		DB 0
BYTE_10E2:	DB 17H			; DATA XREF: ROM:1281O
		DB 10H
		.ASCII ' 80 TRACK S. SIDE'
		DB 0
BYTE_10F6:	DB 17H			; DATA XREF: ROM:1288O
		DB 10H
		.ASCII ' 40 TRACK D. SIDE'
		DB 0
BYTE_110A:	DB 17H			; DATA XREF: ROM:128FO
		DB 10H
		.ASCII ' 80 TRACK D. SIDE'
		DB 0
BYTE_111E:	DB 17H			; DATA XREF: ROM:129CO
		DB 10H
		.ASCII ' FREE SECTOR '
		DB 0
BYTE_112E:	DB 0DH			; DATA XREF: ROM:12ADO
		DB 0DH
		.ASCII '  FILE NAME    START LENGTH LINE'
		DB 0
; =============== S U B	R O U T	I N E =======================================
CREATE_222BYTES:			; CODE XREF: ROM:1228P
		LD	HL, (WORKSP)
		LD	(TRD_5CCF), HL	;   WORK_SP
		LD	BC, 222H
		JP	CREATE_FREERAM
; END OF FUNCTION CREATE_222BYTES
; =============== S U B	R O U T	I N E =======================================
PRINT_HL_CHISLO:			; CODE XREF: ROM:12ECP	ROM:12FAP
		XOR	A
		LD	DE, 2710H
LOC_1161:				; CODE XREF: PRINT_HL_CHISLO+9J
		SBC	HL, DE
		JR	C, LOC_1168
		INC	A
		JR	LOC_1161
; ---------------------------------------------------------------------------
LOC_1168:				; CODE XREF: PRINT_HL_CHISLO+6J
		ADD	A, 30H
		CALL	PRINT_A_CHISLO
		ADD	HL, DE
		XOR	A
		LD	DE, 3E8H
LOC_1172:				; CODE XREF: PRINT_HL_CHISLO+1AJ
		SBC	HL, DE
		JR	C, LOC_1179
		INC	A
		JR	LOC_1172
; ---------------------------------------------------------------------------
LOC_1179:				; CODE XREF: PRINT_HL_CHISLO+17J
		ADD	A, 30H
		CALL	PRINT_A_CHISLO
		ADD	HL, DE
		XOR	A
		LD	DE, 64H
LOC_1183:				; CODE XREF: PRINT_HL_CHISLO+2BJ
		SBC	HL, DE
		JR	C, LOC_118A
		INC	A
		JR	LOC_1183
; ---------------------------------------------------------------------------
LOC_118A:				; CODE XREF: PRINT_HL_CHISLO+28J
		ADD	A, 30H
		CALL	PRINT_A_CHISLO
		ADD	HL, DE
		XOR	A
		LD	DE, 0AH
LOC_1194:				; CODE XREF: PRINT_HL_CHISLO+3CJ
		SBC	HL, DE
		JR	C, LOC_119B
		INC	A
		JR	LOC_1194
; ---------------------------------------------------------------------------
LOC_119B:				; CODE XREF: PRINT_HL_CHISLO+39J
		ADD	A, 30H
		CALL	PRINT_A_CHISLO
		ADD	HL, DE
		LD	A, L
		ADD	A, 30H
		CALL	PRINT_A_CHISLO
		RET
; END OF FUNCTION PRINT_HL_CHISLO
; =============== S U B	R O U T	I N E =======================================
PRINT_A_CHISLO:				; CODE XREF: PRINT_HL_CHISLO+DP
					; PRINT_HL_CHISLO+1EP ...
		PUSH	HL
		PUSH	DE
		CALL	PRINT_A_
		POP	DE
		POP	HL
		RET
; END OF FUNCTION PRINT_A_CHISLO
; =============== S U B	R O U T	I N E =======================================
FIND_END_BUFDIR:			; CODE XREF: FIND_END_BUFDIR+1CJ
					; ROM:LOC_12B5P
		PUSH	HL
		PUSH	BC
		LD	A, (TRD_5CF9)
		LD	HL, TRD_5CF6
		CP	(HL)
		CALL	NZ, COM_01
		POP	BC
		POP	HL
		CALL	CP_END_BUF
		LD	A, (HL)
		OR	A
		JP	Z, END_COMAND
		CP	1
		CALL	Z, ADD_10
		RET	NZ
		JR	FIND_END_BUFDIR
; END OF FUNCTION FIND_END_BUFDIR
; ---------------------------------------------------------------------------
LIST:					; DATA XREF: ROM:302EO
		CALL	CP_SECOND_SYM
		LD	BC, 2
		LD	(TRD_5CDB), BC
		JR	Z, LOC_1205
		CP	23H ; '#'
		JR	NZ, LIST4CODES
		LD	(CH_ADD), HL
		CALL	SET_NUM_CHAN
		CALL	GET_SYMSTR
		CP	0DH
		JR	Z, LOC_1205
		CP	2CH ; ','
		JP	NZ, SINTAX_ERROR
		CALL	PRINT_NEXT_SYM
		CALL	PUT_NUMDSK_STK
		JR	LOC_11FB
; ---------------------------------------------------------------------------
LIST4CODES:				; CODE XREF: ROM:11DCJ
		CALL	SET_AND_PUT
LOC_11FB:				; CODE XREF: ROM:11F6J
		CALL	EXIT_IF_SINTAX
		CALL	GET_STKBOT_
		EX	DE, HL
		CALL	SETUP_DSK
LOC_1205:				; CODE XREF: ROM:11D8J	ROM:11E9J
		CALL	EXIT_IF_SINTAX
		LD	A, (TRD_5CF6)
		LD	(TRD_5CF9), A
		CALL	COM_18
		LD	A, (TRD_5CDB)
		CP	2
		PUSH	AF
		CALL	Z, CLEAR_SCREEN
		POP	AF
		CP	11H
		JP	NC, SINTAX_ERROR
		CALL	OPENSTREAM
		LD	A, 0FFH
		LD	(TRD_5CF8), A
		CALL	CREATE_222BYTES
		LD	HL, TRD_5E06
		LD	DE, (TRD_5CCF)	;   WORK_SP
		LD	BC, 20H
		LDIR
		CALL	RD_0SEC2BUF
		LD	HL, TRD_5D25
		PUSH	HL
LOC_123E:				; CODE XREF: ROM:1318J
		LD	HL, ASC_10B3	; "TITLE:"
		PUSH	BC
		RST	18H
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 14H
		ADD	HL, BC
		RST	18H
		LD	HL, BYTE_10BA
		RST	18H
		LD	A, (TRD_5CF6)
		ADD	A, 41H
		CALL	PRINT_A_
		CALL	PRINT_0D
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 3
		ADD	HL, BC
		LD	A, (HL)
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 13H
		ADD	HL, BC
		SUB	(HL)
		PUSH	HL
		CALL	PRINT_CHISLO_A_
		LD	HL,  ASC_10A5+5
		RST	18H
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 2
		ADD	HL, BC
		LD	A, (HL)
		LD	HL, BYTE_10CE
		CP	19H
		JR	Z, LOC_1292
		LD	HL, BYTE_10E2
		CP	18H
		JR	Z, LOC_1292
		LD	HL, BYTE_10F6
		CP	17H
		JR	Z, LOC_1292
		LD	HL, BYTE_110A
LOC_1292:				; CODE XREF: ROM:127FJ	ROM:1286J ...
		RST	18H
		POP	HL
		LD	C, (HL)
		CALL	CONV2_2BYTES
		LD	HL, ASC_10A5	; " DEL. FILE(S)"
		RST	18H
		LD	HL, BYTE_111E
		RST	18H
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 4
		ADD	HL, BC
		LD	C, (HL)
		INC	HL
		LD	B, (HL)
		CALL	PRINT_CHISLO
		LD	HL, BYTE_112E
		RST	18H
		POP	BC
		POP	HL
		LD	B, 10H
LOC_12B5:				; CODE XREF: ROM:130FJ
		CALL	FIND_END_BUFDIR
		CALL	PRINT_0D
		PUSH	BC
		PUSH	HL
		CALL	PRINT_FILENAME
		LD	BC, 0DH
		POP	HL
		PUSH	HL
		ADD	HL, BC
		LD	C, (HL)
		PUSH	BC
		LD	A, C
		LD	B, 2
		CP	0AH
		JR	C, LOC_12D0
		DEC	B
LOC_12D0:				; CODE XREF: ROM:12CDJ
		CP	64H
		JR	NC, LOC_12D9
LOC_12D4:				; CODE XREF: ROM:12D7J
		LD	A, 20H
		RST	10H
		DJNZ	LOC_12D4
LOC_12D9:				; CODE XREF: ROM:12D2J
		POP	BC
		CALL	PRINT_CHISLO
		LD	HL, BYTE_10CA
		RST	18H
		POP	HL
		PUSH	HL
		LD	BC, 9
		ADD	HL, BC
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		PUSH	HL
		EX	DE, HL
		CALL	PRINT_HL_CHISLO
		LD	A, 20H
		CALL	PRINT_A_
		POP	HL
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		EX	DE, HL
		CALL	PRINT_HL_CHISLO
		POP	HL
		PUSH	HL
		LD	BC, 8
		ADD	HL, BC
		LD	A, (HL)
		CP	42H ; 'B'
		CALL	Z, PRN_ADR_ASTART
		POP	HL
		POP	BC
		LD	DE, 10H
		ADD	HL, DE
		DJNZ	LOC_12B5
		PUSH	HL
		CALL	PRINT_0D
		CALL	PRINT_0D
		JP	LOC_123E
; =============== S U B	R O U T	I N E =======================================
PRN_ADR_ASTART:				; CODE XREF: ROM:1306P
		LD	BC, 5
		ADD	HL, BC
		LD	B, (HL)
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		DEC	B
		JR	Z, LOC_1335
		DEC	B
		JR	Z, LOC_1335
		LD	A, 10H
LOC_132C:				; CODE XREF: PRN_ADR_ASTART:LOC_1333J
		INC	E
		CP	E
		JR	NZ, LOC_1333
		LD	E, 0
		INC	D
LOC_1333:				; CODE XREF: PRN_ADR_ASTART+13J
		DJNZ	LOC_132C
LOC_1335:				; CODE XREF: PRN_ADR_ASTART+AJ
					; PRN_ADR_ASTART+DJ
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 21H
		ADD	HL, BC
		LD	B, 2
		PUSH	HL
		CALL	COM_05
		LD	A, 80H
		POP	HL
		LD	BC, 200H
		CPIR
		LD	A, (HL)
		CP	0AAH
		RET	NZ
		INC	HL
		LD	C, (HL)
		INC	HL
		LD	B, (HL)
		LD	A, B
		OR	C
		RET	Z
		PUSH	BC
		LD	A, 20H
		CALL	PRINT_A_
		POP	BC
		CALL	PRINT_CHISLO
		RET
; END OF FUNCTION PRN_ADR_ASTART
; ---------------------------------------------------------------------------
COPY_S:					; CODE XREF: ROM:0699J
		CALL	SET_CH_ADD
		CALL	PRINT_NEXT_SYM
		CALL	PUT_NUMDSK_STK
		CALL	EXIT_IF_SINTAX
		CALL	RESERVED_RAM
		LD	HL, ASC_27AA	; "INSERT SOURCE DISK THEN PRESS Y"
		CALL	PRINT_MSG
LOC_1375:				; CODE XREF: ROM:137AJ
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_1375
		CALL	CLEAR_DOWN_SCR
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		CALL	SET_CP_FILENAME
		JP	NZ, ERR_NOFILES
		CALL	COPY_ON1DSK
		LD	A, (TRD_5CE5)	;  
		CP	23H
		JP	NZ, ERR_OK
LOC_1393:				; CODE XREF: ROM:13B5J
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		INC	(HL)
		CALL	CLEAR_SCREEN
		LD	HL, ASC_27AA	; "INSERT SOURCE DISK THEN PRESS Y"
		CALL	PRINT_MSG
LOC_13A5:				; CODE XREF: ROM:13AAJ
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_13A5
		CALL	FIND_FILENAME
		JP	NZ, ERR_OK
		CALL	COPY_ON1DSK
		JR	LOC_1393
; =============== S U B	R O U T	I N E =======================================
COPY_ON1DSK:				; CODE XREF: ROM:1388P	ROM:13B2P
		CALL	RD_HEAD_FILENAME
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		LD	DE, TRD_5CED	; 		 
		LD	BC, 7
		LDIR
		LD	A, (TRD_5CF1)
		LD	(TRD_5D10), A	;   
		CALL	COM_18
		CALL	GET_TYPE_DSK
		LD	(TRD_5CD9), A
		LD	A, 0FFH
		LD	(TRD_5D21), A
		CALL	COPY_ON1DSK_
		LD	HL, (TRD_5D1F)
		LD	(TRD_5CEB), HL	; 			
		LD	HL, (TRD_5CF4)
		LD	(TRD_5E06), HL
		LD	HL, TRD_5E09
		INC	(HL)
		LD	C, (HL)
		DEC	C
		LD	B, 0
		PUSH	BC
		LD	DE, 9
		LD	(TRD_5CF4), DE
		CALL	REWRITE_9SEC
		POP	BC
		CALL	SET_HEAD_FILENAME
		CALL	REWRITE_9SEC
		RET
; END OF FUNCTION COPY_ON1DSK
; =============== S U B	R O U T	I N E =======================================
CP_FREESEC:				; CODE XREF: COPY_ON1DSK_+62P
; FUNCTION CHUNK AT 1C50 SIZE 00000007 BYTES
; FUNCTION CHUNK AT 2723 SIZE 00000008 BYTES
		XOR	A
		LD	(TRD_5D21), A
		CALL	COM_18
		CALL	GET_TYPE_DSK
		LD	(TRD_5CDA), A
		CALL	FIND_FILENAME
		JP	Z, FILE_EXISTS
		CALL	READ_9SEC
		LD	A, (TRD_5E09)
		CP	80H
		JP	Z, LOC_2723
		LD	HL, TRD_5CED	; 		 
		LD	DE, TRD_5CE6	;  <C>- , <B>-	
		LD	BC, 7
		LDIR
		CALL	READ_9SEC
		LD	A, (TRD_5D10)	;   
		LD	(TRD_5CEA), A	; 	 	
		LD	DE, (TRD_5CEA)	; 	 	
		LD	D, 0
		OR	A
		LD	HL, (TRD_5E0A)
		SBC	HL, DE
		JP	C, LOC_1C45
		LD	(TRD_5E0A), HL
		LD	HL, (TRD_5E06)
		LD	(TRD_5CEB), HL	; 			
		LD	(TRD_5D1F), HL
		RET
; END OF FUNCTION CP_FREESEC
; =============== S U B	R O U T	I N E =======================================
COPY_ON1DSK_:				; CODE XREF: COPY_ON1DSK+22P
					; COPY_ON1DSK_+77J
		LD	A, (TRD_5CF1)
		OR	A
		RET	Z
		LD	A, (TRD_5D21)
		OR	A
		JR	NZ, LOC_146F
		CALL	CLEAR_SCREEN
		LD	HL, ASC_27AA	; "INSERT SOURCE DISK THEN PRESS Y"
		CALL	PRINT_MSG
LOC_1465:				; CODE XREF: COPY_ON1DSK_+19J
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_1465
		CALL	CLEAR_DOWN_SCR
LOC_146F:				; CODE XREF: COPY_ON1DSK_+9J
		LD	A, (TRD_5CF1)
		OR	A
		RET	Z
		PUSH	HL
		LD	HL, TRD_5D23
		SUB	(HL)
		POP	HL
		JR	NC, LOC_14CB
		LD	A, (TRD_5CF1)
		LD	B, A
		XOR	A
		LD	(TRD_5CF1), A
LOC_1484:				; CODE XREF: COPY_ON1DSK_+84J
		PUSH	BC
		LD	(TRD_5CCE), A	; #00- ,#FF-	
		LD	HL, (TRD_5CCF)	;   WORK_SP
		PUSH	HL
		LD	DE, (TRD_5CF2)
		CALL	SETUP_DSK_SOURCE
		CALL	COM_05
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CF2), HL
		CALL	CLEAR_SCREEN
		LD	HL, ASC_2785	; "INSERT DESTINATION DISK"
		CALL	PRINT_MSG
LOC_14A5:				; CODE XREF: COPY_ON1DSK_+59J
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_14A5
		CALL	CLEAR_DOWN_SCR
		LD	A, (TRD_5D21)
		OR	A
		CALL	NZ, CP_FREESEC
		POP	HL
		POP	BC
		LD	DE, (TRD_5CEB)	; 			
		CALL	SETUP_DSK_DEST
		CALL	COM_06
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CEB), HL	; 			
		JP	COPY_ON1DSK_
; ---------------------------------------------------------------------------
LOC_14CB:				; CODE XREF: COPY_ON1DSK_+29J
		LD	(TRD_5CF1), A
		PUSH	HL
		LD	HL, TRD_5D23
		LD	B, (HL)
		POP	HL
		XOR	A
		JP	LOC_1484
; END OF FUNCTION COPY_ON1DSK_
; =============== S U B	R O U T	I N E =======================================
SETUP_DSK_SOURCE:			; CODE XREF: COPY_ON1DSK_+3FP
					; COPY_SECTORS+45P
		PUSH	HL
		PUSH	DE
		CALL	GET_TYPE_DSK
		LD	A, (TRD_5CD9)
		LD	(HL), A
		POP	DE
		POP	HL
		RET
; END OF FUNCTION SETUP_DSK_SOURCE
; =============== S U B	R O U T	I N E =======================================
SETUP_DSK_DEST:				; CODE XREF: COPY_ON1DSK_+6BP
					; ROM:15A2P ...
		PUSH	HL
		PUSH	DE
		CALL	GET_TYPE_DSK
		LD	A, (TRD_5CDA)
		LD	(HL), A
		POP	DE
		POP	HL
		RET
; END OF FUNCTION SETUP_DSK_DEST
; =============== S U B	R O U T	I N E =======================================
CP_FREE_DEST:				; CODE XREF: COPY_SECTORS+73P
		XOR	A
		LD	(TRD_5D21), A
		CALL	COM_18
		CALL	GET_TYPE_DSK
		LD	(TRD_5CDA), A
		LD	A, (TRD_5E08)
		LD	(TRD_5CE6+1), A	;  <C>- , <B>-	
		LD	HL, 280H
		CP	19H
		JR	Z, SAVE_SECS_DEST
		LD	HL, 500H
		CP	18H
		JR	Z, SAVE_SECS_DEST
		CP	17H
		JR	Z, SAVE_SECS_DEST
		LD	HL, 0A00H
		CP	16H
		JR	Z, SAVE_SECS_DEST
		JP	SINTAX_ERROR
; ---------------------------------------------------------------------------
SAVE_SECS_DEST:				; CODE XREF: CP_FREE_DEST+18J
					; CP_FREE_DEST+1FJ ...
		LD	(TRD_5CDD), HL	;  
		LD	BC, (TRD_5CDF)
		SBC	HL, BC
		JP	C, LOC_1C45
		RET
; END OF FUNCTION CP_FREE_DEST
; ---------------------------------------------------------------------------
COPY_B:					; CODE XREF: ROM:069EJ
		CALL	EXIT_IF_SINTAX
		CALL	RESERVED_RAM
		LD	HL, ASC_2779	; "BACKUP DISK"
		CALL	PRINT_MSG
		LD	HL, ASC_27AA	; "INSERT SOURCE DISK THEN PRESS Y"
		CALL	PRINT_MSG
LOC_153E:				; CODE XREF: ROM:1543J
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_153E
		CALL	CLEAR_DOWN_SCR
		LD	A, 0FFH
		LD	(TRD_5D21), A
		CALL	COM_18
		CALL	GET_TYPE_DSK
		LD	(TRD_5CD9), A
		LD	A, (TRD_5E08)
		CP	19H
		LD	HL, 280H
		JR	Z, LOC_1575
		LD	HL, 500H
		CP	18H
		JR	Z, LOC_1575
		CP	17H
		JR	Z, LOC_1575
		LD	HL, 0A00H
		CP	16H
		JR	Z, LOC_1575
		JP	SINTAX_ERROR
; ---------------------------------------------------------------------------
LOC_1575:				; CODE XREF: ROM:155EJ	ROM:1565J ...
		LD	BC, (TRD_5E0A)
		SBC	HL, BC
		LD	(TRD_5CE5), HL	;  
		LD	(TRD_5CDF), HL
		LD	HL, 0
		LD	(TRD_5CE1), HL
		LD	(TRD_5CE3), HL
		CALL	COPY_SECTORS
		CALL	COM_18
		LD	A, (TRD_5CE6+1)	;  <C>- , <B>-	
		LD	(TRD_5E08), A
		LD	HL, (TRD_5CDD)	;  
		LD	BC, (TRD_5CDF)
		SBC	HL, BC
		LD	(TRD_5E0A), HL
		CALL	SETUP_DSK_DEST
		LD	DE, 9
		LD	(TRD_5CF4), DE
		CALL	REWRITE_9SEC
		JP	ERR_OK
; =============== S U B	R O U T	I N E =======================================
CP_COPY_SECS:				; CODE XREF: COPY_SECTORSP
					; COPY_SECTORS:LOC_15DBP
		LD	HL, (TRD_5CE5)	;  
		LD	A, H
		OR	L
		RET
; END OF FUNCTION CP_COPY_SECS
; =============== S U B	R O U T	I N E =======================================
COPY_SECTORS:				; CODE XREF: ROM:158AP
					; COPY_SECTORS+89J
		CALL	CP_COPY_SECS
		RET	Z
		LD	A, (TRD_5D21)
		OR	A
		JR	NZ, LOC_15DB
		CALL	CLEAR_SCREEN
		LD	HL, ASC_2779	; "BACKUP DISK"
		CALL	PRINT_MSG
		LD	HL, ASC_27AA	; "INSERT SOURCE DISK THEN PRESS Y"
		CALL	PRINT_MSG
LOC_15D1:				; CODE XREF: COPY_SECTORS+1EJ
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_15D1
		CALL	CLEAR_DOWN_SCR
LOC_15DB:				; CODE XREF: COPY_SECTORS+8J
		CALL	CP_COPY_SECS
		RET	Z
		PUSH	BC
		PUSH	HL
		LD	HL, TRD_5D23
		LD	C, (HL)
		LD	B, 0
		POP	HL
		SBC	HL, BC
		POP	BC
		JP	NC, LOC_1644
		LD	BC, (TRD_5CE5)	;  
		LD	HL, 0
		LD	(TRD_5CE5), HL	;  
LOC_15F8:				; CODE XREF: COPY_SECTORS+98J
		PUSH	BC
		LD	HL, (TRD_5CCF)	;   WORK_SP
		PUSH	HL
		CALL	SETUP_DSK_SOURCE
		LD	DE, (TRD_5CE1)
		LD	B, C
		CALL	COM_05
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CE1), HL
		CALL	CLEAR_SCREEN
		LD	HL, ASC_2779	; "BACKUP DISK"
		CALL	PRINT_MSG
		LD	HL, ASC_2785	; "INSERT DESTINATION DISK"
		CALL	PRINT_MSG
LOC_161D:				; CODE XREF: COPY_SECTORS+6AJ
		CALL	GET_KEYS
		CP	59H
		JR	NZ, LOC_161D
		CALL	CLEAR_DOWN_SCR
		LD	A, (TRD_5D21)
		OR	A
		CALL	NZ, CP_FREE_DEST
		POP	HL
		POP	BC
		LD	DE, (TRD_5CE3)
		LD	B, C
		CALL	SETUP_DSK_DEST
		CALL	COM_06
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CE3), HL
		JP	COPY_SECTORS
; ---------------------------------------------------------------------------
LOC_1644:				; CODE XREF: COPY_SECTORS+33J
		LD	(TRD_5CE5), HL	;  
		PUSH	HL
		LD	HL, TRD_5D23
		LD	C, (HL)
		LD	B, LOC_0
		POP	HL
		XOR	A
		JP	LOC_15F8
; END OF FUNCTION COPY_SECTORS
; =============== S U B	R O U T	I N E =======================================
CP_ERASED_FILE:				; CODE XREF: ROM:16C4P	ROM:16D7P ...
		CALL	RD_HEAD_FILENAME
		LD	A, (TRD_5CDD)	;  
		CP	1
		RET
; END OF FUNCTION CP_ERASED_FILE
; ---------------------------------------------------------------------------
COM_08:					; DATA XREF: ROM:28A5O
		LD	C, A
; =============== S U B	R O U T	I N E =======================================
RD_HEAD_FILENAME:			; CODE XREF: ROM:0550P	ROM:0605P ...
		XOR	A
LOC_165E:				; CODE XREF: SET_HEAD_FILENAME+2J
		PUSH	BC
		CALL	RD_HEAD_COPY
		POP	BC
		RET
; END OF FUNCTION RD_HEAD_FILENAME
; ---------------------------------------------------------------------------
COM_09:					; DATA XREF: ROM:28A8O
		LD	C, A
		CALL	SET_HEAD_FILENAME
		JP	REWRITE_9SEC
; =============== S U B	R O U T	I N E =======================================
SET_HEAD_FILENAME:			; CODE XREF: ROM:LOC_569P
					; COPY_FILE_ON2DSK+50P	...
		LD	A, 0FFH
		JR	LOC_165E
; END OF FUNCTION SET_HEAD_FILENAME
; =============== S U B	R O U T	I N E =======================================
RESERVED_RAM:				; CODE XREF: ROM:06A7P	ROM:136CP ...
		LD	A, 0FFH
		LD	(TRD_5D0E), A	; #FE- BASIC, TR-DOS
		CALL	CP_FREE_SECS
		LD	HL, (WORKSP)
		LD	(TRD_5CCF), HL	;   WORK_SP
		JP	CREATE_FREERAM
; END OF FUNCTION RESERVED_RAM
; =============== S U B	R O U T	I N E =======================================
CP_FREE_SECS:				; CODE XREF: RESERVED_RAM+5P
		RST	20H
; ---------------------------------------------------------------------------
		DW 1F1AH		;    
; ---------------------------------------------------------------------------
		LD	HL, 0FFFFH
		SBC	HL, BC
		LD	A, H
		CP	10H
		JR	NC, LOC_168F
		LD	A, 11H
LOC_168F:				; CODE XREF: CP_FREE_SECS+BJ
		DEC	A
		LD	(TRD_5D23), A
		LD	B, A
		LD	C, 0
		RET
; END OF FUNCTION CP_FREE_SECS
; =============== S U B	R O U T	I N E =======================================
ADD_FILESIZE:				; CODE XREF: ROM:16D3P	ROM:16F4P
		LD	(TRD_5CD7), HL
		LD	(TRD_5CDB), HL
		LD	DE, (TRD_5CEA)	; 	 	
		LD	HL, (TRD_5CD9)
		LD	D, 0
		ADD	HL, DE
		LD	(TRD_5CD9), HL
		RET
; END OF FUNCTION ADD_FILESIZE
; ---------------------------------------------------------------------------
MOVE:					; DATA XREF: ROM:300EO
		CALL	EXIT_IF_SINTAX
		CALL	RESERVED_RAM
		CALL	COM_18
		LD	A, (TRD_5E19)
		OR	A
		JP	Z, ERR_OK
		LD	HL, 0
		LD	(TRD_5CD9), HL
		LD	C, 0FFH
LOC_16C3:				; CODE XREF: ROM:16C7J	ROM:1769J
		INC	C
		CALL	CP_ERASED_FILE
		JR	NZ, LOC_16C3
		LD	A, C
		LD	(TRD_5CD4), A
		LD	HL, (TRD_5CEB)	; 			
		LD	(TRD_5CD5), HL
		CALL	ADD_FILESIZE
LOC_16D6:				; CODE XREF: ROM:16DAJ
		INC	C
		CALL	CP_ERASED_FILE
		JR	Z, LOC_16D6
		CP	0
		JP	NZ, LOC_1710
		LD	A, (TRD_5CD4)
		LD	C, A
LOC_16E5:				; CODE XREF: ROM:16F7J
		INC	C
		CALL	CP_ERASED_FILE
		CP	0
		JR	Z, REINIT_9SEC
		XOR	A
		LD	(TRD_5CDD), A	;  
		CALL	WR_HEAD_FILENAME
		CALL	ADD_FILESIZE
		JR	LOC_16E5
; ---------------------------------------------------------------------------
		DB [ 17H ], 0FFH
; ---------------------------------------------------------------------------
LOC_1710:				; CODE XREF: ROM:16DEJ
		LD	A, (TRD_5CEA)	; 	 	
		LD	(TRD_5CD3), A
		LD	(TRD_5CD1), A
		LD	HL, (TRD_5CEB)	; 			
		LD	(TRD_5CD5), HL
		PUSH	BC
		CALL	MOVE_FILE
		POP	BC
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CD5), HL
		LD	(TRD_5CEB), HL	; 			
		XOR	A
		LD	(TRD_5CEA), A	; 	 	
		LD	A, (TRD_5CDD)	;  
		PUSH	AF
		LD	A, 1
		LD	(TRD_5CDD), A	;  
		CALL	WR_HEAD_FILENAME
		POP	AF
		LD	(TRD_5CDD), A	;  
		LD	A, (TRD_5CD4)
		LD	C, A
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CEB), HL	; 			
		LD	A, (TRD_5CD1)
		LD	(TRD_5CEA), A	; 	 	
		CALL	WR_HEAD_FILENAME
		LD	A, (TRD_5CD4)
		INC	A
		LD	C, A
		CALL	RD_HEAD_FILENAME
		LD	HL, (TRD_5CD5)
		LD	(TRD_5CEB), HL	; 			
		CALL	WR_HEAD_FILENAME
		LD	A, (TRD_5CD4)
		LD	C, A
		JP	LOC_16C3
; ---------------------------------------------------------------------------
REINIT_9SEC:				; CODE XREF: ROM:16EBJ
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	BC, 1000H
		CALL	DEL_WORKRAM
		CALL	READ_9SEC
		LD	HL, (TRD_5E0A)
		LD	DE, (TRD_5CD9)
		ADD	HL, DE
		LD	(TRD_5E0A), HL
		LD	A, (TRD_5E09)
		LD	HL, TRD_5E19
		SUB	(HL)
		LD	(TRD_5E09), A
		LD	(HL), 0
		LD	HL, (TRD_5CD5)
		LD	(TRD_5E06), HL
		PUSH	AF
		CALL	REWRITE_9SEC
		POP	AF
		LD	C, A
		CALL	RD_HEAD_FILENAME
		XOR	A
		LD	(TRD_5CDD), A	;  
		JP	LOC_569
; =============== S U B	R O U T	I N E =======================================
MOVE_FILE:				; CODE XREF: ROM:1720P	MOVE_FILE+36J
		LD	A, (TRD_5CD3)
		OR	A
		RET	Z
		PUSH	HL
		LD	HL, TRD_5D23
		SUB	(HL)
		POP	HL
		JR	NC, LOC_17DD
		LD	A, (TRD_5CD3)
		LD	B, A
		XOR	A
		LD	(TRD_5CD3), A
LOC_17BA:				; CODE XREF: MOVE_FILE+42J
		PUSH	BC
		LD	HL, (TRD_5CCF)	;   WORK_SP
		PUSH	HL
		LD	DE, (TRD_5CD5)
		CALL	COM_05
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CD5), HL
		POP	HL
		POP	BC
		LD	DE, (TRD_5CD7)
		CALL	COM_06
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CD7), HL
		JR	MOVE_FILE
; ---------------------------------------------------------------------------
LOC_17DD:				; CODE XREF: MOVE_FILE+BJ
		LD	(TRD_5CD3), A
		PUSH	HL
		LD	HL, TRD_5D23
		LD	B, (HL)
		POP	HL
		XOR	A
		JR	LOC_17BA
; END OF FUNCTION MOVE_FILE
; =============== S U B	R O U T	I N E =======================================
RD_HEAD_COPY:				; CODE XREF: RD_HEAD_FILENAME+2P
		PUSH	AF
		LD	HL, TRD_5CCC	;  		  
		LD	(HL), 0
		LD	A, C
LOC_17F0:				; CODE XREF: RD_HEAD_COPY+CJ
		SUB	10H
		JR	C, LOC_17F7
		INC	(HL)
		JR	LOC_17F0
; ---------------------------------------------------------------------------
LOC_17F7:				; CODE XREF: RD_HEAD_COPY+9J
		ADD	A, 10H
		LD	C, A
		PUSH	BC
		CALL	READ_NUM_SEC
		POP	BC
		POP	AF
		CALL	FIND_HEAD_BUF
		LD	DE, TRD_5CDD	;  
		LD	BC, 10H
		OR	A
		JR	Z, LOC_180D
		EX	DE, HL
LOC_180D:				; CODE XREF: RD_HEAD_COPY+21J
		LDIR
		RET
; END OF FUNCTION RD_HEAD_COPY
; ---------------------------------------------------------------------------
VERIFY:					; DATA XREF: ROM:3030O
		LD	A, 0FFH
		LD	(TRD_5CF9), A
LOAD:					; DATA XREF: ROM:3014O
		CALL	ZERO2HIGH_ERR
LOC_1818:				; CODE XREF: ROM:19AEJ
		CALL	LOAD_FILE
		CALL	EXIT_IF_SINTAX
		LD	A, 0FFH
		LD	(TRD_5D10), A	;   
		LD	A, (TRD_5CF9)
		CP	0FFH
		JP	Z, ERR_OK
		LD	A, (TRD_5CE5)	;  
		CP	42H ; 'B'
		JP	Z, LOC_12A
		JP	ERR_OK
; =============== S U B	R O U T	I N E =======================================
LOAD_FILE:				; CODE XREF: ROM:LOC_1818P ROM:1D50P
		CALL	GET_PARAMS
		CALL	EXIT_IF_SINTAX
		CALL	CP_PARAMS
		JP	RD_FILE
; END OF FUNCTION LOAD_FILE
; =============== S U B	R O U T	I N E =======================================
GET_LOAD_CODE:				; CODE XREF: GET_PARAMS+14P
		LD	HL, (CH_ADD)
		INC	HL
		LD	A, (HL)
		CP	0DH
		RET	Z
		LD	A, 1
		LD	(TRD_5CD6), A	; #FF-   
		CALL	INPUT_PARAMS
; END OF FUNCTION GET_LOAD_CODE
; =============== S U B	R O U T	I N E =======================================
ZERO2HIGH_ERR:				; CODE XREF: ROM:LOADP	ROM:19E1P ...
		XOR	A
		LD	(TRD_5D10), A	;   
		RET
; END OF FUNCTION ZERO2HIGH_ERR
; =============== S U B	R O U T	I N E =======================================
SUB_1857:				; CODE XREF: GET_PARAMS+CP
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		LD	A, 42H ; 'B'
		CP	B
		JR	NZ, LOC_1866
		LD	HL, (CH_ADD)
		DEC	HL
		LD	(CH_ADD), HL
LOC_1866:				; CODE XREF: SUB_1857+6J
		CALL	INPUT_PARAMS
		LD	HL, (TRD_5CD9)
		LD	(TRD_5CD7), HL
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CD9), HL
		XOR	A
		LD	(TRD_5CD6), A	; #FF-   
		RET
; END OF FUNCTION SUB_1857
; =============== S U B	R O U T	I N E =======================================
GET_PARAMS:				; CODE XREF: LOAD_FILEP ROM:19B6P
; FUNCTION CHUNK AT 027B SIZE 00000035 BYTES
; FUNCTION CHUNK AT 02EF SIZE 0000006A BYTES
		CALL	CP_SECOND_SYM
		JP	Z, LOC_27B
		CALL	SET_AND_PUT
		CALL	CP_HIGH_ERR
		CALL	NZ, SUB_1857
		CALL	GET_SYMSTR
		CP	0AFH
		CALL	Z, GET_LOAD_CODE
		CP	0E4H
		PUSH	AF
		CALL	CP_HIGH_ERR
		CALL	Z, INPUT_EXTFILENAME ;  	.  #5C5D	 #5CD6
		POP	AF
		CALL	Z, READ_MASSIV
		CALL	EXIT_IF_SINTAX
		CALL	FIND_FILE
FIND_RD_HEAD:				; CODE XREF: ROM:291DP
		JP	NZ, ERR_NOFILES
		CALL	RD_HEAD_FILENAME
		RET
; END OF FUNCTION GET_PARAMS
; =============== S U B	R O U T	I N E =======================================
CP_PARAMS:				; CODE XREF: LOAD_FILE+6P ROM:2920P
		LD	A, (TRD_5CD6)	; #FF-   
		OR	A
		LD	HL, (TRD_5CE6)	;  <C>- , <B>-	
		JR	Z, LOC_18B7
		LD	HL, (TRD_5CD9)
LOC_18B7:				; CODE XREF: CP_PARAMS+7J
		LD	DE, (TRD_5CEB)	; 			
		CP	3
		LD	A, (TRD_5CEA)	; 	 	
		PUSH	DE
		LD	DE, (TRD_5CE8)	; 	
		JR	NZ, LOC_18CB
		LD	DE, (TRD_5CDB)
LOC_18CB:				; CODE XREF: CP_PARAMS+1AJ
		LD	B, A
		LD	(TRD_5CDB), DE
		LD	A, (TRD_5CE5)	;  
		CP	43H ; 'C'
		LD	A, B
		JR	NZ, LOC_18FD
		LD	A, B
		CP	D
		JR	Z, LOC_18F6
		DEC	A
		CP	D
		LD	A, B
		JR	Z, LOC_18F6
		LD	A, (TRD_5CD6)	; #FF-   
		CP	3
		LD	A, B
		JR	Z, LOC_18F6
		XOR	A
		LD	(TRD_5CD6), A	; #FF-   
		LD	D, B
		LD	E, 0
		LD	(TRD_5CDB), DE
		JR	LOC_18F9
; ---------------------------------------------------------------------------
LOC_18F6:				; CODE XREF: CP_PARAMS+2FJ
					; CP_PARAMS+34J ...
		CALL	LOAD_FULLFILE
LOC_18F9:				; CODE XREF: CP_PARAMS+49J
		LD	A, B
		CALL	KOLWO_SECS
LOC_18FD:				; CODE XREF: CP_PARAMS+2BJ
		LD	B, A
		LD	A, (TRD_5CE5)	;  
		CP	43H ; 'C'
		POP	DE
		RET	Z
		PUSH	DE
		CP	42H ; 'B'
		PUSH	AF
		CALL	Z, LOAD4BASIC
		POP	AF
		CP	44H ; 'D'
		CALL	Z, LOAD4DATA
		CALL	LOAD_FULLFILE
		LD	A, (TRD_5CDC)
		LD	B, A
		POP	DE
		RET
; END OF FUNCTION CP_PARAMS
; =============== S U B	R O U T	I N E =======================================
LOAD_FULLFILE:				; CODE XREF: CP_PARAMS:LOC_18F6P
					; CP_PARAMS+67P ...
		LD	A, 3
		LD	(TRD_5CD6), A	; #FF-   
		RET
; END OF FUNCTION LOAD_FULLFILE
; =============== S U B	R O U T	I N E =======================================
RD_FILE:				; CODE XREF: LOAD_FILE+9J ROM:19E4P ...
		CALL	CP_HIGH_ERR
		JR	Z, LOC_192D
		PUSH	AF
		CALL	NUM_SEC_FILE
		POP	AF
		CP	0FFH
LOC_192D:				; CODE XREF: RD_FILE+3J
		PUSH	AF
		CALL	Z, RD_SECTORS
		POP	AF
		JR	Z, LOC_1937
		JP	COM_06
; ---------------------------------------------------------------------------
LOC_1937:				; CODE XREF: RD_FILE+11J
		LD	A, (TRD_5CD6)	; #FF-   
		CP	3
		CALL	Z, RD_OR_VERIFY
		LD	HL, (E_LINE)
		DEC	HL
		LD	(HL), 80H
		RET
; END OF FUNCTION RD_FILE
; =============== S U B	R O U T	I N E =======================================
RD_OR_VERIFY:				; CODE XREF: RD_FILE+1BP
; FUNCTION CHUNK AT 2FDE SIZE 00000015 BYTES
		LD	A, (TRD_5CF9)
		CP	0FFH
		JP	NZ, LOAD_END_FILE
		LD	A, (TRD_5CDB)
		OR	A
		RET	Z
		LD	C, A
		LD	B, 1
		LD	DE, (TRD_5CF4)
		JR	LOC_196A
; END OF FUNCTION RD_OR_VERIFY
; =============== S U B	R O U T	I N E =======================================
RD_SECTORS:				; CODE XREF: RD_FILE+DP
		LD	A, (TRD_5CF9)
		CP	0FFH
		JP	NZ, COM_05
		LD	(TRD_5CF4), DE
		LD	C, 0
LOC_196A:				; CODE XREF: RD_OR_VERIFY+14J
		LD	A, B
		OR	A
		RET	Z
		LD	(TRD_5CD7), HL
		LD	(TRD_5CD9), DE
LOC_1974:				; CODE XREF: RD_SECTORS+3EJ
		PUSH	BC
		LD	B, 1
		LD	DE, (TRD_5CD9)
		LD	HL, TRD_5D25
		CALL	COM_05
		LD	HL, (TRD_5CF4)
		LD	(TRD_5CD9), HL
		POP	BC
		LD	HL, (TRD_5CD7)
		LD	DE, TRD_5D25
LOC_198E:				; CODE XREF: RD_SECTORS+39J
		LD	A, (DE)
		CP	(HL)
		JR	NZ, LOC_199D
		INC	HL
		INC	DE
		DEC	C
		JR	NZ, LOC_198E
		LD	(TRD_5CD7), HL
		DJNZ	LOC_1974
		RET
; ---------------------------------------------------------------------------
LOC_199D:				; CODE XREF: RD_SECTORS+34J
		LD	HL, ASC_276B	; "VERIFY ERROR."
		LD	A, 0DH
		JP	PRINT_TXTERR
; END OF FUNCTION RD_SECTORS
; ---------------------------------------------------------------------------
PEEK:					; DATA XREF: ROM:301AO
		LD	A, 0FFH
		JR	LOC_19AB
; ---------------------------------------------------------------------------
POKE:					; DATA XREF: ROM:301CO
		LD	A, 0EEH
LOC_19AB:				; CODE XREF: ROM:19A7J
		LD	(TRD_5D10), A	;   
		JP	LOC_1818
; ---------------------------------------------------------------------------
MERGE:					; DATA XREF: ROM:301EO
		LD	A, 0FFH
		LD	(TRD_5D1F), A
		CALL	GET_PARAMS
		CALL	EXIT_IF_SINTAX
		LD	A, (TRD_5CE5)	;  
		CP	42H
		JP	NZ, SINTAX_ERROR
		LD	BC, (TRD_5CE6)	;  <C>- , <B>-	
		LD	(TRD_5CDB), BC
		PUSH	BC
		INC	BC
		RST	20H
; ---------------------------------------------------------------------------
		DW 30H			;   
; ---------------------------------------------------------------------------
		LD	(HL), 80H
		EX	DE, HL
		POP	DE
		PUSH	HL
		LD	DE, (TRD_5CEB)	; 			
		CALL	LOAD_FULLFILE
		LD	A, (TRD_5CDC)
		LD	B, A
		CALL	ZERO2HIGH_ERR
		CALL	RD_FILE
		POP	HL
		LD	DE, (PROG)
		RST	20H
; ---------------------------------------------------------------------------
		DW 8D2H			;      
; ---------------------------------------------------------------------------
		JP	ERR_OK
; =============== S U B	R O U T	I N E =======================================
CP_FREE4PROG:				; CODE XREF: LOAD4BASIC:LOC_1A31P
					; LOAD4DATA+15P
		EX	DE, HL
		SCF
		SBC	HL, DE
		RET	C
		LD	DE, 0AH
		ADD	HL, DE
		LD	B, H
		LD	C, L
; END OF FUNCTION CP_FREE4PROG
; =============== S U B	R O U T	I N E =======================================
SUB_19FD:				; CODE XREF: CREATE_BUF+10P
		RST	20H
; ---------------------------------------------------------------------------
		DW 1F05H		;   
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION SUB_19FD
; =============== S U B	R O U T	I N E =======================================
LOAD4BASIC:				; CODE XREF: CP_PARAMS+5EP
		LD	DE, (PROG)
		LD	HL, (E_LINE)
		DEC	HL
		PUSH	HL
		PUSH	DE
		SBC	HL, DE
		LD	DE, (TRD_5CE6)	;  <C>- , <B>-	
		PUSH	DE
		PUSH	HL
		LD	HL, 0
		LD	A, (TRD_5CF9)
		CP	0FFH
		JR	Z, LOC_1A20
		LD	HL, 5
LOC_1A20:				; CODE XREF: LOAD4BASIC+1AJ
		ADD	HL, DE
		LD	(TRD_5CDB), HL
		POP	HL
		LD	A, (TRD_5CF9)
		CP	0FFH
		JR	NZ, LOC_1A31
		POP	DE
		POP	DE
		POP	HL
		JR	LOC_1A48
; ---------------------------------------------------------------------------
LOC_1A31:				; CODE XREF: LOAD4BASIC+29J
		CALL	CP_FREE4PROG
		POP	BC
		POP	DE
		POP	HL
		PUSH	BC
		RST	20H
; ---------------------------------------------------------------------------
		DW 19E5H		; 
; ---------------------------------------------------------------------------
		POP	BC
		CALL	RESERV_RAM
		INC	HL
		LD	BC, (TRD_5CE8)	; 	
		ADD	HL, BC
		LD	(VARS),	HL
LOC_1A48:				; CODE XREF: LOAD4BASIC+2EJ
		LD	HL, (PROG)
		RET
; END OF FUNCTION LOAD4BASIC
; =============== S U B	R O U T	I N E =======================================
LOAD4DATA:				; CODE XREF: CP_PARAMS+64P
		LD	DE, (TRD_5CE8)	; 	
		LD	(TRD_5CDB), DE
		LD	HL, (TRD_5CD7)
		LD	A, (TRD_5CF9)
		CP	0FFH
		RET	Z
		LD	HL, (TRD_5CD9)
		PUSH	HL
		CALL	CP_FREE4PROG
		POP	HL
		LD	A, H
		OR	L
		JR	Z, LOC_1A79
		LD	HL, (TRD_5CD7)
		DEC	HL
		DEC	HL
		DEC	HL
		LD	BC, (TRD_5CD9)
		INC	BC
		INC	BC
		INC	BC
		CALL	DEL_WORKRAM
LOC_1A79:				; CODE XREF: LOAD4DATA+1BJ
		LD	HL, (E_LINE)
		DEC	HL
		LD	BC, (TRD_5CE8)	; 	
		PUSH	BC
		INC	BC
		INC	BC
		INC	BC
		CALL	RESERV_RAM
		INC	HL
		LD	A, (TRD_5CD2)
		LD	(HL), A
		INC	HL
		POP	DE
		LD	(HL), E
		INC	HL
		LD	(HL), D
		INC	HL
		RET
; END OF FUNCTION LOAD4DATA
; =============== S U B	R O U T	I N E =======================================
NUM_SEC_FILE:				; CODE XREF: RD_FILE+6P
		LD	A, (TRD_5CD9)
		LD	C, B
		LD	B, A
		LD	A, C
		CP	B
		JR	C, LOC_1AB6
		LD	A, B
		OR	A
		JP	Z, SINTAX_ERROR
		DEC	B
		JR	Z, LOC_1AB0
		LD	A, 10H
LOC_1AA7:				; CODE XREF: NUM_SEC_FILE:LOC_1AAEJ
		INC	E
		CP	E
		JR	NZ, LOC_1AAE
		LD	E, 0
		INC	D
LOC_1AAE:				; CODE XREF: NUM_SEC_FILE+15J
		DJNZ	LOC_1AA7
LOC_1AB0:				; CODE XREF: NUM_SEC_FILE+FJ
		LD	B, 1
		LD	HL, (TRD_5CD7)
		RET
; ---------------------------------------------------------------------------
LOC_1AB6:				; CODE XREF: NUM_SEC_FILE+7J
		LD	HL, TXT_R_O
		LD	A, 5
		JP	PRINT_TXTERR
; END OF FUNCTION NUM_SEC_FILE
; =============== S U B	R O U T	I N E =======================================
CP_FILE_FREE:				; CODE XREF: ROM:1B21P	ROM:1B2EP ...
		CALL	FIND_FILE
		JP	Z, FILE_EXISTS
CP_FREE_ON_DSK:				; CODE XREF: CREATE_BLOCK+6P ROM:28F5P ...
		CALL	READ_9SEC
		LD	A, (TRD_5E09)
		CP	80H
		JP	Z, LOC_2723
		RET
; END OF FUNCTION CP_FILE_FREE
; ---------------------------------------------------------------------------
SAVE:					; DATA XREF: ROM:3016O
		CALL	ZERO2HIGH_ERR
		LD	HL, 0
		LD	(TRD_5CD1), HL
		CALL	SET_AND_PUT
		CALL	GET_SYMSTR
		CP	0AFH
		JR	Z, LOC_1B39
		CP	0CAH
		JR	NZ, LOC_1AF8
		CALL	SET_NUM_CHAN
		CALL	EXIT_IF_SINTAX
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CD1), HL
		LD	HL, TRD_5CE5	;  
		JR	LOC_1B1F
; ---------------------------------------------------------------------------
LOC_1AF8:				; CODE XREF: ROM:1AE5J
		CP	0AAH
		JR	NZ, LOC_1B0D
		LD	HL, 4000H
		LD	(TRD_5CD7), HL
		LD	HL, 1B00H
		LD	(TRD_5CD9), HL
		LD	(TRD_5CDB), HL
		JR	LOC_1B48
; ---------------------------------------------------------------------------
LOC_1B0D:				; CODE XREF: ROM:1AFAJ
		CALL	EXIT_IF_SINTAX
		CALL	GET_SYMSTR
		LD	HL, TRD_5CE5	;  
		CP	0E4H
		JR	Z, LOC_1B2C
		CP	0DH
		JP	NZ, SINTAX_ERROR
LOC_1B1F:				; CODE XREF: ROM:1AF6J
		LD	(HL), 42H ; 'B'
		CALL	CP_FILE_FREE
		CALL	DEL_5BYTES
LOC_1B27:				; CODE XREF: ROM:28F8J
		CALL	SET_START_SIZE
		JR	LOC_1B53
; ---------------------------------------------------------------------------
LOC_1B2C:				; CODE XREF: ROM:1B18J
		LD	(HL), 44H ; 'D'
		CALL	CP_FILE_FREE
		CALL	CP_MASSIV
		JR	NC, LOC_1B53
		JP	C, SINTAX_ERROR
LOC_1B39:				; CODE XREF: ROM:1AE1J
		CALL	GET_START_SIZE
		LD	HL, (TRD_5CD9)
		LD	(TRD_5CD7), HL
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CD9), HL
LOC_1B48:				; CODE XREF: ROM:1B0BJ
		CALL	EXIT_IF_SINTAX
		LD	A, 43H ; 'C'
		LD	(TRD_5CE5), A	;  
		CALL	CP_FILE_FREE
LOC_1B53:				; CODE XREF: ROM:1B2AJ	ROM:1B34J ...
		CALL	SAVE_FILE
		JP	LOC_569
; =============== S U B	R O U T	I N E =======================================
SAVE_FILE:				; CODE XREF: ROM:LOC_1B53P
					; CREATE_BLOCK+9P
		LD	HL, (TRD_5CD7)
		LD	(TRD_5CE6), HL	;  <C>- , <B>-	
		EX	DE, HL
		LD	HL, (TRD_5CD9)
		LD	A, L
		OR	H
		JP	Z, SINTAX_ERROR
		LD	A, L
		OR	A
		JR	Z, LOC_1B6D
		INC	H
LOC_1B6D:				; CODE XREF: SAVE_FILE+11J
		LD	A, H
		LD	(TRD_5CEA), A	; 	 	
		LD	E, A
		LD	D, 0
		LD	HL, (TRD_5E0A)
		SBC	HL, DE
		JP	C, LOC_1C45
		PUSH	HL
		LD	HL, (E_LINE)
		LD	(HL), 0AAH
		INC	HL
		LD	DE, (TRD_5CD1)
		LD	(HL), E
		INC	HL
		LD	(HL), D
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CE8), HL	; 	
		LD	HL, (TRD_5E06)
		LD	(TRD_5CEB), HL	; 			
		EX	DE, HL
		LD	HL, (TRD_5CE6)	;  <C>- , <B>-	
		LD	A, (TRD_5CEA)	; 	 	
		LD	B, A
		CALL	COM_06
		LD	HL, (TRD_5CF4)
		PUSH	HL
		CALL	READ_9SEC
		POP	HL
		LD	(TRD_5E06), HL
		POP	HL
		LD	(TRD_5E0A), HL
		LD	HL, TRD_5E09
		LD	A, (HL)
		LD	(TRD_5D1E), A
		INC	(HL)
		PUSH	HL
		CALL	REWRITE_9SEC
		POP	HL
		LD	C, (HL)
		DEC	C
		LD	A, (TRD_5CE5)	;  
		CP	42H
		CALL	Z, SET_HEAD_STSZ
		RET
; END OF FUNCTION SAVE_FILE
; =============== S U B	R O U T	I N E =======================================
SET_HEAD_STSZ:				; CODE XREF: SAVE_FILE+6BP
		LD	HL, (E_LINE)
		LD	DE, (PROG)
		SCF
		SBC	HL, DE
		LD	(TRD_5CE6), HL	;  <C>- , <B>-	
		LD	HL, (VARS)
		SBC	HL, DE
		LD	(TRD_5CE8), HL	; 	
		RET
; END OF FUNCTION SET_HEAD_STSZ
; =============== S U B	R O U T	I N E =======================================
SET_START_SIZE:				; CODE XREF: ROM:LOC_1B27P
		LD	HL, (VARS)
		LD	DE, (PROG)
		SBC	HL, DE
		LD	(TRD_5CDB), HL
		LD	HL, (PROG)
		LD	(TRD_5CD7), HL
		LD	HL, (E_LINE)
		INC	HL
		INC	HL
		INC	HL
		SBC	HL, DE
		LD	(TRD_5CD9), HL
		RET
; END OF FUNCTION SET_START_SIZE
; =============== S U B	R O U T	I N E =======================================
READ_MASSIV:				; CODE XREF: GET_PARAMS+21P
		CALL	FIND_MASSIV
		RET	NC
		LD	HL, 0
		LD	(TRD_5CD9), HL
		LD	A, (TRD_5CF9)
		CP	0FFH
		RET	NZ
		JP	LOC_1C13
; ---------------------------------------------------------------------------
CP_MASSIV:				; CODE XREF: ROM:1B31P
		CALL	FIND_MASSIV
		RET	NC
LOC_1C13:				; CODE XREF: READ_MASSIV+10J
		LD	A, 0EH
		LD	HL, ASC_27DD	; "ARRAY NOT FOUND"
		JP	PRINT_TXTERR
; END OF FUNCTION READ_MASSIV
; =============== S U B	R O U T	I N E =======================================
FIND_MASSIV:				; CODE XREF: READ_MASSIVP
					; READ_MASSIV:CP_MASSIVP
		CALL	PRINT_NEXT_SYM
		CALL	LOOK_VARS
		SET	7, C
		LD	A, C
		LD	(TRD_5CD2), A
		JR	NC, LOC_1C2B
LOC_1C29:				; CODE XREF: FIND_MASSIV:LOC_1C2BJ
		SCF
		RET
; ---------------------------------------------------------------------------
LOC_1C2B:				; CODE XREF: FIND_MASSIV+CJ
					; FIND_MASSIV+27J
		JR	NZ, LOC_1C29
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		INC	HL
		LD	(TRD_5CD7), HL
		LD	(TRD_5CDB), DE
		LD	(TRD_5CD9), DE
		CALL	PRINT_NEXT_SYM
		CP	29H ; ')'
		JR	NZ, LOC_1C2B
		RET
; END OF FUNCTION FIND_MASSIV
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR COPY_FILE_ON2DSK
LOC_1C45:				; CODE XREF: COPY_FILE_ON2DSK+8J
					; COPY_FILE_ON2DSK+22J	...
		LD	HL, TXT_NOSPACE_
		LD	A, 3
; END OF FUNCTION CHUNK	FOR COPY_FILE_ON2DSK
; START	OF FUNCTION CHUNK FOR GET_NUM_TRACK
PRINT_TXTERR:				; CODE XREF: ERASE_FILE-3A3J
					; ERASE_FILE-39CJ ...
		CALL	PRINT_ERROR
		JP	END_COMAND
; END OF FUNCTION CHUNK	FOR GET_NUM_TRACK
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR CP_FREESEC
FILE_EXISTS:				; CODE XREF: ROM:0565J	CP_FREESEC+10J	...
		LD	HL, TXT_FILEEXISTS_
		LD	A, 2
		JR	PRINT_TXTERR
; END OF FUNCTION CHUNK	FOR CP_FREESEC
; =============== S U B	R O U T	I N E =======================================
SET_FILENAME:				; CODE XREF: SET_CP_FILENAMEP
					; ROM:1EDAP ...
		LD	HL, TRD_5CDD	;  
		LD	B, 8
LOC_1C5C:				; CODE XREF: SET_FILENAME+8J
		LD	(HL), 20H
		INC	HL
		DJNZ	LOC_1C5C
		CALL	CP_ON_STKBOT
		EX	DE, HL
		CALL	SETUP_DSK
		LD	A, C
		OR	A
		JP	Z, SINTAX_ERROR
		CP	9
		JR	C, LOC_1C73
		LD	C, 8
LOC_1C73:				; CODE XREF: SET_FILENAME+18J
		LD	A, (HL)
		CP	20H
		JP	C, SINTAX_ERROR
		LD	DE, TRD_5CDD	;  
		PUSH	BC
		LDIR
		POP	BC
		RET
; END OF FUNCTION SET_FILENAME
; =============== S U B	R O U T	I N E =======================================
SETUP_DSK:				; CODE XREF: ROM:0467P	ROM:05D7P ...
		INC	HL
		LD	A, (HL)
		CP	3AH
		JR	NZ, LOC_1C98
		DEC	HL
		LD	A, (HL)
		CALL	NUMDSK2BYTE
		PUSH	BC
		PUSH	HL
		CALL	COM_01
		POP	HL
		POP	BC
		DEC	BC
		DEC	BC
		INC	HL
		INC	HL
		RET
; ---------------------------------------------------------------------------
LOC_1C98:				; CODE XREF: SETUP_DSK+4J
		DEC	HL
		LD	A, (TRD_5D19)
		PUSH	BC
		PUSH	HL
		CALL	COM_01
		POP	HL
		POP	BC
		RET
; END OF FUNCTION SETUP_DSK
; =============== S U B	R O U T	I N E =======================================
FIND_HEAD_BUF:				; CODE XREF: RD_HEAD_COPY+17P
					; FIND_FILENAME+8P
		LD	L, C
		LD	H, 0
		ADD	HL, HL
		ADD	HL, HL
		ADD	HL, HL
		ADD	HL, HL
		LD	BC, TRD_5D25
		ADD	HL, BC
		RET
; END OF FUNCTION FIND_HEAD_BUF
; =============== S U B	R O U T	I N E =======================================
SET_CP_FILENAME:			; CODE XREF: ROM:0543P	ROM:0553P ...
		CALL	SET_FILENAME
; END OF FUNCTION SET_CP_FILENAME
; =============== S U B	R O U T	I N E =======================================
FIND_FILENAME:				; CODE XREF: CP_EXT_SHARP+EP ROM:0625P ...
		CALL	RD_0SEC2BUF
		LD	B, 80H
		LD	C, 0
LOC_1CBA:				; CODE XREF: FIND_FILENAME+18J
					; FIND_FILENAME+2FJ
		PUSH	BC
		CALL	FIND_HEAD_BUF
		CALL	CP_END_BUF
		POP	BC
		PUSH	BC
		LD	A, C
		CP	10H
		JR	NZ, LOC_1CCD
		POP	BC
		LD	C, 0
		JR	LOC_1CBA
; ---------------------------------------------------------------------------
LOC_1CCD:				; CODE XREF: FIND_FILENAME+13J
		LD	DE, TRD_5CDD	;  
		LD	A, (TRD_5D06)	;      
		LD	B, A
		XOR	A
		CP	(HL)
		JR	NZ, LOC_1CDB
		POP	BC
		JR	LOC_1CE4
; ---------------------------------------------------------------------------
LOC_1CDB:				; CODE XREF: FIND_FILENAME+23J
		CALL	PRINT_MSG_B_
		POP	BC
		JR	Z, LOC_1CE7
		INC	C
		DJNZ	LOC_1CBA
LOC_1CE4:				; CODE XREF: FIND_FILENAME+26J
		OR	0FFH
		RET
; ---------------------------------------------------------------------------
LOC_1CE7:				; CODE XREF: FIND_FILENAME+2CJ
		LD	A, 80H
		SUB	B
		LD	C, A
		LD	(TRD_5D1E), A
		XOR	A
		RET	Z
COM_0A:					; DATA XREF: ROM:28ABO
		CALL	FIND_FILENAME
		LD	HL, TRD_5D0F	; 	 TR-DOS
		LD	(HL), C
		RET	Z
		LD	(HL), 0FFH
		RET
; END OF FUNCTION FIND_FILENAME
; ---------------------------------------------------------------------------
RETURN:					; DATA XREF: ROM:3018O
		CALL	EXIT_IF_SINTAX
		CALL	DELETE_BUF
		RES	3, (IY+1)
		CALL	RESTORE_SP
		LD	SP, (TRD_5D1C)	;   SP
		LD	HL, (ERR_SP)
		DEC	HL
		LD	A, 12H
		CP	(HL)
		JR	NZ, LOCRET_1D19
		DEC	HL
		LD	(ERR_SP), HL
LOCRET_1D19:				; CODE XREF: ROM:1D13J
		RET
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR NUMDSK2BYTE
SINTAX_ERROR:				; CODE XREF: ROM:0452J	ROM:0482J ...
		BIT	7, (IY+0)
		JR	Z, LOC_1D25
		LD	A, 0BH
		LD	(ERR_NR), A
LOC_1D25:				; CODE XREF: NUMDSK2BYTE+17FAJ
		INC	A
		LD	HL, TXT_ERROR_
; END OF FUNCTION CHUNK	FOR NUMDSK2BYTE
; START	OF FUNCTION CHUNK FOR COM_05
LOC_1D29:				; CODE XREF: ROM:1D37J	ROM:1D3BJ ...
		CALL	PRINT_ERROR
		JP	END_COMAND
; END OF FUNCTION CHUNK	FOR COM_05
; ---------------------------------------------------------------------------
LOC_1D2F:				; CODE XREF: ROM:2F6FJ
		LD	A, (ERR_NR)
		LD	HL, ASC_27CA	; "*BREAK*"
		CP	14H
		JR	Z, LOC_1D29
		CP	0CH
		JR	Z, LOC_1D29
		LD	HL, ASC_27D2	; "OUT OF RAM"
		CP	3
		JR	Z, LOC_1D29
		LD	HL, ASC_27DD	; "ARRAY NOT FOUND"
		CP	1
		JR	Z, LOC_1D29
		JR	SINTAX_ERROR
; ---------------------------------------------------------------------------
RUN:					; DATA XREF: ROM:3020O
		CALL	ZERO2HIGH_ERR
		CALL	LOAD_FILE
		CALL	EXIT_IF_SINTAX
		LD	HL, (TRD_5CE6)	;  <C>- , <B>-	
		LD	A, (TRD_5CE5)	;  
		CP	42H
		JP	Z, LOC_12A
		PUSH	HL
		RET
; =============== S U B	R O U T	I N E =======================================
CLEAR_WORKSPACE:			; CODE XREF: GET_NUM_TRACK-3CD6P
		LD	HL, TRD_5D0E	; #FE- BASIC, TR-DOS
		LD	A, (HL)
LOC_1D67:
		CP	0FFH
		LD	(HL), 0
		RET	NZ
		RST	20H
; ---------------------------------------------------------------------------
		DW 16BFH		;      
; ---------------------------------------------------------------------------
		RET
; ---------------------------------------------------------------------------
CP_SINTAX:				; CODE XREF: EXIT_IF_SINTAXP
					; CHISLO2STKBOT+6J
		BIT	7, (IY+1)
		RET
; END OF FUNCTION CLEAR_WORKSPACE
; =============== S U B	R O U T	I N E =======================================
EXIT_IF_SINTAX:				; CODE XREF: ROM:LOC_460P ROM:LOC_46AP ...
		CALL	CP_SINTAX
		RET	NZ
		POP	HL
		RET
; END OF FUNCTION EXIT_IF_SINTAX
; =============== S U B	R O U T	I N E =======================================
CHISLO2STKBOT:				; CODE XREF: INPUT_PARAMSP
					; SET_NUM_CHANP
		CALL	PRINT_NEXT_SYM
		CALL	BC2STKBOT
		JR	CP_SINTAX
; END OF FUNCTION CHISLO2STKBOT
; =============== S U B	R O U T	I N E =======================================
OPEN_CHAN_0:				; CODE XREF: ROM:02D4P
					; GET_COMMAND:LOC_1D90P
		XOR	A
OPENSTREAM:				; CODE XREF: ROM:0485P	ROM:1220P ...
		RST	20H
; END OF FUNCTION OPEN_CHAN_0
; ---------------------------------------------------------------------------
		DW 1601H		;  
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
OPEN_CHAN_2:				; CODE XREF: ROM:025CP
		LD	A, 2
		JR	OPENSTREAM
; END OF FUNCTION OPEN_CHAN_2
; =============== S U B	R O U T	I N E =======================================
GET_SYMSTR:				; CODE XREF: FIND_ENDSTRP ROM:0449P ...
		RST	20H
; END OF FUNCTION GET_SYMSTR
; ---------------------------------------------------------------------------
		DW 18H			;    (CH_ADD)
; ---------------------------------------------------------------------------
		RET
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR GET_COMMAND
LOC_1D90:				; CODE XREF: GET_COMMAND+20J
		CALL	OPEN_CHAN_0
		RST	20H
; ---------------------------------------------------------------------------
		DW 0F2CH		;   
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION CHUNK	FOR GET_COMMAND
; =============== S U B	R O U T	I N E =======================================
CLEAR_SCREEN:				; CODE XREF: ROM:012DP	ROM:0259P ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 0D6BH		;  
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION CLEAR_SCREEN
; =============== S U B	R O U T	I N E =======================================
LOOK_VARS:				; CODE XREF: FIND_MASSIV+3P
		RST	20H
; ---------------------------------------------------------------------------
		DW 28B2H		; LOOK-VARS.    
; END OF FUNCTION LOOK_VARS
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
CLEAR_DOWN_SCR:				; CODE XREF: GET_PARAMS:LOC_2EFP
					; ROM:137CP ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 0D6EH		;    
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION CLEAR_DOWN_SCR
; =============== S U B	R O U T	I N E =======================================
PRINT_CHISLO_A_:			; CODE XREF: ROM:04A0P	ROM:126BP ...
		LD	C, A
CONV2_2BYTES:				; CODE XREF: ROM:04A9P	ROM:1295P
		LD	B, 0
		JP	PRINT_CHISLO
PRINT_CHISLO:				; CODE XREF: CP_END_DIR-13DP ROM:04E9P ...
		PUSH	BC
		CALL	CP_INTERFACE1
		POP	BC
		RST	20H
; ---------------------------------------------------------------------------
		DW 1A1BH		;     
; ---------------------------------------------------------------------------
		CALL	CP_INTERFACE1
		RET
; END OF FUNCTION PRINT_CHISLO_A_
; =============== S U B	R O U T	I N E =======================================
GET_STKBOT_:				; CODE XREF: ROM:0463P	CP_ON_STKBOTP ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 2BF1H		;    
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION GET_STKBOT_
; =============== S U B	R O U T	I N E =======================================
FIND_LAST:				; CODE XREF: INPUT_PARAMS+5P
					; SET_NUM_CHAN+4P ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 1E99H		; 	  
; END OF FUNCTION FIND_LAST
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
PUT_NUMDSK_STK:				; CODE XREF: ROM:0458P	ROM:11F3P ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 1C8CH
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION PUT_NUMDSK_STK
; =============== S U B	R O U T	I N E =======================================
BC2STKBOT:				; CODE XREF: CHISLO2STKBOT+3P
					; WORK_NUMSAVE+13P ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 1C82H
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION BC2STKBOT
; =============== S U B	R O U T	I N E =======================================
SET_CH_ADD:				; CODE XREF: ROM:COPY_SP SET_AND_PUTP
		LD	HL, (TRD_5D11)
		INC	HL
		LD	(CH_ADD), HL
		RET
; END OF FUNCTION SET_CH_ADD
; =============== S U B	R O U T	I N E =======================================
INPUT_2STR2STKBOT:			; CODE XREF: ROM:NEWP ROM:06A1P
		CALL	SET_AND_PUT
LOC_1DD0:				; CODE XREF: ROM:218BP
		CALL	GET_SYMSTR
		CP	2CH ; ','
		JP	NZ, SINTAX_ERROR
		CALL	PRINT_NEXT_SYM
		CALL	PUT_NUMDSK_STK
		RET
; END OF FUNCTION INPUT_2STR2STKBOT
; =============== S U B	R O U T	I N E =======================================
SET_AND_PUT:				; CODE XREF: ROM:CODESP
					; ERASE_FILE:ERASEP ...
		CALL	SET_CH_ADD
		JP	PUT_NUMDSK_STK
; END OF FUNCTION SET_AND_PUT
; =============== S U B	R O U T	I N E =======================================
GET_START_SIZE:				; CODE XREF: ROM:LOC_1B39P
		CALL	GET_SYMSTR
		CP	0AFH
		RET	NZ
; END OF FUNCTION GET_START_SIZE
; =============== S U B	R O U T	I N E =======================================
INPUT_PARAMS:				; CODE XREF: GET_LOAD_CODE+DP
					; SUB_1857:LOC_1866P
		CALL	CHISLO2STKBOT
		JR	Z, LOC_1DFB
		CALL	FIND_LAST
		LD	(TRD_5CD9), BC
		LD	(TRD_5CDB), BC
LOC_1DFB:				; CODE XREF: INPUT_PARAMS+3J
		CALL	GET_SYMSTR
		CP	2CH
		JR	Z, SET_NUM_CHAN
		CP	0DH
		JP	NZ, SINTAX_ERROR
		CALL	EXIT_IF_SINTAX
		RET
; END OF FUNCTION INPUT_PARAMS
; =============== S U B	R O U T	I N E =======================================
SET_NUM_CHAN:				; CODE XREF: ROM:0446P	ROM:11E1P ...
		CALL	CHISLO2STKBOT
		RET	Z
		CALL	FIND_LAST
		LD	(TRD_5CDB), BC
		LD	A, 3
		LD	(TRD_5CD6), A	; #FF-   
		RET
; END OF FUNCTION SET_NUM_CHAN
; =============== S U B	R O U T	I N E =======================================
DEL_5BYTES:				; CODE XREF: GET_NUM_TRACK-3CC5P
					; ROM:1B24P
		LD	HL, (TRD_5D11)
		RST	20H
; ---------------------------------------------------------------------------
		DW 11A7H		;   	P  
; ---------------------------------------------------------------------------
		RET
; ---------------------------------------------------------------------------
CREATE_FREERAM:				; CODE XREF: CREATE_222BYTES+9J
					; RESERVED_RAM+EJ ...
		LD	HL, (WORKSP)
		RST	20H
; ---------------------------------------------------------------------------
		DW 30H			;   
; END OF FUNCTION DEL_5BYTES
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
PRINT_NEXT_SYM:				; CODE XREF: FIND_ENDSTR+6P ROM:0455P	...
		RST	20H
; ---------------------------------------------------------------------------
		DW 20H			;   
; END OF FUNCTION PRINT_NEXT_SYM
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
DEL_WORKRAM:				; CODE XREF: ROM:1772P	LOAD4DATA+2AP ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 19E8H		;   
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION DEL_WORKRAM
; =============== S U B	R O U T	I N E =======================================
RESERV_RAM:				; CODE XREF: LOAD4BASIC+3BP
					; LOAD4DATA+39P ...
		RST	20H
; ---------------------------------------------------------------------------
		DW 1655H
; END OF FUNCTION RESERV_RAM
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
WR_NUM_TRACK:				; CODE XREF: COM_05+30P
					; ACTIV_DEF_DSK:LOC_3DFAP
		CALL	GET_NUM_TRACK
		LD	A, H
		OUT	(3FH), A
		RET
; END OF FUNCTION WR_NUM_TRACK
; =============== S U B	R O U T	I N E =======================================
COM_05:					; CODE XREF: READ_9SEC-3J
					; COPY_FILE+26P ...
; FUNCTION CHUNK AT 1D29 SIZE 00000006 BYTES
		XOR	A
		JR	LOC_1E64
; ---------------------------------------------------------------------------
WR_HEAD_FILENAME:			; CODE XREF: ERASE_FILE+55P ROM:16F1P	...
		CALL	SET_HEAD_FILENAME
REWRITE_9SEC:				; CODE XREF: ROM:01D0P	ROM:056CP ...
		LD	DE, (TRD_5CF4)
		DEC	DE
		LD	B, 1
		LD	HL, TRD_5D25
COM_06:					; CODE XREF: COPY_FILE+3BP
					; COPY_ON1DSK_+6EP ...
		PUSH	HL
		PUSH	DE
		CALL	GET_TYPE_DSK
		BIT	7, (HL)
		JR	Z, LOC_1E60
		BIT	0, (HL)
		JR	NZ, LOC_1E60
		LD	HL, READ_ONLY
		JP	LOC_1D29
; ---------------------------------------------------------------------------
LOC_1E60:				; CODE XREF: COM_05+17J COM_05+1BJ
		POP	DE
		POP	HL
SAVE_SECTORS:				; CODE XREF: ROM:1F88P
		LD	A, 0FFH
LOC_1E64:				; CODE XREF: COM_05+1J
		LD	(TRD_5CCE), A	; #00- ,#FF-	
LOC_1E67:				; CODE XREF: LOAD_SEC2BUF+5J
		LD	(TRD_5CF4), DE
		PUSH	BC
		PUSH	HL
		CALL	WR_NUM_TRACK
		POP	HL
		POP	BC
		XOR	A
		OR	B
		RET	Z
LOC_1E75:				; CODE XREF: COM_05+6CJ
		PUSH	BC
		PUSH	HL
		CALL	COM_04
		LD	A, (TRD_5CF4)
		CALL	COM_03
		LD	A, (TRD_5CF5)
		CALL	COM_02
		LD	A, (TRD_5CCE)	; #00- ,#FF-	
		OR	A
		PUSH	AF
		CALL	Z, LOAD_SECTOR
		POP	AF
		CALL	NZ, SAVE_SECTOR
		POP	HL
		LD	DE, 100H
		ADD	HL, DE
		PUSH	HL
		LD	A, 10H
		LD	HL, TRD_5CF4
		INC	(HL)
		CP	(HL)
		JR	NZ, LOC_1EA7
		LD	(HL), 0
		LD	HL, TRD_5CF5
		INC	(HL)
LOC_1EA7:				; CODE XREF: COM_05+62J
		POP	HL
		POP	BC
		DJNZ	LOC_1E75
		RET
; END OF FUNCTION COM_05
; =============== S U B	R O U T	I N E =======================================
KOLWO_SECS:				; CODE XREF: CP_PARAMS+4FP
		PUSH	HL
		LD	H, A
		LD	L, 0
		PUSH	HL
		SBC	HL, DE
		CALL	C, LOAD_FILLFILE
		POP	HL
		LD	A, H
		POP	HL
		RET	C
		LD	A, D
		RET
; END OF FUNCTION KOLWO_SECS
; =============== S U B	R O U T	I N E =======================================
LOAD_FILLFILE:				; CODE XREF: KOLWO_SECS+7P
		XOR	A
		LD	(TRD_5CD6), A	; #FF-   
		SCF
		RET
; END OF FUNCTION LOAD_FILLFILE
; ---------------------------------------------------------------------------
FORMAT:					; DATA XREF: ROM:300CO
		LD	HL, 0FFFFH
		LD	(TRD_5CD7), HL
		LD	(TRD_5CD9), HL
		LD	(TRD_5CD1), HL
		CALL	CP_SECOND_SYM
		JP	Z, SINTAX_ERROR
		CALL	SET_AND_PUT
		CALL	EXIT_IF_SINTAX
		CALL	SET_FILENAME
		CALL	GET_TYPE_DSK
		AND	80H
		LD	A, 28H
		JR	Z, LOC_1EE8
		LD	A, 50H
LOC_1EE8:				; CODE XREF: ROM:1EE4J
		LD	(TRD_5CD7), A
		CALL	COM_00
		CALL	COM_17
		CALL	PAUSE_3_C_A
		LD	E, 1
		CALL	FORMAT_TREK
		CALL	COM_16
		LD	E, 0
		CALL	FORMAT_TREK
		LD	A, (TRD_5CDD)	;  
		CP	24H
		JR	Z, LOC_1F1B
		CALL	COM_17
		CALL	PAUSE_3_C_A
		CALL	LOC_3EB5
		LD	A, H
		CP	1
		JR	NZ, LOC_1F1B
		LD	A, 80H
		LD	(TRD_5CDA), A
LOC_1F1B:				; CODE XREF: ROM:1F06J	ROM:1F14J
		CALL	FORMAT_DISK
		LD	HL, TRD_5D25
		LD	(HL), 0
		LD	DE, TRD_5D26
		LD	BC, 0FFH
		LDIR
		LD	BC, TRD_5CD7
		LD	DE, TRD_5CDA
		LD	A, (BC)
		CP	50H
		JR	Z, LOC_1F49
		LD	A, (DE)
		CP	80H
		JR	Z, LOC_1F42
		LD	A, 19H
		LD	HL, 270H
		JR	LOC_1F55
; ---------------------------------------------------------------------------
LOC_1F42:				; CODE XREF: ROM:1F39J
		LD	A, 17H
LOC_1F44:				; CODE XREF: ROM:1F4EJ
		LD	HL, 4F0H
		JR	LOC_1F55
; ---------------------------------------------------------------------------
LOC_1F49:				; CODE XREF: ROM:1F34J
		LD	A, (DE)
		CP	80H
		LD	A, 18H
		JR	NZ, LOC_1F44
		LD	A, 16H
		LD	HL, 9F0H
LOC_1F55:				; CODE XREF: ROM:1F40J	ROM:1F47J
		LD	(TRD_5E08), A
		LD	(TRD_5E0A), HL
		LD	A, 1
		LD	(TRD_5E07), A
		LD	A, 10H
		LD	(TRD_5E0C), A
		LD	HL, TRD_5E0F
		LD	DE, TRD_5E10
		LD	BC, 8
		LD	(HL), 20H
		LDIR
		LD	HL, TRD_5CDD	;  
		LD	DE, TRD_5E1A
		LD	BC, 8
		LDIR
		CALL	COM_16
		LD	B, 1
		LD	DE, 8
		LD	HL, TRD_5D25
		CALL	SAVE_SECTORS
		LD	A, (TRD_5CD6)	; #FF-   
		PUSH	AF
		XOR	A
		LD	(TRD_5CE5), A	;  
		LD	HL, (TRD_5E0A)
		LD	(TRD_5CD7), HL
		LD	HL, TRD_5CDD	;  
		RST	18H
		LD	A, 0DH
		RST	10H
		LD	HL, (TRD_5CD7)
		POP	AF
		PUSH	HL
		LD	D, 0
		LD	E, A
		SBC	HL, DE
		LD	B, H
		LD	C, L
		CALL	PRINT_CHISLO
		LD	A, 2FH
		RST	10H
		POP	BC
		CALL	PRINT_CHISLO
		JP	END_COMAND
; ---------------------------------------------------------------------------
TABL_SECTORS:	DB 1, 9, 2, 0AH, 3, 0BH, 4, 0CH, 5, 0DH, 6, 0EH, 7, 0FH
					; DATA XREF: FORMAT_TREK+5O
					; FORMAT_TREK+8AO
		DB 8, 10H, 1
; =============== S U B	R O U T	I N E =======================================
CP_DSK_TRACK:				; CODE XREF: ACTIV_DEF_DSK+25P
		CALL	GET_TIME_HEAD
		OR	11H
		LD	B, A
		LD	A, 32H
		CALL	HEAD_POSITION
		LD	A, 2
		CALL	HEAD_POSITION
		CALL	PAUSE725779TAKTS
		IN	A, (1FH)
		AND	4
		LD	A, 50H
		JR	Z, LOC_1FE7
		LD	A, 28H
LOC_1FE7:				; CODE XREF: CP_DSK_TRACK+19J
		LD	(TRD_5CD7), A
		RET
; END OF FUNCTION CP_DSK_TRACK
; =============== S U B	R O U T	I N E =======================================
COM_16:					; CODE XREF: ROM:1EF9P	ROM:1F7DP ...
		LD	A, (TRD_5D16)
		OR	3CH
LOC_1FF0:				; CODE XREF: COM_17+5J
		LD	(TRD_5D16), A
		OUT	(0FFH),	A
		RET
; END OF FUNCTION COM_16
; =============== S U B	R O U T	I N E =======================================
COM_17:					; CODE XREF: ROM:1EEEP	ROM:1F08P ...
		LD	A, (TRD_5D16)
		AND	6FH
		JR	LOC_1FF0
; END OF FUNCTION COM_17
; =============== S U B	R O U T	I N E =======================================
FORMAT_TREK:				; CODE XREF: ROM:1EF6P	ROM:1EFEP ...
		DI
		LD	A, 0F4H
		OUT	(1FH), A
		LD	HL, TABL_SECTORS
		LD	C, 7FH
LOC_2007:				; CODE XREF: FORMAT_TREK+6CJ
		LD	B, 0AH
		LD	D, 4EH
		CALL	WRITE_C_D_B
		LD	B, 0CH
		LD	D, 0
		CALL	WRITE_C_D_B
		LD	B, 3
		LD	D, 0F5H
		CALL	WRITE_C_D_B
		LD	D, 0FEH
		CALL	WRITE_C_D_1
		LD	D, E
		CALL	WRITE_C_D_1
		LD	D, 0
		CALL	WRITE_C_D_1
		LD	D, (HL)
		CALL	WRITE_C_D_1
		LD	D, 1
		CALL	WRITE_C_D_1
		LD	D, 0F7H
		CALL	WRITE_C_D_1
		LD	B, 16H
		LD	D, 4EH
		CALL	WRITE_C_D_B
		LD	B, 0CH
		LD	D, 0
		CALL	WRITE_C_D_B
		LD	B, 3
		LD	D, 0F5H
		CALL	WRITE_C_D_B
		LD	D, 0FBH
		CALL	WRITE_C_D_1
		LD	B, 0
		LD	D, 0
		CALL	WRITE_C_D_B
		LD	D, 0F7H
		CALL	WRITE_C_D_1
		LD	B, 32H
		LD	D, 4EH
		CALL	WRITE_C_D_B
		LD	A, (HL)
		INC	HL
		CP	10H
		JR	NZ, LOC_2007
		LD	B, 0
		CALL	WRITE_C_D_B
		JP	M, LOC_2076
		CALL	WRITE_C_D_B
LOC_2076:				; CODE XREF: FORMAT_TREK+73J
		IN	A, (1FH)
		AND	40H
		JP	NZ, LOC_3F39	; READ ONLY
CP_NUM_TRACK:				; CODE XREF: ROM:2758P
		LD	A, (TRD_5CD8)
		OR	A
		RET	NZ
		LD	C, 7FH
		LD	A, E
		OUT	(3FH), A
		LD	HL,  TABL_SECTORS+1
LOC_208A:				; CODE XREF: FORMAT_TREK+AEJ
		LD	B, 3
		LD	A, (HL)
		OUT	(5FH), A
		PUSH	HL
LOC_2090:				; CODE XREF: FORMAT_TREK+A3J
		DI
		LD	A, 80H
		OUT	(1FH), A
		PUSH	BC
		CALL	RD_DATAPORT
		IN	A, (1FH)
		AND	7FH
		POP	BC
		JR	Z, LOC_20A6
		DJNZ	LOC_2090
		LD	HL, TRD_5CD6	; #FF-   
		INC	(HL)
LOC_20A6:				; CODE XREF: FORMAT_TREK+A1J
		POP	HL
		LD	A, (HL)
		INC	HL
		CP	1
		JR	NZ, LOC_208A
		EI
		RET
; END OF FUNCTION FORMAT_TREK
; =============== S U B	R O U T	I N E =======================================
WRITE_C_D_1:				; CODE XREF: FORMAT_TREK+21P
					; FORMAT_TREK+25P ...
		LD	B, 1
; END OF FUNCTION WRITE_C_D_1
; =============== S U B	R O U T	I N E =======================================
WRITE_C_D_B:				; CODE XREF: FORMAT_TREK+EP
					; FORMAT_TREK+15P ...
		IN	A, (0FFH)
		AND	0C0H
		JR	Z, WRITE_C_D_B
		RET	M
		OUT	(C), D
		DJNZ	WRITE_C_D_B
		RET
; END OF FUNCTION WRITE_C_D_B
; =============== S U B	R O U T	I N E =======================================
FORMAT_DISK:				; CODE XREF: ROM:LOC_1F1BP
		LD	HL, TRD_5CD7
		LD	B, (HL)
		XOR	A
		INC	HL
		LD	(HL), A
		LD	E, 0FFH
LOC_20C6:				; CODE XREF: FORMAT_DISK+25J
		PUSH	BC
		INC	E
		LD	A, E
		LD	B, 1BH
		CALL	HEAD_POSITION
		CALL	COM_16
		CALL	FORMAT_TREK
		LD	A, (TRD_5CDA)
		CP	80H
		JR	NZ, LOC_20E1
		CALL	COM_17
		CALL	FORMAT_TREK
LOC_20E1:				; CODE XREF: FORMAT_DISK+1CJ
		POP	BC
		DJNZ	LOC_20C6
		RET
; END OF FUNCTION FORMAT_DISK
; =============== S U B	R O U T	I N E =======================================
DELETE_BUF:				; CODE XREF: ROM:LOC_12AP
					; GET_NUM_TRACK-3CD9P ...
		PUSH	AF
		LD	A, (TRD_5CF8)
		CP	0FFH
		JR	Z, LOC_211C
		POP	AF
		CALL	DEL_BUF
; END OF FUNCTION DELETE_BUF
; =============== S U B	R O U T	I N E =======================================
CP_INTERFACE1:				; CODE XREF: ROM:LOC_16CP ROM:0278P ...
		PUSH	AF
		LD	A, (TRD_5CB6)	;    INTERFACE1
		CP	0F4H
		JR	Z, LOC_211C
		XOR	A
		LD	HL, TRD_5D18
		OR	(HL)
		LD	(HL), 0FFH
		JR	Z, LOC_211C
		LD	A, (TRD_5D0C)
		OR	A
		LD	HL, TRD_5CC3
		LD	DE, TRD_5D33
		JR	NZ, LOC_2111
		LD	DE, TRD_5E34
LOC_2111:				; CODE XREF: CP_INTERFACE1+1BJ
		LD	B, 2DH
LOC_2113:				; CODE XREF: CP_INTERFACE1+29J
		LD	C, (HL)
		LD	A, (DE)
		LD	(HL), A
		LD	A, C
		LD	(DE), A
		INC	HL
		INC	DE
		DJNZ	LOC_2113
LOC_211C:				; CODE XREF: DELETE_BUF+6J
					; CP_INTERFACE1+6J ...
		POP	AF
		RET
; END OF FUNCTION CP_INTERFACE1
; =============== S U B	R O U T	I N E =======================================
CLRBUF_EDITOR:				; CODE XREF: GET_COMMAND+9P
		LD	HL, (E_LINE)
		LD	(HL), 0DH
		LD	(K_CUR), HL
		INC	HL
		LD	(HL), 80H
		RET
; END OF FUNCTION CLRBUF_EDITOR
; =============== S U B	R O U T	I N E =======================================
RESTORE_COMSTR:				; CODE XREF: GET_COMMAND+5P
		LD	DE, (E_LINE)
		LD	HL, TRD_5D20	;   3   
		CALL	LDI3_HL2DE
		RET
; END OF FUNCTION RESTORE_COMSTR
; =============== S U B	R O U T	I N E =======================================
GET_COMMAND:				; CODE XREF: ROM:02E9P
; FUNCTION CHUNK AT 1D90 SIZE 00000007 BYTES
		LD	A, (TRD_5D0F)	; 	 TR-DOS
		OR	A
		PUSH	AF
		CALL	NZ, RESTORE_COMSTR
		POP	AF
		CALL	Z, CLRBUF_EDITOR
		LD	HL, (E_LINE)
		CALL	PRINT_0D
		LD	A, (TRD_5D19)
		ADD	A, 41H
		RST	10H
		LD	A, 3EH
		RST	10H
		LD	HL, ERR_NR
		LD	(HL), 0FFH
		JP	LOC_1D90
; END OF FUNCTION GET_COMMAND
; =============== S U B	R O U T	I N E =======================================
SUB_2158:				; CODE XREF: ROM:219DP
		CALL	PRINT_NEXT_SYM
		CALL	GET_SYMSTR
		CP	2CH
		JP	NZ, SINTAX_ERROR
		LD	HL, (TRD_5CDB)
		LD	(TRD_5CD9), HL
		CALL	SET_NUM_CHAN
		CALL	EXIT_IF_SINTAX
		LD	HL, (TRD_5CDB)
		LD	A, H
		OR	A
		JP	NZ, SINTAX_ERROR
		INC	HL
		LD	(TRD_5CD7), HL
		LD	HL, (TRD_5CD9)
		LD	(TRD_5CDB), HL
		RET
; END OF FUNCTION SUB_2158
; ---------------------------------------------------------------------------
OPEN:					; DATA XREF: ROM:3022O
		LD	HL, (TRD_5D11)
		LD	(CH_ADD), HL
		CALL	SET_NUM_CHAN
		CALL	LOC_1DD0
LOC_218E:				; CODE XREF: ROM:2198J
		CALL	GET_SYMSTR
		CP	41H ; 'A'
		JR	NC, LOC_219A
		CALL	PRINT_NEXT_SYM
		JR	LOC_218E
; ---------------------------------------------------------------------------
LOC_219A:				; CODE XREF: ROM:2193J
		CP	0A5H
		PUSH	AF
		CALL	Z, SUB_2158
		POP	AF
		JR	Z, LOC_21AE
		AND	0DFH
		CP	52H
		JR	Z, LOC_21AE
		CP	57H
		JP	NZ, SINTAX_ERROR
LOC_21AE:				; CODE XREF: ROM:21A1J	ROM:21A7J
		LD	(TRD_5D09), A
		CALL	EXIT_IF_SINTAX
		LD	A, 23H
		LD	(TRD_5CE5), A	;  
		LD	A, 0
		LD	(TRD_5CE6), A	;  <C>- , <B>-	
		CALL	FIND_ENDFILE
		PUSH	AF
		CALL	CP_STREAMS
		POP	AF
		PUSH	AF
		CALL	NZ, CREATE_BLOCK0
		POP	AF
		CALL	OPEN_STREAM
		LD	HL, (TRD_5D11)
		LD	BC, 124H
		ADD	HL, BC
		LD	(TRD_5D11), HL
		JP	END_COMAND
; =============== S U B	R O U T	I N E =======================================
FIND_ENDFILE:				; CODE XREF: ROM:21BEP
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		CALL	SET_CP_FILENAME
		PUSH	AF
		CALL	COM_18
		POP	AF
		JR	NZ, LOC_2206
		LD	A, (TRD_5D09)
		CP	52H ; 'R'
		JR	Z, LOC_2201
LOC_21F1:				; CODE XREF: FIND_ENDFILE+1DJ
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		INC	(HL)
		CALL	FIND_FILENAME
		JR	Z, LOC_21F1
		LD	HL, TRD_5CE6	;  <C>- , <B>-	
		DEC	(HL)
		CALL	FIND_FILENAME
LOC_2201:				; CODE XREF: FIND_ENDFILE+14J
		CALL	RD_HEAD_FILENAME
		XOR	A
		RET
; ---------------------------------------------------------------------------
LOC_2206:				; CODE XREF: FIND_ENDFILE+DJ
		LD	A, (TRD_5D09)
		CP	52H ; 'R'
		RET	NZ
		JP	ERR_NOFILES
; END OF FUNCTION FIND_ENDFILE
; =============== S U B	R O U T	I N E =======================================
CP_STREAMS:				; CODE XREF: ROM:21C2P	OPEN_STREAM+1P
		LD	A, (TRD_5CDB)
		RST	20H
; ---------------------------------------------------------------------------
		DW 1727H
; ---------------------------------------------------------------------------
		LD	A, B
		OR	C
		JP	NZ, LOC_221B
		RET
; ---------------------------------------------------------------------------
LOC_221B:				; CODE XREF: CP_STREAMS+8J
		LD	A, 19H
		LD	(ERR_NR), A
		LD	HL, ASC_2804	; "STREAM OPENED"
		LD	A, 0AH
LOC_2225:				; CODE XREF: ROM:222DJ
		JP	PRINT_TXTERR
; END OF FUNCTION CP_STREAMS
; ---------------------------------------------------------------------------
LOC_2228:				; CODE XREF: ROM:2678J
		LD	A, 0BH
		LD	HL, ASC_2812	; "NOT DISK FILE"
		JR	LOC_2225
; =============== S U B	R O U T	I N E =======================================
INITFREEACCESS:				; CODE XREF: OPEN_STREAM+1AP
		PUSH	HL
		LD	C, 20H
		RST	28H
		LD	A, (TRD_5CD7)
		LD	(HL), A
		INC	HL
		XOR	A
		LD	(HL), A
		INC	HL
		LD	(HL), A
		INC	HL
		LD	(HL), A
		LD	A, 7FH
		POP	HL
		RET
; END OF FUNCTION INITFREEACCESS
; =============== S U B	R O U T	I N E =======================================
OPEN_STREAM:				; CODE XREF: ROM:21CBP
		PUSH	AF
		CALL	CP_STREAMS
		EX	DE, HL
		LD	HL, (PROG)
		LD	BC, (CHANS)
		SBC	HL, BC
		EX	DE, HL
		LD	(HL), E
		INC	HL
		LD	(HL), D
		CALL	CREATE_HEADCHAN
		LD	A, (TRD_5D09)
		CP	0A5H
		CALL	Z, INITFREEACCESS
		JR	Z, LOC_226B
		LD	A, (TRD_5D09)
		CP	52H ; 'R'
		LD	A, 0FFH
		JR	NZ, LOC_226B
		XOR	A
LOC_226B:				; CODE XREF: OPEN_STREAM+1DJ
					; OPEN_STREAM+26J
		LD	(HL), A
		POP	AF
		JP	LOC_2270
LOC_2270:
		PUSH	AF
		LD	BC, 14H
		ADD	HL, BC
		PUSH	HL
		CALL	GET_TEKSECFILE
		POP	HL
		INC	HL
		LD	B, 1
		POP	AF
		OR	A
		PUSH	AF
		CALL	NZ, COM_06
		POP	AF
		CALL	Z, COM_05
		RET
; END OF FUNCTION OPEN_STREAM
; =============== S U B	R O U T	I N E =======================================
CREATE_BLOCK0:				; CODE XREF: ROM:21C7P
		LD	HL, (TRD_5CD7)
		PUSH	HL
		LD	HL, 2000H
		LD	(TRD_5CD7), HL
		CALL	CREATE_BLOCK
		POP	HL
		LD	(TRD_5CD7), HL
		RET
; END OF FUNCTION CREATE_BLOCK0
; =============== S U B	R O U T	I N E =======================================
CREATE_BLOCK:				; CODE XREF: CREATE_BLOCK0+AP
					; CREATE_NEWBLOCK:CREATE_BLKP
		LD	HL, 1000H
		LD	(TRD_5CD9), HL
		CALL	CP_FREE_ON_DSK
		CALL	SAVE_FILE
		LD	HL, 0
		LD	(TRD_5CE8), HL	; 	
		CALL	SET_HEAD_FILENAME
		JP	REWRITE_9SEC
; END OF FUNCTION CREATE_BLOCK
; =============== S U B	R O U T	I N E =======================================
CREATE_HEADCHAN:			; CODE XREF: OPEN_STREAM+12P
		LD	HL, (PROG)
		DEC	HL
		LD	(CURCHL), HL
		PUSH	HL
		LD	BC, 124H
		CALL	RESERV_RAM
		LD	A, 0
		LD	B, 0
LOC_22C4:				; CODE XREF: CREATE_HEADCHAN+14J
		LD	(DE), A
		DEC	DE
		DJNZ	LOC_22C4
		POP	HL
		PUSH	HL
		LD	DE, LOC_3D0E
		LD	(HL), E
		INC	HL
		LD	(HL), D
		INC	HL
		LD	DE, LOC_3D06
		LD	(HL), E
		INC	HL
		LD	(HL), D
		INC	HL
		LD	(HL), 44H ; 'D'
		INC	HL
		INC	HL
		INC	HL
		INC	HL
		INC	HL
		LD	(HL), 24H ; '$'
		INC	HL
		LD	(HL), 1
		INC	HL
		LD	A, (TRD_5CF6)
		LD	(HL), A
		INC	HL
		LD	A, (TRD_5D1E)
		LD	(HL), A
		INC	HL
		LD	A, (TRD_5D09)
		CP	52H ; 'R'
		LD	(HL), 0
		JR	Z, LOC_22FC
		LD	A, (TRD_5CE8)	; 	
		LD	(HL), A
LOC_22FC:				; CODE XREF: CREATE_HEADCHAN+44J
		INC	HL
		LD	(HL), B
		JR	Z, LOC_2304
		LD	A, (TRD_5CE8+1)	; 	
		LD	(HL), A
LOC_2304:				; CODE XREF: CREATE_HEADCHAN+4CJ
		INC	HL
		EX	DE, HL
		POP	HL
		PUSH	DE
		LD	DE, 10H
		ADD	HL, DE
		EX	DE, HL
		LD	HL, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		POP	HL
		RET
; END OF FUNCTION CREATE_HEADCHAN
; =============== S U B	R O U T	I N E =======================================
GET_ADRTEKSYM:				; CODE XREF: ROM:2467P
					; INPUT_SYM_FILE:LOC_2645P
		LD	C, 0DH
		RST	28H
		LD	C, (HL)
		RST	28H
		LD	BC, 24H
		ADD	HL, BC
		RET
; END OF FUNCTION GET_ADRTEKSYM
; =============== S U B	R O U T	I N E =======================================
GET_ADRTEKFRG:				; CODE XREF: SAVE_TEKSECTOR+3P
					; SAVE_TEKSECTOR+12P ...
		LD	C, 24H
; END OF FUNCTION GET_ADRTEKFRG
; =============== S U B	R O U T	I N E =======================================
SUB_2323:				; CODE XREF: SUB_28J
		LD	B, 0
		LD	HL, (CURCHL)
		ADD	HL, BC
		RET
; END OF FUNCTION SUB_2323
; ---------------------------------------------------------------------------
CP_ENDOFSECTOR:				; CODE XREF: ROM:246BJ
		LD	C, 0DH
		RST	28H
		INC	(HL)
		RET	NZ
		PUSH	HL
		CALL	SET_DSK
		CALL	SAVE_TEKSECTOR
		POP	HL
		INC	HL
		INC	(HL)
		PUSH	HL
		CALL	LOADINGSECTOR
		POP	HL
		LD	A, 10H
		CP	(HL)
		RET	NZ
		PUSH	HL
		LD	C, 0FH
		RST	28H
		LD	A, (HL)
		CP	7FH
		POP	HL
		JR	Z, LOC_2358
		LD	HL, (CURCHL)
		CALL	SAVE_HEAD_BLK
		LD	C, 0EH
		RST	28H
		JP	LOC_2379
; ---------------------------------------------------------------------------
LOC_2358:				; CODE XREF: ROM:234AJ
		CALL	FIND_NEXT_BLK
		PUSH	AF
		CALL	Z, LOADINGSECTOR
		LD	C, 0EH
		RST	28H
		POP	AF
		CALL	NZ, CREATE_NEWBLOCK
		RET
; =============== S U B	R O U T	I N E =======================================
SUB_2367:				; CODE XREF: CREATE_NEWBLOCKP
					; CREATE_NEWBLOCK:LOC_2379P
		LD	(HL), 0
		LD	C, 19H
		RST	28H
		LD	D, 20H
		LD	E, (HL)
		RET
; END OF FUNCTION SUB_2367
; =============== S U B	R O U T	I N E =======================================
CREATE_NEWBLOCK:			; CODE XREF: ROM:2363P
		CALL	SUB_2367
		LD	(TRD_5CD7), DE
		JR	CREATE_BLK
; ---------------------------------------------------------------------------
LOC_2379:				; CODE XREF: ROM:2355J
		CALL	SUB_2367
		INC	E
		LD	(TRD_5CD7), DE
CREATE_BLK:				; CODE XREF: CREATE_NEWBLOCK+7J
					; OPEN_SAVED+7AP
		CALL	CREATE_BLOCK
		CALL	DEL_BUF
		LD	C, 10H
		RST	28H
		EX	DE, HL
		LD	HL, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		LD	C, 0CH
		RST	28H
		LD	A, (TRD_5D1E)
		LD	(HL), A
		RET
; END OF FUNCTION CREATE_NEWBLOCK
; =============== S U B	R O U T	I N E =======================================
FIND_END_SEC:				; CODE XREF: INPUT_SYM_FILE+1FP
		LD	C, 0DH
		RST	28H
		INC	(HL)
		RET	NZ
		INC	HL
		INC	(HL)
		PUSH	HL
		CALL	SET_DSK
		LD	C, 23H
		RST	28H
		LD	A, (HL)
		OR	A
		JR	Z, LOC_23B6
		POP	HL
		PUSH	HL
		DEC	(HL)
		CALL	SAVE_TEKSECTOR
		POP	HL
		PUSH	HL
		INC	(HL)
LOC_23B6:				; CODE XREF: FIND_END_SEC+10J
		CALL	LOADINGSECTOR
		POP	HL
		LD	A, 10H
		CP	(HL)
		CALL	Z, OPEN_NEXT_BLK
		RET
; END OF FUNCTION FIND_END_SEC
; =============== S U B	R O U T	I N E =======================================
OPEN_NEXT_BLK:				; CODE XREF: FIND_END_SEC+22P
; FUNCTION CHUNK AT 2492 SIZE 0000000C BYTES
		CALL	FIND_NEXT_BLK
		PUSH	AF
		CALL	DEL_BUF
		POP	AF
		JP	NZ, ERR_ENDOFFILE
		JP	LOADINGSECTOR
; END OF FUNCTION OPEN_NEXT_BLK
; =============== S U B	R O U T	I N E =======================================
FIND_NEXT_BLK:				; CODE XREF: ROM:LOC_2358P
					; OPEN_NEXT_BLKP
		LD	(HL), 0
		LD	C, 19H
		RST	28H
		INC	(HL)
		LD	C, 10H
		RST	28H
		LD	DE, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		CALL	FIND_FILENAME
		RET	NZ
OPEN_BLK:				; CODE XREF: OPEN_SAVED+3AP
		CALL	RD_HEAD_FILENAME
		LD	C, 10H
		RST	28H
		EX	DE, HL
		LD	HL, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		LD	C, 0CH
		RST	28H
		LD	A, (TRD_5D1E)
		LD	(HL), A
		XOR	A
		RET
; END OF FUNCTION FIND_NEXT_BLK
; =============== S U B	R O U T	I N E =======================================
SAVE_TEKSECTOR:				; CODE XREF: ROM:2333P
					; FIND_END_SEC+15P ...
		CALL	GET_TEKSECFILE
		CALL	GET_ADRTEKFRG
		LD	B, 1
		CALL	COM_06
		LD	C, 0FH
		RST	28H
		LD	A, (HL)
		CP	7FH
		RET	Z
		CALL	GET_ADRTEKFRG
		XOR	A
		LD	B, A
LOC_2413:				; CODE XREF: SAVE_TEKSECTOR+19J
		LD	(HL), A
		INC	HL
		DJNZ	LOC_2413
		RET
; END OF FUNCTION SAVE_TEKSECTOR
; =============== S U B	R O U T	I N E =======================================
LOADINGSECTOR:				; CODE XREF: ROM:233AP	ROM:235CP ...
		CALL	GET_TEKSECFILE
		CALL	GET_ADRTEKFRG
		LD	B, 1
		JP	COM_05
; END OF FUNCTION LOADINGSECTOR
; =============== S U B	R O U T	I N E =======================================
GET_TEKSECFILE:				; CODE XREF: OPEN_STREAM+34P
					; SAVE_TEKSECTORP ...
		LD	HL, (CURCHL)
		LD	BC, 1EH
		ADD	HL, BC
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		LD	C, 0EH
		RST	28H
		LD	B, (HL)
		DEC	B
		INC	B
		PUSH	AF
		LD	A, 10H
		JR	Z, LOC_2441
LOC_2438:				; CODE XREF: GET_TEKSECFILE:LOC_243FJ
		INC	E
		CP	E
		JR	NZ, LOC_243F
		LD	E, 0
		INC	D
LOC_243F:				; CODE XREF: GET_TEKSECFILE+17J
		DJNZ	LOC_2438
LOC_2441:				; CODE XREF: GET_TEKSECFILE+13J
		POP	AF
		RET
; END OF FUNCTION GET_TEKSECFILE
; =============== S U B	R O U T	I N E =======================================
SET_DSK:				; CODE XREF: ROM:2330P	FIND_END_SEC+8P ...
		LD	C, 0BH
		RST	28H
		LD	A, (HL)
		JP	COM_01
; END OF FUNCTION SET_DSK
; ---------------------------------------------------------------------------
OUT_SYM2FILE:				; CODE XREF: ROM:LOC_3D0AJ
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		PUSH	HL
		LD	HL, CP_INTERFACE1
		PUSH	HL
		PUSH	AF
		CALL	CP_INTERFACE1
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		POP	AF
		CALL	WORK4FREEACCESS
		PUSH	AF
		CALL	CP_FILE_OPENED
		JP	Z, ERR_INVALID_IO
		POP	AF
		CALL	GET_ADRTEKSYM
		LD	(HL), A
		JP	CP_ENDOFSECTOR
; =============== S U B	R O U T	I N E =======================================
CP_END_BLK:				; CODE XREF: INPUT_SYM_FILE:LOC_2642P
		LD	C, 0DH
		RST	28H
		LD	A, (HL)
		LD	BC, 0EH
		ADD	HL, BC
		CP	(HL)
		RET	NZ
		LD	C, 0EH
		RST	28H
		LD	A, (HL)
		LD	BC, 0EH
		ADD	HL, BC
		CP	(HL)
		RET	NZ
		LD	HL, TRD_5CB6	;    INTERFACE1
		LD	A, (HL)
		CP	0F4H
		JR	Z, ERR_ENDOFFILE
		BIT	4, (HL)
		JR	Z, ERR_ENDOFFILE
		OR	1
		POP	HL
		RET
; END OF FUNCTION CP_END_BLK
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR OPEN_NEXT_BLK
ERR_ENDOFFILE:				; CODE XREF: OPEN_NEXT_BLK+8J
					; CP_END_BLK+1AJ ...
		LD	A, 7
LOC_2494:				; CODE XREF: INPUT_SYM_FILE-18BJ
		LD	(ERR_NR), A
		CALL	DELETE_BUF
		RST	20H
; ---------------------------------------------------------------------------
		DW 58H
; ---------------------------------------------------------------------------
		RET
; END OF FUNCTION CHUNK	FOR OPEN_NEXT_BLK
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR INPUT_SYM_FILE
ERR_INVALID_IO:				; CODE XREF: ROM:2463J
					; INPUT_SYM_FILE+CJ
		LD	A, 17H
		JR	LOC_2494
; END OF FUNCTION CHUNK	FOR INPUT_SYM_FILE
; =============== S U B	R O U T	I N E =======================================
WORK4FREEACCESS:			; CODE XREF: ROM:245CP
		LD	D, A
		LD	C, 0FH
		RST	28H
		LD	A, (HL)
		CP	7FH
		LD	A, D
		RET	NZ
		LD	BC, 13H
		ADD	HL, BC
		LD	A, (HL)
		OR	A
		LD	A, D
		JR	NZ, LOC_24D5
		DEC	HL
		LD	A, (HL)
		OR	A
		JR	NZ, LOC_24C2
		PUSH	BC
		PUSH	HL
		PUSH	DE
		CALL	W16B2WORKSP
		POP	DE
		POP	HL
		POP	BC
LOC_24C2:				; CODE XREF: WORK4FREEACCESS+15J
		LD	C, (HL)
		LD	A, D
		EX	DE, HL
		LD	HL, (TRD_5CCF)	;   WORK_SP
		ADD	HL, BC
		CP	6
		LD	(HL), A
		CALL	Z, WORK_NUMSAVE
		LD	C, 21H
		RST	28H
		INC	(HL)
		POP	HL
		RET
; ---------------------------------------------------------------------------
LOC_24D5:				; CODE XREF: WORK4FREEACCESS+10J
		DEC	HL
		LD	A, (HL)
		DEC	HL
		INC	A
		CP	(HL)
		INC	HL
		INC	(HL)
		PUSH	HL
		PUSH	AF
		LD	C, 23H
		RST	28H
		LD	(HL), 0FFH
		POP	AF
		POP	HL
		JR	C, LOC_24EE
		LD	A, D
		CP	0DH
		JR	Z, LOC_24F2
		POP	BC
		RET
; ---------------------------------------------------------------------------
LOC_24EE:				; CODE XREF: WORK4FREEACCESS+43J
		LD	A, D
		CP	0DH
		RET	NZ
LOC_24F2:				; CODE XREF: WORK4FREEACCESS+48J
		XOR	A
		LD	(HL), A
		INC	HL
		LD	(HL), A
		LD	A, D
		RET
; END OF FUNCTION WORK4FREEACCESS
; =============== S U B	R O U T	I N E =======================================
W16B2WORKSP:				; CODE XREF: WORK4FREEACCESS+1AP
		LD	HL, (WORKSP)
		LD	(TRD_5CCF), HL	;   WORK_SP
		LD	BC, 10H
		JP	CREATE_FREERAM
; END OF FUNCTION W16B2WORKSP
; =============== S U B	R O U T	I N E =======================================
WORK_NUMSAVE:				; CODE XREF: WORK4FREEACCESS+2AP
		LD	(HL), 0DH
		LD	HL, (CH_ADD)
		LD	(TRD_5CD7), HL
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	(CH_ADD), HL
		LD	HL, FLAGS
		RES	7, (HL)
		CALL	BC2STKBOT
		LD	HL, FLAGS
		SET	7, (HL)
		LD	HL, (TRD_5CCF)	;   WORK_SP
		LD	(CH_ADD), HL
		CALL	BC2STKBOT
		CALL	FIND_LAST
		PUSH	BC
		POP	DE
		LD	C, 20H
		RST	28H
		LD	B, (HL)
		XOR	A
		LD	HL, 0
		LD	(TRD_5CDB), HL
LOC_2538:				; CODE XREF: WORK_NUMSAVE:LOC_2544J
		ADD	HL, DE
		JR	NC, LOC_2544
		PUSH	HL
		LD	HL, (TRD_5CDB)
		INC	HL
		LD	(TRD_5CDB), HL
		POP	HL
LOC_2544:				; CODE XREF: WORK_NUMSAVE+35J
		DJNZ	LOC_2538
		LD	(TRD_5CD9), HL
		LD	A, (TRD_5CDB)
		LD	HL, TRD_5CDA
		RRD
		AND	0FH
		LD	(TRD_5CDB), A
		LD	HL, (TRD_5CD7)
		LD	(CH_ADD), HL
		CALL	OPEN_SAVED
		LD	C, 21H
		RST	28H
		LD	A, 0FFH
		LD	(HL), A
		INC	HL
		LD	(HL), A
		RET
; END OF FUNCTION WORK_NUMSAVE
; =============== S U B	R O U T	I N E =======================================
OPEN_SAVED:				; CODE XREF: WORK_NUMSAVE+58P
; FUNCTION CHUNK AT 25D2 SIZE 0000001D BYTES
		LD	C, 19H
		RST	28H
		LD	A, (TRD_5CDA)
		CP	(HL)
		JP	NZ, LOC_2584
		LD	C, 0EH
		RST	28H
		LD	A, (TRD_5CDB)
		CP	(HL)
		JP	NZ, LOC_25A7
LOC_257C:				; CODE XREF: OPEN_SAVED+59J
		LD	C, 0DH
		RST	28H
		LD	A, (TRD_5CD9)
		LD	(HL), A
		RET
; ---------------------------------------------------------------------------
LOC_2584:				; CODE XREF: OPEN_SAVED+7J
		CALL	CPANDZERO23
		CALL	NZ, SAVE_TEK_SEC
		LD	A, (TRD_5CDA)
		LD	C, 19H
		RST	28H
		LD	(HL), A
		LD	C, 10H
		RST	28H
		LD	DE, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		CALL	FIND_FILENAME
		JP	NZ, LOC_25D2
		CALL	OPEN_BLK
		JR	LOC_25AD
; ---------------------------------------------------------------------------
LOC_25A7:				; CODE XREF: OPEN_SAVED+11J
		CALL	CPANDZERO23
		CALL	NZ, SAVE_TEK_SEC
LOC_25AD:				; CODE XREF: OPEN_SAVED+3DJ
					; OPEN_SAVED+85J
		LD	A, (TRD_5CDB)
		LD	C, 0EH
		RST	28H
		LD	(HL), A
		PUSH	HL
		CALL	SET_DSK
		CALL	LOADINGSECTOR
		POP	HL
		DEC	HL
		LD	A, (TRD_5CD9)
		LD	(HL), A
		JR	LOC_257C
; END OF FUNCTION OPEN_SAVED
; =============== S U B	R O U T	I N E =======================================
SAVE_TEK_SEC:				; CODE XREF: OPEN_SAVED+1FP
					; OPEN_SAVED+42P
		CALL	SET_DSK
		CALL	SAVE_TEKSECTOR
		RET
; END OF FUNCTION SAVE_TEK_SEC
; =============== S U B	R O U T	I N E =======================================
CPANDZERO23:				; CODE XREF: OPEN_SAVED:LOC_2584P
					; OPEN_SAVED:LOC_25A7P
		LD	C, 23H
		RST	28H
		LD	A, (HL)
		OR	A
		LD	(HL), 0
		RET
; END OF FUNCTION CPANDZERO23
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR OPEN_SAVED
LOC_25D2:				; CODE XREF: OPEN_SAVED+37J
		LD	HL, (TRD_5CDA)
		LD	H, 20H
		LD	(TRD_5CD7), HL
		LD	HL, (TRD_5CD9)
		PUSH	HL
		LD	HL, (TRD_5CDB)
		PUSH	HL
		CALL	CREATE_BLK
		POP	HL
		LD	(TRD_5CDB), HL
		POP	HL
		LD	(TRD_5CD9), HL
		JR	LOC_25AD
; END OF FUNCTION CHUNK	FOR OPEN_SAVED
; ---------------------------------------------------------------------------
LOC_25EF:				; CODE XREF: ROM:3D07J
		CALL	CP_INTERFACE1
		LD	HL, TV_FLAG
		RES	3, (HL)
		LD	HL, (ERR_SP)
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		OR	A
		LD	HL, 107FH
		SBC	HL, DE
		JR	NZ, LOC_2626
		LD	SP, (ERR_SP)
		POP	DE
		POP	DE
		LD	(ERR_SP), DE
LOC_260F:				; CODE XREF: ROM:2624J
		CALL	INPUT_SYM_FILE
		JR	C, LOC_261D
LOC_2614:				; CODE XREF: ROM:261FJ	ROM:2629J
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		PUSH	HL
		LD	HL, DELETE_BUF
		PUSH	HL
		RET
; ---------------------------------------------------------------------------
LOC_261D:				; CODE XREF: ROM:2612J
		CP	0DH
		JR	Z, LOC_2614
		RST	20H
; ---------------------------------------------------------------------------
		DW 0F85H
; ---------------------------------------------------------------------------
		JR	LOC_260F
; ---------------------------------------------------------------------------
LOC_2626:				; CODE XREF: ROM:2603J
		CALL	INPUT_SYM_FILE
		JR	LOC_2614
; =============== S U B	R O U T	I N E =======================================
INPUT_SYM_FILE:				; CODE XREF: ROM:LOC_260FP
					; ROM:LOC_2626P
; FUNCTION CHUNK AT 249E SIZE 00000004 BYTES
		LD	A, 0AH
		LD	(TRD_5D06), A	;      
		CALL	CP_FILE_OPENED
		JR	Z, LOC_2642
		CP	7FH
		JP	NZ, ERR_INVALID_IO
		LD	BC, 13H
		ADD	HL, BC
		LD	(HL), 0
		JR	LOC_2645
; ---------------------------------------------------------------------------
LOC_2642:				; CODE XREF: INPUT_SYM_FILE+8J
		CALL	CP_END_BLK
LOC_2645:				; CODE XREF: INPUT_SYM_FILE+15J
		CALL	GET_ADRTEKSYM
		LD	A, (HL)
		PUSH	AF
		CALL	FIND_END_SEC
		POP	AF
		SCF
		RET
; END OF FUNCTION INPUT_SYM_FILE
; =============== S U B	R O U T	I N E =======================================
CP_FILE_OPENED:				; CODE XREF: ROM:2460P
					; INPUT_SYM_FILE+5P
		LD	C, 0FH
		RST	28H
		LD	A, (HL)
		OR	A
		RET
; END OF FUNCTION CP_FILE_OPENED
; ---------------------------------------------------------------------------
CLOSE:					; DATA XREF: ROM:3024O
		LD	HL, (TRD_5D11)
		LD	(CH_ADD), HL
		CALL	SET_NUM_CHAN
		CALL	EXIT_IF_SINTAX
		LD	A, (TRD_5CDB)
		RST	20H
; ---------------------------------------------------------------------------
		DW 1727H
; ---------------------------------------------------------------------------
		LD	A, B
		OR	C
		JP	Z, END_COMAND
		PUSH	HL
		LD	HL, (CHANS)
		ADD	HL, BC
		LD	A, (HL)
		LD	HL, LOC_3D0E
		CP	H
		POP	HL
		JP	NZ, LOC_2228
		LD	(HL), 0
		INC	HL
		LD	(HL), 0
		LD	(TRD_5CD9), BC
		LD	HL, (CHANS)
		ADD	HL, BC
		DEC	HL
		LD	(TRD_5CD7), HL
		CALL	SUB_26CE
		LD	HL, (TRD_5CD7)
		LD	BC, 124H
		CALL	DEL_WORKRAM
		LD	HL, STRMS
		LD	B, 10H
LOC_269D:				; CODE XREF: ROM:26BEJ
		PUSH	BC
		LD	BC, (TRD_5CD9)
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		EX	DE, HL
		SBC	HL, BC
		EX	DE, HL
		JR	C, LOC_26BC
		LD	D, (HL)
		DEC	HL
		LD	E, (HL)
		INC	HL
		PUSH	HL
		EX	DE, HL
		LD	BC, 124H
		SBC	HL, BC
		EX	DE, HL
		POP	HL
		LD	(HL), D
		DEC	HL
		LD	(HL), E
		INC	HL
LOC_26BC:				; CODE XREF: ROM:26A9J
		INC	HL
		POP	BC
		DJNZ	LOC_269D
		LD	HL, (TRD_5D11)
		LD	BC, 124H
		SBC	HL, BC
		LD	(TRD_5D11), HL
		JP	END_COMAND
; =============== S U B	R O U T	I N E =======================================
SUB_26CE:				; CODE XREF: ROM:268CP
		LD	BC, 0FH
		ADD	HL, BC
		LD	A, (HL)
		OR	A
		RET	Z
		LD	HL, (TRD_5CD7)
		LD	(CURCHL), HL
		CALL	SAVE_HEAD_BLK
		JP	SAVE_TEKSECTOR
; END OF FUNCTION SUB_26CE
; =============== S U B	R O U T	I N E =======================================
SAVE_HEAD_BLK:				; CODE XREF: ROM:234FP	SUB_26CE+DP
		LD	BC, 0DH
		ADD	HL, BC
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		LD	BC, 0DH
		ADD	HL, BC
		LD	(HL), E
		INC	HL
		LD	(HL), D
		LD	C, 10H
		RST	28H
		LD	DE, TRD_5CDD	;  
		LD	BC, 10H
		LDIR
		CALL	SET_DSK
		LD	C, 0CH
		RST	28H
		LD	C, (HL)
		CALL	SET_HEAD_FILENAME
		JP	REWRITE_9SEC
; END OF FUNCTION SAVE_HEAD_BLK
; =============== S U B	R O U T	I N E =======================================
PRINT_MSG:				; CODE XREF: J_PRINT_MSGJ
					; PRINT_ERROR+12P ...
		LD	A, (HL)
		OR	A
		RET	Z
		AND	7FH
		RST	10H
		BIT	7, (HL)
		RET	NZ
		INC	HL
		JR	PRINT_MSG
; END OF FUNCTION PRINT_MSG
; =============== S U B	R O U T	I N E =======================================
PRINT_MSG_B_:				; CODE XREF: FIND_FILENAME:LOC_1CDBP
					; PRINT_MSG_B_+5J
		LD	A, (DE)
		CP	(HL)
		RET	NZ
		INC	DE
		INC	HL
		DJNZ	PRINT_MSG_B_
		RET
; END OF FUNCTION PRINT_MSG_B_
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR GET_NUM_TRACK
LOC_271B:				; CODE XREF: GET_NUM_TRACK+3DJ
		LD	HL, TXT_NODISK_	; "NO DISK"
		LD	A, 6
		JP	PRINT_TXTERR
; END OF FUNCTION CHUNK	FOR GET_NUM_TRACK
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR CP_FREESEC
LOC_2723:				; CODE XREF: CP_FREESEC+1BJ
					; CP_FILE_FREE+EJ
		LD	HL, ASC_27ED	; "DIRECTORY FULL"
		LD	A, 4
		JP	PRINT_TXTERR
; END OF FUNCTION CHUNK	FOR CP_FREESEC
; =============== S U B	R O U T	I N E =======================================
SET_TAPELDERR:				; CODE XREF: GET_NUM_TRACK:LOC_3EE7P
					; LOAD_SECTOR+7BP
		LD	A, 1AH
		JR	SET_NUM_ERR
; ---------------------------------------------------------------------------
		LD	A, 12H
SET_NUM_ERR:				; CODE XREF: SET_TAPELDERR+2J
					; ROM:2737J
		LD	(ERR_NR), A
		RET
; END OF FUNCTION SET_TAPELDERR
; ---------------------------------------------------------------------------
		LD	A, 3
		JR	SET_NUM_ERR
; ---------------------------------------------------------------------------
COM_15:					; DATA XREF: ROM:28CCO
		XOR	A
		LD	(TRD_5CD8), A
		LD	(TRD_5CD6), A	; #FF-   
		IN	A, (1FH)
		LD	(TRD_5CCD), A	; #80- 
		LD	E, D
		PUSH	DE
		LD	A, E
		OUT	(7FH), A
		LD	A, 1BH
		CALL	COM2VG_WAIT
		LD	A, (TRD_5CCD)	; #80- 
		AND	80H
		CALL	NZ, PAUSE_3_C_A
		POP	DE
		CALL	CP_NUM_TRACK
		LD	A, (TRD_5CD6)	; #FF-   
		OR	A
		RET	Z
		LD	A, 7
		LD	(TRD_5D0F), A	; 	 TR-DOS
		RET
; ---------------------------------------------------------------------------
TXT_OK_:	.ASCII 'O.K.'           ; DATA XREF: ERASE_FILE:ERR_OKO
		DB 0
ASC_276B:	.ASCII 'VERIFY ERROR.'  ; DATA XREF: RD_SECTORS:LOC_199DO
		DB 8DH
ASC_2779:	.ASCII 'BACKUP DISK'    ; DATA XREF: ROM:1532O COPY_SECTORS+DO ...
		DB 8DH
ASC_2785:	.ASCII 'INSERT DESTINATION DISK' ; DATA XREF: COPY_ON1DSK_+4EO
					; COPY_SECTORS+5FO
		DB 0DH
		.ASCII 'THEN PRESS Y'
		DB 0
ASC_27AA:	.ASCII 'INSERT SOURCE DISK THEN PRESS Y',0 ; DATA XREF: ROM:136FO
					; ROM:139FO ...
ASC_27CA:	.ASCII '*BREAK*'        ; DATA XREF: ROM:1D32O
		DB 8DH
ASC_27D2:	.ASCII 'OUT OF RAM'     ; DATA XREF: ROM:1D3DO
		DB 8DH
ASC_27DD:	.ASCII 'ARRAY NOT FOUND' ; DATA XREF: READ_MASSIV+19O
					; ROM:1D44O
		DB 8DH
ASC_27ED:	.ASCII 'DIRECTORY FULL' ; DATA XREF: CP_FREESEC:LOC_2723O
		DB 8DH
TXT_NODISK_:	.ASCII 'NO DISK'        ; DATA XREF: GET_NUM_TRACK:LOC_271BO
		DB 8DH
ASC_2804:	.ASCII 'STREAM OPENED'  ; DATA XREF: CP_STREAMS+11O
		DB 8DH
ASC_2812:	.ASCII 'NOT DISK FILE'  ; DATA XREF: ROM:222AO
		DB 8DH
ASC_2820:	.ASCII 'FILE EXISTS'    ; DATA XREF: GET_OVERWRITE_+17O
		DB 0DH
		.ASCII 'OVER WRITE?(Y/N'
		DB 0A9H
; ---------------------------------------------------------------------------
CALL_3D13:				; CODE XREF: ROM:LOC_3CFDJ
		PUSH	AF
		PUSH	BC
		LD	(TRD_5D04), DE
		LD	(TRD_5D02), HL
		CALL	CP_INTERFACE1
		LD	A, 0FFH
		LD	(TRD_5D15), A	;  0, 	TR-DOS. 	
		LD	(TRD_5D1F), A
		POP	BC
		POP	AF
		LD	HL, CP_ERROR	; 	 
		LD	(TRD_5D1A), HL	;     
		LD	HL, 0
		ADD	HL, SP
		LD	(TRD_5D1C), HL	;   
		DEC	HL
		DEC	HL
		LD	SP, HL
		PUSH	AF
		CALL	MARK_SP
		LD	HL, COMAND_TBL
LOC_2869:				; CODE XREF: ROM:288AJ
		LD	A, (HL)
		CP	C
		JR	NZ, LOC_287F
		POP	AF
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		LD	HL, END_COMAND
		PUSH	HL
		PUSH	DE
		LD	HL, (TRD_5D02)
		LD	DE, (TRD_5D04)
		RET
; ---------------------------------------------------------------------------
LOC_287F:				; CODE XREF: ROM:286BJ
		CP	0FFH
		JR	NZ, LOC_2887
		POP	AF
		JP	END_COMAND
; ---------------------------------------------------------------------------
LOC_2887:				; CODE XREF: ROM:2881J
		INC	HL
		INC	HL
		INC	HL
		JR	LOC_2869
; ---------------------------------------------------------------------------
COMAND_TBL:	DB 0			; DATA XREF: ROM:2866O
		DW COM_00
		DB 1
		DW COM_01
		DB 2
		DW COM_02
		DB 3
		DW COM_03
		DB 4
		DW COM_04
		DB 5
		DW COM_05
		DB 6
		DW COM_06
		DB 7
		DW COM_07
		DB 8
		DW COM_08
		DB 9
		DW COM_09
		DB 0AH
		DW COM_0A
		DB 0BH
		DW COM_0B
		DB 0CH
		DW COM_0C
		DB 0DH
		DW END_COMAND
		DB 0EH
		DW COM_0E
		DB 0FH
		DW END_COMAND
		DB 10H
		DW END_COMAND
		DB 11H
		DW END_COMAND
		DB 12H
		DW COM_12
		DB 13H
		DW COM_13
		DB 14H
		DW COM_14
		DB 15H
		DW COM_15
		DB 16H
		DW COM_16
		DB 17H
		DW COM_17
		DB 18H
		DW COM_18
		DB 0FFH
; ---------------------------------------------------------------------------
COM_07:					; DATA XREF: ROM:28A2O
		PUSH	AF
		CALL	COM_18
		POP	AF
		JP	LOC_479
; ---------------------------------------------------------------------------
COM_13:					; DATA XREF: ROM:28C6O
		XOR	A
		JR	LOC_28E5
; ---------------------------------------------------------------------------
COM_14:					; DATA XREF: ROM:28C9O
		LD	A, 0FFH
LOC_28E5:				; CODE XREF: ROM:28E1J
		LD	DE, TRD_5CDD	;  
		LD	BC, 10H
		OR	A
		JR	Z, LOC_28EF
		EX	DE, HL
LOC_28EF:				; CODE XREF: ROM:28ECJ
		LDIR
		RET
; ---------------------------------------------------------------------------
COM_0C:					; DATA XREF: ROM:28B1O
		CALL	COM_18
		CALL	CP_FREE_ON_DSK
		JP	LOC_1B27
; ---------------------------------------------------------------------------
COM_0B:					; DATA XREF: ROM:28AEO
		LD	(TRD_5CD7), HL
		LD	(TRD_5CD9), DE
		LD	(TRD_5CDB), DE
		CALL	COM_18
		CALL	CP_FREE_ON_DSK
		JP	LOC_1B53
; ---------------------------------------------------------------------------
COM_0E:					; DATA XREF: ROM:28B7O
		OR	A
		LD	(TRD_5CD6), A	; #FF-   
		LD	(TRD_5CD9), HL
		LD	(TRD_5CDB), DE
		CALL	FIND_FILENAME
		CALL	FIND_RD_HEAD
		CALL	CP_PARAMS
		JP	RD_FILE
; ---------------------------------------------------------------------------
COM_12:					; DATA XREF: ROM:28C3O
		CALL	COM_18
		CALL	FIND_FILENAME
		JP	ERASE_FILES
; =============== S U B	R O U T	I N E =======================================
FIND_FILE:				; CODE XREF: ERASE_FILE+13P
					; GET_PARAMS+27P ...
		CALL	SET_FILENAME
		CALL	COM_18
		JP	FIND_FILENAME
; END OF FUNCTION FIND_FILE
; =============== S U B	R O U T	I N E =======================================
PRINT_FILENAME:				; CODE XREF: ROM:04CCP
					; GET_OVERWRITE_+14P ...
		PUSH	BC
		LD	B, 8
LOC_293B:				; CODE XREF: PRINT_FILENAME+6J
		LD	A, (HL)
		RST	10H
		INC	HL
		DJNZ	LOC_293B
		LD	A, 3CH
		RST	10H
		LD	A, (HL)
		RST	10H
		LD	A, 3EH
		RST	10H
		POP	BC
		RET
; END OF FUNCTION PRINT_FILENAME
; =============== S U B	R O U T	I N E =======================================
CREATE_BUF:				; CODE XREF: ROM:016FP
					; GET_PARAMS-154BP ...
		PUSH	HL
		PUSH	DE
		PUSH	BC
		PUSH	AF
		LD	HL, TRD_5D0C
		LD	A, (HL)
		OR	A
		JR	Z, LOC_2992
		PUSH	HL
		LD	BC, 101H
		PUSH	BC
		CALL	SUB_19FD
		POP	BC
		POP	HL
		LD	(HL), 0
		LD	HL, TRD_5D25
		CALL	RESERV_RAM
		LD	HL, (TRD_5D11)
		LD	BC, 101H
		ADD	HL, BC
		JR	LOC_298F
; END OF FUNCTION CREATE_BUF
; =============== S U B	R O U T	I N E =======================================
DEL_BUF:				; CODE XREF: DELETE_BUF+9P
					; CREATE_NEWBLOCK+14P ...
		PUSH	HL
		PUSH	DE
		PUSH	BC
		PUSH	AF
		LD	HL, TRD_5D0C
		LD	A, (HL)
		OR	A
		JR	NZ, LOC_2992
		LD	(HL), 0FFH
		LD	HL, TRD_5D25
		LD	BC, 101H
		CALL	DEL_WORKRAM
		OR	A
		LD	BC, 101H
		LD	HL, (TRD_5D11)
		SBC	HL, BC
LOC_298F:				; CODE XREF: CREATE_BUF+24J
		LD	(TRD_5D11), HL
LOC_2992:				; CODE XREF: CREATE_BUF+9J DEL_BUF+9J
		POP	AF
		POP	BC
		POP	DE
		POP	HL
		RET
; END OF FUNCTION DEL_BUF
; ---------------------------------------------------------------------------
COM_40:					; DATA XREF: ROM:3028O
		XOR	A
LOC_2998:				; CODE XREF: ROM:29B0J
		LD	(TRD_5CD7), A
		CALL	EXIT_IF_SINTAX
		CALL	CP_SECOND_SYM
		JP	Z, SINTAX_ERROR
		CALL	GET_TYPE_DSK
		LD	A, (TRD_5CD7)
		LD	(HL), A
		JP	ERR_OK
; ---------------------------------------------------------------------------
COM_80:					; DATA XREF: ROM:302CO
		LD	A, 80H
		JR	LOC_2998
; ---------------------------------------------------------------------------
TXT_ERROR_:	DB 0DH			; DATA XREF: NUMDSK2BYTE+1802O
		.ASCII '*ERROR*'
		DB 8DH
TXT_NOSPACE_:	DB 0DH			; DATA XREF: COPY_FILE_ON2DSK:LOC_1C45O
		.ASCII 'NO SPACE'
		DB 8DH
TXT_FILEEXISTS_:DB 0DH			; DATA XREF: CP_FREESEC:FILE_EXISTSO
		.ASCII 'FILE EXISTS'
		DB 8DH
TXT_FREE_:	DB 20H			; DATA XREF: CP_END_DIR-13AO
		.ASCII 'FREE'
		DB 8DH
READ_ONLY:	DB 0DH			; DATA XREF: COM_05+1DO
					; LOAD_SECTOR:LOC_3F39O
		.ASCII 'READ ONL'
		DB 0F9H
TXT_DISCERROR_:	DB 0DH			; DATA XREF: COM_18+AO
					; LOAD_SECTOR:LOC_3F48O
		.ASCII 'DISC ERRO'
		DB 0F2H
TXT_R_O:	DB 0DH			; DATA XREF: NUM_SEC_FILE:LOC_1AB6O
		.ASCII 'REC.  O/'
		DB 0C6H
TXT_TITLE_:	.ASCII 'TITLE:'         ; DATA XREF: ROM:048DO
		DB 0A0H
TXT_RIA_:	DB 0DH			; DATA XREF: LOAD_SECTOR+69O
		.ASCII 'RETRY,ABORT,IGNORE?'
		DB 0
TXT_TRK_:	DB 0DH			; DATA XREF: LOAD_SECTOR+57O
		.ASCII 'TRK'
		DB 0A0H
TXT_SEC_:	.ASCII ' SEC'           ; DATA XREF: LOAD_SECTOR+60O
		DB 0A0H
TXT_DELFILE_:	.ASCII ' DEL. FILE'     ; DATA XREF: ROM:04ACO
		DB 8DH
TXT_NOFILES_:	DB 0DH			; DATA XREF: ERASE_FILE:ERR_NOFILESO
TXT_NOFILES:	.ASCII 'NO FILE(S)'     ; DATA XREF: ROM:04A3O
		DB 8DH
		DB 0
; =============== S U B	R O U T	I N E =======================================
SUB_2A35:				; CODE XREF: ROM:2B38P
		LD	HL, LOC_2A41
		LD	DE, 4080H
		LD	BC, 20H
		LDIR
		RET
; END OF FUNCTION SUB_2A35
; ---------------------------------------------------------------------------
LOC_2A41:				; DATA XREF: SUB_2A35O
		LD	A, (LOC_3B5)
		CP	0F3H
		LD	A, 10H
		JR	Z, LOC_2A4B
		XOR	A
LOC_2A4B:				; CODE XREF: ROM:2A48J
		LD	(KSTATE1), A
		LD	BC, 7FFDH
		LD	A, 10H
		OUT	(C), A
		RET
; ---------------------------------------------------------------------------
MAGIC:					; CODE XREF: ROM:0066J
		PUSH	AF
		PUSH	BC
		PUSH	DE
		PUSH	HL
		PUSH	IX
		PUSH	IY
		EXX
		PUSH	BC
		PUSH	DE
		PUSH	HL
		EX	AF, AF'
		PUSH	AF
		LD	A, I
		PUSH	AF
		LD	A, R
		PUSH	AF
		LD	HL, 0
		ADD	HL, SP
		PUSH	HL
		LD	A, 3CH
		OUT	(0FFH),	A
		LD	A, 3FH
		LD	I, A
		IN	A, (1FH)
		AND	80H
		RRCA
		RRCA
		RRCA
		LD	(KSTATE1), A
		CALL	SUB_2F65
		CALL	PAUSE_3_C_A
		CALL	PAUSE_3_C_A
		LD	DE, 0AH
		LD	HL, 4000H
		PUSH	HL
		CALL	SUB_2D73
		LD	HL, 4100H
		LD	DE, 0BH
		CALL	SUB_2D73
		POP	HL
		PUSH	HL
		LD	DE, 8
		CALL	SUB_2F1B
		LD	HL, 40E3H
		LD	A, (HL)
		LD	(KSTATE0), A
		INC	HL
		LD	A, (HL)
		INC	(HL)
		INC	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		OR	A
		EX	DE, HL
		LD	DE, 0C0H
		SBC	HL, DE
		LD	(40E5H), HL
		LD	HL, 4000H
		LD	DE, 8
		CALL	SUB_2D73
		POP	HL
		LD	DE, (40E1H)
		PUSH	DE
		LD	DE, 0AH
		CALL	SUB_2F1B
		POP	DE
		CALL	SUB_2D4C
		PUSH	DE
		LD	A, 3CH
		OUT	(0FFH),	A
		CALL	SUB_2F65
		LD	HL, 4000H
		LD	DE, 8
		LD	B, 1
		CALL	SUB_2F1B
		POP	DE
		LD	HL, (40E1H)
		LD	(40E1H), DE
		PUSH	HL
		LD	HL, 4000H
		LD	DE, 8
		LD	B, 1
		CALL	SUB_2D73
		LD	A, (40E4H)
		DEC	A
		CALL	SUB_2CE5
		LD	(HL), 40H
		INC	HL
		LD	B, 7
LOC_2B09:				; CODE XREF: ROM:2B0CJ
		LD	(HL), 20H
		INC	HL
		DJNZ	LOC_2B09
		LD	(HL), 43H
		POP	DE
		POP	BC
		INC	HL
		LD	(HL), C
		INC	HL
		LD	(HL), B
		INC	HL
		INC	HL
		INC	HL
		LD	(HL), 0C0H
		INC	HL
		LD	(HL), E
		INC	HL
		LD	(HL), D
		LD	HL, 4000H
		LD	DE, 0
		IN	A, (5FH)
		DEC	A
		LD	E, A
		LD	B, 1
		CALL	SUB_2D73
		LD	HL, 0
		ADD	HL, SP
		LD	(4140H), HL
		LD	SP, 41FFH
		CALL	SUB_2A35
		LD	HL, 0C000H
		XOR	A
LOC_2B3F:				; CODE XREF: ROM:2B45J
		ADD	A, (HL)
		INC	HL
		LD	B, A
		LD	A, H
		OR	A
		LD	A, B
		JR	NZ, LOC_2B3F
		LD	HL, 4100H
		LD	(HL), A
		PUSH	HL
		LD	HL, LOC_2B58
		PUSH	HL
		LD	HL, LOC_3D2F
		PUSH	HL
		DI
		JP	4080H
; ---------------------------------------------------------------------------
LOC_2B58:				; DATA XREF: ROM:2B4CO
		POP	HL
		LD	BC, 7FFDH
		LD	A, 0AAH
		LD	(4130H), A
		LD	D, 5
		LD	A, (KSTATE1)
		OR	D
		LD	D, A
		OUT	(C), D
		LD	A, (0C130H)
		CP	0AAH
		JP	NZ, LOC_2C1B
		LD	A, D
		AND	0F8H
		LD	D, A
		INC	HL
		LD	B, 8
LOC_2B79:				; CODE XREF: ROM:2B90J
		LD	(HL), D
		OUT	(C), D
		XOR	A
		LD	HL, 0C000H
LOC_2B80:				; CODE XREF: ROM:2B86J
		ADD	A, (HL)
		INC	HL
		LD	E, A
		LD	A, H
		OR	A
		LD	A, E
		JR	NZ, LOC_2B80
		LD	HL, 4100H
		CP	(HL)
		INC	HL
		JR	Z, LOC_2B93
		INC	D
		DJNZ	LOC_2B79
		DEC	D
LOC_2B93:				; CODE XREF: ROM:2B8DJ
		LD	B, 8
LOC_2B95:				; CODE XREF: ROM:2B9AJ
		PUSH	BC
		CALL	SUB_2C37
		POP	BC
		DJNZ	LOC_2B95
		LD	C, 0
		CALL	SUB_2F3A
		CALL	SUB_2D2A
		LD	A, (40E4H)
		LD	(4102H), A
		INC	A
		LD	(40E4H), A
		LD	HL, (40E5H)
		LD	DE, 1
		SBC	HL, DE
		LD	(40E5H), HL
		RET	C
		LD	HL, (40E1H)
		LD	(411EH), HL
		CALL	SUB_2D1E
		LD	A, 38H
		LD	(4111H), A
		LD	A, 1
		LD	(411DH), A
		LD	HL, 4100H
		LD	(4119H), HL
		LD	HL, 100H
		LD	(411BH), HL
		LD	DE, (40E1H)
		CALL	SUB_2F65
		LD	C, D
		CALL	SUB_2F3A
		LD	HL, 4100H
		LD	B, 1
		CALL	LOC_2D58
		LD	(40E1H), DE
		LD	C, 0
		CALL	SUB_2F3A
		CALL	SUB_2D34
		LD	A, (4102H)
		CALL	SUB_2CE5
		LD	DE, 4110H
		LD	BC, 10H
		EX	DE, HL
		LDIR
		IN	A, (5FH)
		DEC	A
		LD	E, A
		LD	D, 0
		LD	HL, 4000H
		CALL	SUB_2D73
		LD	BC, 7FFDH
		LD	A, (4101H)
		OUT	(C), A
LOC_2C1B:				; CODE XREF: ROM:2B6FJ
		LD	HL, (4140H)
		LD	SP, HL
		LD	HL, 4000H
		LD	DE, 0AH
		CALL	SUB_2F1B
		LD	HL, 4100H
		LD	DE, 0BH
		CALL	SUB_2F1B
		LD	A, 3CH
		PUSH	AF
		JP	LOC_2EBC
; =============== S U B	R O U T	I N E =======================================
SUB_2C37:				; CODE XREF: ROM:2B96P
		LD	A, B
		DEC	A
		LD	(4103H), A
		LD	B, A
		LD	A, (4101H)
		AND	7
		CP	B
		RET	Z
		LD	A, 2
		CP	B
		RET	Z
		LD	A, (4101H)
		AND	8
		JR	Z, LOC_2C55
		LD	A, B
		CP	7
		RET	Z
		JR	LOC_2C59
; ---------------------------------------------------------------------------
LOC_2C55:				; CODE XREF: SUB_2C37+16J
		LD	A, B
		CP	5
		RET	Z
LOC_2C59:				; CODE XREF: SUB_2C37+1CJ
		CALL	SUB_2C5D
		RET
; END OF FUNCTION SUB_2C37
; =============== S U B	R O U T	I N E =======================================
SUB_2C5D:				; CODE XREF: SUB_2C37:LOC_2C59P
		LD	HL, 4101H
		LD	A, (HL)
		AND	0F8H
		LD	C, A
		LD	A, B
		OR	C
		PUSH	BC
		LD	BC, 7FFDH
		OUT	(C), A
		POP	BC
		LD	HL, 0C000H
LOC_2C70:				; CODE XREF: SUB_2C5D+1AJ
		LD	A, (HL)
		OR	A
		JR	NZ, LOC_2C7A
		INC	HL
		LD	A, H
		OR	A
		JR	NZ, LOC_2C70
		RET
; ---------------------------------------------------------------------------
LOC_2C7A:				; CODE XREF: SUB_2C5D+15J
		CALL	SUB_2C7E
		RET
; END OF FUNCTION SUB_2C5D
; =============== S U B	R O U T	I N E =======================================
SUB_2C7E:				; CODE XREF: SUB_2C5D:LOC_2C7AP
		LD	C, 0
		CALL	SUB_2F3A
		CALL	SUB_2D2A
		LD	A, (40E4H)
		LD	(4102H), A
		INC	A
		LD	(40E4H), A
		LD	HL, (40E5H)
		LD	DE, 40H
		SBC	HL, DE
		LD	(40E5H), HL
		RET	C
		LD	HL, (40E1H)
		LD	(411EH), HL
		CALL	SUB_2D1E
		LD	A, 40H
		LD	(411DH), A
		LD	HL, 0C000H
		LD	(4119H), HL
		LD	HL, 4000H
		LD	(411BH), HL
		LD	DE, (40E1H)
		CALL	SUB_2D3E
		LD	(40E1H), DE
		LD	C, 0
		CALL	SUB_2F3A
		CALL	SUB_2D34
		LD	A, (4102H)
		CALL	SUB_2CE5
		LD	DE, 4110H
		LD	BC, 10H
		EX	DE, HL
		LDIR
		IN	A, (5FH)
		DEC	A
		LD	E, A
		LD	D, 0
		LD	HL, 4000H
		CALL	SUB_2D73
		RET
; END OF FUNCTION SUB_2C7E
; =============== S U B	R O U T	I N E =======================================
SUB_2CE5:				; CODE XREF: ROM:2B01P	ROM:2BFBP ...
		LD	C, A
		AND	0F0H
		RRCA
		RRCA
		RRCA
		RRCA
		LD	B, A
		PUSH	BC
		LD	E, B
		LD	D, 0
		LD	HL, 4000H
		PUSH	DE
		CALL	SUB_2F1B
		POP	DE
		POP	BC
		LD	B, 0
		LD	A, C
		AND	0FH
		RLCA
		RLCA
		RLCA
		RLCA
		LD	HL, 4000H
		ADD	A, L
		LD	L, A
		RET
; END OF FUNCTION SUB_2CE5
; =============== S U B	R O U T	I N E =======================================
SUB_2D09:				; CODE XREF: SUB_2D1EP
		LD	HL, 4110H
		LD	B, 9
LOC_2D0E:				; CODE XREF: SUB_2D09+8J
		LD	(HL), 20H
		INC	HL
		DJNZ	LOC_2D0E
		LD	A, 40H
		LD	(4110H), A
		LD	A, 43H
		LD	(4118H), A
		RET
; END OF FUNCTION SUB_2D09
; =============== S U B	R O U T	I N E =======================================
SUB_2D1E:				; CODE XREF: ROM:2BC0P	SUB_2C7E+24P
		CALL	SUB_2D09
		LD	A, (4103H)
		ADD	A, 30H
		LD	(4111H), A
		RET
; END OF FUNCTION SUB_2D1E
; =============== S U B	R O U T	I N E =======================================
SUB_2D2A:				; CODE XREF: ROM:2BA1P	SUB_2C7E+5P
		LD	HL, 4000H
		LD	DE, 8
		CALL	SUB_2F1B
		RET
; END OF FUNCTION SUB_2D2A
; =============== S U B	R O U T	I N E =======================================
SUB_2D34:				; CODE XREF: ROM:2BF5P	SUB_2C7E+48P
		LD	HL, 4000H
		LD	DE, 8
		CALL	SUB_2D73
		RET
; END OF FUNCTION SUB_2D34
; =============== S U B	R O U T	I N E =======================================
SUB_2D3E:				; CODE XREF: SUB_2C7E+3CP
		CALL	SUB_2F65
		LD	C, D
		CALL	SUB_2F3A
		LD	HL, 0C000H
		LD	B, 40H
		JR	LOC_2D58
; END OF FUNCTION SUB_2D3E
; =============== S U B	R O U T	I N E =======================================
SUB_2D4C:				; CODE XREF: ROM:2AD3P
		CALL	SUB_2F65
		LD	C, D
		CALL	SUB_2F3A
		LD	HL, 4000H
		LD	B, 0C0H
LOC_2D58:				; CODE XREF: ROM:2BE9P	SUB_2D3E+CJ ...
		PUSH	BC
		PUSH	DE
		CALL	SUB_2D73
		LD	DE, 100H
		ADD	HL, DE
		POP	DE
		INC	E
		LD	A, E
		CP	10H
		JR	NZ, LOC_2D6F
		LD	E, 0
		INC	D
		LD	C, D
		CALL	SUB_2F3A
LOC_2D6F:				; CODE XREF: SUB_2D4C+1AJ
		POP	BC
		DJNZ	LOC_2D58
		RET
; END OF FUNCTION SUB_2D4C
; =============== S U B	R O U T	I N E =======================================
SUB_2D73:				; CODE XREF: ROM:2A91P	ROM:2A9AP ...
		LD	A, E
		INC	A
		OUT	(5FH), A
		PUSH	HL
		LD	D, 14H
		PUSH	DE
LOC_2D7B:				; CODE XREF: SUB_2D73+1CJ
		DI
		LD	C, 7FH
		LD	A, 0A0H
		OUT	(1FH), A
		CALL	SUB_3FCA
		POP	DE
		POP	HL
		IN	A, (1FH)
		AND	7FH
		RET	Z
		DEC	D
		PUSH	HL
		PUSH	DE
		JR	NZ, LOC_2D7B
		HALT
LOC_2D92:				; CODE XREF: ROM:2DDBP	ROM:2E02P
		LD	HL, (TRD_5CE6)	;  <C>- , <B>-	
		LD	DE, (TRD_5CEB)	; 			
		LD	A, (TRD_5CEA)	; 	 	
		LD	B, A
		CALL	COM_05
		RET
; END OF FUNCTION SUB_2D73
; ---------------------------------------------------------------------------
GOTO:					; DATA XREF: ROM:302AO
		CALL	SET_AND_PUT
		CALL	EXIT_IF_SINTAX
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		CALL	SET_FILENAME
		LD	(4020H), BC
		LD	A, C
		CP	8
		JR	NC, LOC_2DD2
		CALL	COM_18
		CALL	FIND_FILENAME
		JP	NZ, ERR_NOFILES
		LD	HL, 5CDDH
		LD	BC, (4020H)
		ADD	HL, BC
		LD	(HL), 38H
		PUSH	HL
		CALL	FIND_FILENAME
		POP	HL
		JR	Z, LOC_2DD8
		LD	(HL), 20H
LOC_2DD2:				; CODE XREF: ROM:2DB4J
		CALL	FIND_FILENAME
		JP	LOC_2E33
; ---------------------------------------------------------------------------
LOC_2DD8:				; CODE XREF: ROM:2DCEJ
		CALL	RD_HEAD_FILENAME
		CALL	LOC_2D92
		LD	SP, 40FFH
		LD	B, 8
LOC_2DE3:				; CODE XREF: ROM:2E06J
		PUSH	BC
		LD	A, B
		LD	BC, 7FFDH
		DEC	A
		PUSH	AF
		OR	10H
		OUT	(C), A
		POP	AF
		ADD	A, 30H
		LD	HL, 5CDDH
		LD	BC, (4020H)
		ADD	HL, BC
		LD	(HL), A
		CALL	FIND_FILENAME
		JR	NZ, LOC_2E05
		CALL	RD_HEAD_FILENAME
		CALL	LOC_2D92
LOC_2E05:				; CODE XREF: ROM:2DFDJ
		POP	BC
		DJNZ	LOC_2DE3
		LD	A, 20H
		LD	HL, 5CDDH
		LD	BC, (4020H)
		ADD	HL, BC
		LD	(HL), A
		CALL	FIND_FILENAME
		CALL	RD_HEAD_FILENAME
		PUSH	BC
		PUSH	AF
		LD	BC, 7FFDH
		LD	A, (4101H)
		OUT	(C), A
		POP	AF
		POP	BC
		JR	LOC_2E39
; ---------------------------------------------------------------------------
		CALL	SET_AND_PUT
		CALL	EXIT_IF_SINTAX
		CALL	INPUT_EXTFILENAME ;   .  #5C5D  #5CD6
		CALL	FIND_FILE
LOC_2E33:				; CODE XREF: ROM:2DD5J
		JP	NZ, ERR_NOFILES
		CALL	RD_HEAD_FILENAME
LOC_2E39:				; CODE XREF: ROM:2E25J
		LD	A, (TRD_5CDD)	;  
		CP	24H
		DI
		JR	NZ, LOC_2E43
		IM	2
LOC_2E43:				; CODE XREF: ROM:2E3FJ
		LD	SP, 40F0H
		CALL	GET_TYPE_DSK
		LD	(4010H), A
		LD	A, (TRD_5D16)
		LD	(4011H), A
		LD	HL, (TRD_5CE6)	;  <C>- , <B>-	
		PUSH	HL
		LD	DE, (TRD_5CEB)	; 			
		PUSH	DE
		INC	E
		LD	A, E
		CP	10H
		JR	NZ, LOC_2E64
		LD	E, 0
		INC	D
LOC_2E64:				; CODE XREF: ROM:2E5FJ
		LD	C, D
		CALL	SUB_2F07
		LD	A, (4010H)
		AND	2
		CALL	NZ, SUB_2F0F
		LD	A, C
		CALL	LOC_2F50
		LD	HL, 4100H
		LD	B, 0BFH
LOC_2E79:				; CODE XREF: ROM:2E9DJ
		PUSH	BC
		PUSH	DE
		CALL	SUB_2F1B
		LD	DE, 100H
		ADD	HL, DE
		POP	DE
		INC	E
		LD	A, E
		CP	10H
		JR	NZ, LOC_2E9C
		LD	E, 0
		INC	D
		LD	C, D
		CALL	SUB_2F07
		LD	A, (4010H)
		AND	2
		CALL	NZ, SUB_2F0F
		LD	A, C
		CALL	LOC_2F50
LOC_2E9C:				; CODE XREF: ROM:2E87J
		POP	BC
		DJNZ	LOC_2E79
		POP	DE
		POP	HL
		LD	SP, HL
		LD	A, (4011H)
		PUSH	AF
		LD	C, D
		CALL	SUB_2F07
		LD	A, (4010H)
		AND	2
		CALL	NZ, SUB_2F0F
		LD	A, C
		CALL	LOC_2F50
		LD	HL, 4000H
		CALL	SUB_2F1B
LOC_2EBC:				; CODE XREF: ROM:2C34J
		POP	AF
		EX	AF, AF'
		POP	AF
		LD	R, A
		POP	AF
		LD	I, A
		DI
		LD	A, 0FFH
		JP	PO, LOC_2ECC
		LD	A, 0
LOC_2ECC:				; CODE XREF: ROM:2EC7J
		LD	(KSTATE0), A
		POP	AF
		POP	HL
		POP	DE
		POP	BC
		EXX
		EX	AF, AF'
		POP	IY
		POP	IX
		POP	HL
		POP	DE
		POP	BC
		LD	A, (BORDCR)
		AND	38H
		RRCA
		RRCA
		RRCA
		OUT	(0FEH),	A
		LD	A, (UNK_5B08)
		CP	0EEH
		JR	NZ, LOC_2EF7
		PUSH	BC
		LD	BC, 7FFDH
		LD	A, (UNK_5B5C)
		OUT	(C), A
		POP	BC
LOC_2EF7:				; CODE XREF: ROM:2EEBJ
		LD	A, (KSTATE0)
		OR	A
		LD	A, 0C9H
		LD	(KSTATE0), A
		JR	NZ, LOC_2F03
		EI
LOC_2F03:				; CODE XREF: ROM:2F00J
		POP	AF
		JP	KSTATE0
; =============== S U B	R O U T	I N E =======================================
SUB_2F07:				; CODE XREF: ROM:2E65P	ROM:2E8DP ...
		LD	A, (4011H)
		OR	3CH
LOC_2F0C:				; CODE XREF: SUB_2F0F+AJ
		OUT	(0FFH),	A
		RET
; END OF FUNCTION SUB_2F07
; =============== S U B	R O U T	I N E =======================================
SUB_2F0F:				; CODE XREF: ROM:2E6DP	ROM:2E95P ...
		LD	A, C
		OR	A
		RRA
		LD	C, A
		RET	NC
		LD	A, (4011H)
		AND	6FH
		JR	LOC_2F0C
; END OF FUNCTION SUB_2F0F
; =============== S U B	R O U T	I N E =======================================
SUB_2F1B:				; CODE XREF: ROM:2AA2P	ROM:2ACFP ...
		LD	A, E
		INC	A
		OUT	(5FH), A
		PUSH	HL
		LD	D, 14H
		PUSH	DE
LOC_2F23:				; CODE XREF: SUB_2F1B+1CJ
		DI
		LD	C, 7FH
		LD	A, 80H
		OUT	(1FH), A
		CALL	RD_DATAPORT
		POP	DE
		POP	HL
		IN	A, (1FH)
		AND	7FH
		RET	Z
		DEC	D
		PUSH	HL
		PUSH	DE
		JR	NZ, LOC_2F23
		HALT
; END OF FUNCTION SUB_2F1B
; =============== S U B	R O U T	I N E =======================================
SUB_2F3A:				; CODE XREF: ROM:2B9EP	ROM:2BE1P ...
		LD	A, 3CH
		OUT	(0FFH),	A
		LD	A, (KSTATE0)
		AND	8
		JR	NZ, LOC_2F4F
		LD	A, C
		OR	A
		RRA
		LD	C, A
		JR	NC, LOC_2F4F
		LD	A, 2CH
		OUT	(0FFH),	A
LOC_2F4F:				; CODE XREF: SUB_2F3A+9J SUB_2F3A+FJ
		LD	A, C
LOC_2F50:				; CODE XREF: ROM:2E71P	ROM:2E99P ...
		OUT	(7FH), A
		CALL	PAUSE725779TAKTS
		LD	A, 1BH
LOC_2F57:				; CODE XREF: SUB_2F65+2J
		OUT	(1FH), A
LOC_2F59:				; CODE XREF: SUB_2F3A+23J
		IN	A, (0FFH)
		AND	80H
		JR	Z, LOC_2F59
		PUSH	BC
		CALL	PAUSE725779TAKTS
		POP	BC
		RET
; END OF FUNCTION SUB_2F3A
; =============== S U B	R O U T	I N E =======================================
SUB_2F65:				; CODE XREF: ROM:2A81P	ROM:2ADBP ...
		LD	A, 0BH
		JR	LOC_2F57
; END OF FUNCTION SUB_2F65
; ---------------------------------------------------------------------------
WORK4ERROR:				; CODE XREF: ROM:3D17J
		LD	HL, (TRD_5D1C)	;   SP
		DEC	HL
		DEC	HL
		LD	SP, HL
		JP	LOC_1D2F
; =============== S U B	R O U T	I N E =======================================
CALL2BASIC:				; CODE XREF: J_RST_20J
		LD	(TRD_5D02), HL
		LD	(TRD_5D04), DE
		POP	HL
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		INC	HL
		PUSH	HL
		LD	HL, LOC_3D2F
		PUSH	HL
		PUSH	DE
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		PUSH	HL
		LD	HL, (TRD_5D02)
		LD	DE, (TRD_5D04)
		RET
; END OF FUNCTION CALL2BASIC
; ---------------------------------------------------------------------------
SET_VARS:				; DATA XREF: ROM:LOC_3D67O
		LD	HL, 0FFFFH
		LD	(TRD_5CFA), HL
		LD	(TRD_5CFC), HL
		LD	(TRD_5CC8), HL	; 	  A
		LD	(TRD_5CCA), HL	; 	  C
		XOR	A
		LD	(TRD_5D17), A	;  ,  #AA
		LD	(TRD_5D19), A
		LD	(TRD_5D18), A
		LD	(TRD_5D0F), A	; 	 TR-DOS
		LD	(TRD_5D1F), A
		LD	A, 0FFH
		OUT	(0FFH),	A
		LD	(ERR_NR), A
		LD	(TRD_5D16), A
		LD	(TRD_5D0C), A
		LD	A, 0C9H
		LD	(TRD_5CC2), A	;  #C9.   TR-DOS 	BASIC
		LD	A, 0D0H
		OUT	(1FH), A
		RET
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR CP_END_DIR
CP_END_CAT:				; CODE XREF: CP_END_DIR+EJ
					; CP_END_DIR+2ADEJ
		CALL	CP_END_BUF
		LD	A, (HL)
		OR	A
		JP	Z, END_OUT_DIR
		CP	1
		CALL	Z, ADD_10
		RET	NZ
		JR	CP_END_CAT
; END OF FUNCTION CHUNK	FOR CP_END_DIR
; =============== S U B	R O U T	I N E =======================================
LOAD_SEC2BUF:				; CODE XREF: RD_OR_VERIFY+169DP
		LD	B, 1
		LD	HL, TRD_5D25
		JP	LOC_1E67
; END OF FUNCTION LOAD_SEC2BUF
; ---------------------------------------------------------------------------
; START	OF FUNCTION CHUNK FOR RD_OR_VERIFY
LOAD_END_FILE:				; CODE XREF: RD_OR_VERIFY+5J
		PUSH	HL
		LD	DE, (TRD_5CF4)
		CALL	LOAD_SEC2BUF
		LD	A, (TRD_5CDB)
		POP	DE
		OR	A
		RET	Z
		LD	C, A
		LD	HL, TRD_5D25
		LDIR
		RET
; END OF FUNCTION CHUNK	FOR RD_OR_VERIFY
; ---------------------------------------------------------------------------
CODE_BYTE_COM:	DB 0CFH, 2AH, 0D0H, 0D1H, 0E6H,	0D2H, 0EFH, 0F8H, 0FEH
					; DATA XREF: GET_PARAMS:LOC_31AO
		DB 0BEH, 0F4H, 0D5H, 0F7H, 0D3H, 0D4H, 0FFH, 34H, 0ECH
		DB 38H,	0F0H, 0D6H
SPIS_ADR_COM:	DW CAT			; DATA XREF: GET_PARAMS-1532O
		DW COM_STAR
		DW FORMAT
		DW MOVE
		DW NEW
		DW ERASE
		DW LOAD
		DW SAVE
		DW RETURN
		DW PEEK
		DW POKE
		DW MERGE
		DW RUN
		DW OPEN
		DW CLOSE
		DW COPY
		DW COM_40
		DW GOTO
		DW COM_80
		DW LIST
		DW VERIFY
; =============== S U B	R O U T	I N E =======================================
PACK_COM_STR:				; CODE XREF: ROM:02ECP
		LD	HL, (E_LINE)
		LD	(TRD_5D11), HL
		LD	(TRD_5CD9), HL
		LD	A, 0FFH
		LD	(TRD_5CD6), A	; #FF-   
		LD	HL, TRD_5CDB
		LD	(TRD_5CD7), HL
		JR	LOC_3057
; ---------------------------------------------------------------------------
PACK_COMSTR:				; CODE XREF: ROM:01BEP
		LD	(TRD_5D11), HL
		LD	(TRD_5CD9), HL
		CALL	CP_ADR_STR
		RET	NZ
		INC	HL
		INC	HL
		LD	(TRD_5CD7), HL
LOC_3057:				; CODE XREF: PACK_COM_STR+14J
					; PACK_COM_STR+66J ...
		CALL	FIND_KEYWORD
		JR	NZ, LOC_3087
		EX	DE, HL
		INC	DE
		LD	B, 0
		LD	HL, BYTES_COM
		ADD	HL, BC
		LD	A, (HL)
		LD	HL, (TRD_5CD9)
		LD	(HL), A
		INC	HL
		EX	DE, HL
		RST	20H
; ---------------------------------------------------------------------------
		DW 19DDH
; ---------------------------------------------------------------------------
		PUSH	BC
		RST	20H
; ---------------------------------------------------------------------------
		DW 19E8H
; ---------------------------------------------------------------------------
		POP	BC
		LD	A, (TRD_5CD6)	; #FF-   
		OR	A
		JR	NZ, LOC_3087
		LD	HL, (TRD_5CD7)
		LD	E, (HL)
		INC	HL
		LD	D, (HL)
		EX	DE, HL
		OR	A
		SBC	HL, BC
		EX	DE, HL
		LD	(HL), D
		DEC	HL
		LD	(HL), E
LOC_3087:				; CODE XREF: PACK_COM_STR+28J
					; PACK_COM_STR+45J
		LD	HL, (TRD_5CD9)
		LD	A, (HL)
		CP	0DH
		RET	Z
		INC	HL
		LD	(TRD_5CD9), HL
		LD	A, (HL)
		CP	0DH
		RET	Z
		CP	22H
		JR	NZ, LOC_3057
LOC_309A:				; CODE XREF: PACK_COM_STR+6FJ
		INC	HL
		LD	A, (HL)
		CP	0DH
		RET	Z
		CP	22H
		JR	NZ, LOC_309A
		INC	HL
		LD	(TRD_5CD9), HL
		JR	LOC_3057
; END OF FUNCTION PACK_COM_STR
; =============== S U B	R O U T	I N E =======================================
FIND_KEYWORD:				; CODE XREF: PACK_COM_STR:LOC_3057P
		LD	HL, (TRD_5CD9)
		LD	DE, TBL_KEYWORD	; "SAVE"
		LD	C, 0
LOC_30B1:				; CODE XREF: FIND_KEYWORD+10J
					; FIND_KEYWORD+1DJ ...
		LD	A, (HL)
		AND	0DFH
		LD	B, A
		OR	A
		JR	NZ, LOC_30BB
		INC	HL
		JR	LOC_30B1
; ---------------------------------------------------------------------------
LOC_30BB:				; CODE XREF: FIND_KEYWORD+DJ
		LD	A, (DE)
		AND	80H
		JR	NZ, LOC_30C8
		LD	A, (DE)
		CP	B
		JR	NZ, LOC_30D9
		INC	HL
		INC	DE
		JR	LOC_30B1
; ---------------------------------------------------------------------------
LOC_30C8:				; CODE XREF: FIND_KEYWORD+15J
		LD	A, (DE)
		AND	7FH
		CP	B
		RET	Z
LOC_30CD:				; CODE XREF: FIND_KEYWORD+36J
		INC	C
		LD	HL, (TRD_5CD9)
		INC	DE
		LD	A, (DE)
		CP	0FFH
		JR	NZ, LOC_30B1
		OR	A
		RET
; ---------------------------------------------------------------------------
LOC_30D9:				; CODE XREF: FIND_KEYWORD+19J
					; FIND_KEYWORD+34J
		INC	DE
		LD	A, (DE)
		AND	80H
		JR	Z, LOC_30D9
		JR	LOC_30CD
; END OF FUNCTION FIND_KEYWORD
; =============== S U B	R O U T	I N E =======================================
CP_ADR_STR:				; CODE XREF: PACK_COM_STR+1CP
		LD	HL, (PPC)
		INC	HL
		INC	HL
		LD	A, H
		OR	L
		JR	Z, LOC_30F4
		XOR	A
		LD	(TRD_5CD6), A	; #FF-   
		DEC	HL
		DEC	HL
		RST	20H
; ---------------------------------------------------------------------------
		DW 196EH
; ---------------------------------------------------------------------------
		RET
; ---------------------------------------------------------------------------
LOC_30F4:				; CODE XREF: CP_ADR_STR+7J
		LD	A, 0FFH
		LD	(TRD_5CD6), A	; #FF-   
		LD	HL, (E_LINE)
		RET
; END OF FUNCTION CP_ADR_STR
; ---------------------------------------------------------------------------
TBL_KEYWORD:	.ASCII 'SAVE'           ; DATA XREF: FIND_KEYWORD+3O
		DB 80H
		.ASCII 'SAV'
		DB 0C5H
		.ASCII 'LOAD'
		DB 80H
		.ASCII 'LOA'
		DB 0C4H
		.ASCII 'RUN'
		DB 80H
		.ASCII 'RU'
		DB 0CEH
		.ASCII 'CAT'
		DB 80H
		.ASCII 'CA'
		DB 0D4H
		.ASCII 'ERASE'
		DB 80H
		.ASCII 'ERAS'
		DB 0C5H
		.ASCII 'NEW'
		DB 80H
		.ASCII 'NE'
		DB 0D7H
		.ASCII 'MOVE'
		DB 80H
		.ASCII 'MOV'
		DB 0C5H
		.ASCII 'MERGE'
		DB 80H
		.ASCII 'MERG'
		DB 0C5H
		.ASCII 'PEEK'
		DB 80H
		.ASCII 'PEE'
		DB 0CBH
		.ASCII 'POKE'
		DB 80H
		.ASCII 'POK'
		DB 0C5H
		.ASCII 'OPEN'
		DB 83H
		.ASCII 'CLOSE'
		DB 83H
		.ASCII 'CODE'
		DB 80H
		.ASCII 'COD'
		DB 0C5H
		.ASCII 'RND'
		DB 80H
		.ASCII 'RN'
		DB 0C4H
		.ASCII 'DATA'
		DB 80H
		.ASCII 'DAT'
		DB 0C1H
		.ASCII 'SCREEN'
		DB 4
		DB 84H
		.ASCII 'SCREEN'
		DB 84H
		.ASCII 'COPY'
		DB 80H
		.ASCII 'COP'
		DB 0D9H
		.ASCII 'FORMAT'
		DB 80H
		.ASCII 'FORMA'
		DB 0D4H
		.ASCII 'GOTO'
		DB 80H
		.ASCII 'GOT'
		DB 0CFH
		.ASCII 'LIST'
		DB 80H
		.ASCII 'LIS'
		DB 0D4H
		.ASCII 'LINE'
		DB 80H
		.ASCII 'LIN'
		DB 0C5H
		.ASCII 'VERIFY'
		DB 80H
		.ASCII 'VERIF'
		DB 0D9H
		DB 0FFH
		DB 0FFH
BYTES_COM:	DW 0F8F8H		; DATA XREF: PACK_COM_STR+2EO
		DW 0EFEFH
		DW 0F7F7H
		DW 0CFCFH
		DW 0D2D2H
		DW 0E6E6H
		DW 0D1D1H
		DW 0D5D5H
		DW 0BEBEH
		DW 0F4F4H
		DW 0D4D3H
		DW 0AFAFH
		DW 0A5A5H
		DW 0E4E4H
		DW 0AAAAH
		DW 0FFFFH
		DW 0D0D0H
		DW 0ECECH
		DW 0F0F0H
		DW 0CACAH
		DW 0D6D6H
		DB 0
; =============== S U B	R O U T	I N E =======================================
CP_VARSTRDOS:				; CODE XREF: CREATE_VARSTRDP
		LD	HL, (CHANS)
		OR	A
		LD	BC, TRD_5D25
		SBC	HL, BC
		RET
; END OF FUNCTION CP_VARSTRDOS
; ---------------------------------------------------------------------------
		DB [ 0A03H ], 0FFH
		DB 0FFH
; ---------------------------------------------------------------------------
		JR	LOC_3C06
; ---------------------------------------------------------------------------
		DB 0FFH
; ---------------------------------------------------------------------------
		JR	LOC_3C09
; ---------------------------------------------------------------------------
LOC_3C06:				; CODE XREF: ROM:3C01J
		JP	LOC_3D00
; ---------------------------------------------------------------------------
LOC_3C09:				; CODE XREF: ROM:3C04J
		JP	LOC_3D03
; ---------------------------------------------------------------------------
		DB [ 0EEH ], 0FFH
; ---------------------------------------------------------------------------
LOC_3CFA:				; CODE XREF: ROM:3D11J
		JP	CP_INTERFACE1
; ---------------------------------------------------------------------------
LOC_3CFD:				; CODE XREF: ROM:3D14J
		JP	CALL_3D13
; ---------------------------------------------------------------------------
LOC_3D00:				; CODE XREF: ROM:LOC_3C06J
		NOP
		JR	LOC_3D31
; ---------------------------------------------------------------------------
LOC_3D03:				; CODE XREF: ROM:LOC_3C09J
		NOP
		JR	LOC_3D1A
; ---------------------------------------------------------------------------
LOC_3D06:				; DATA XREF: CREATE_HEADCHAN+1FO
		NOP
		JP	LOC_25EF
; ---------------------------------------------------------------------------
LOC_3D0A:				; CODE XREF: ROM:LOC_3D0EJ
		JP	OUT_SYM2FILE
; ---------------------------------------------------------------------------
		NOP
LOC_3D0E:				; DATA XREF: CREATE_HEADCHAN+18O
					; ROM:2673O
		JR	LOC_3D0A
; ---------------------------------------------------------------------------
		NOP
		JR	LOC_3CFA
; ---------------------------------------------------------------------------
		NOP
		JR	LOC_3CFD
; ---------------------------------------------------------------------------
LOC_3D16:				; DATA XREF: MARK_SP+EO
		NOP
		JP	WORK4ERROR
; ---------------------------------------------------------------------------
LOC_3D1A:				; CODE XREF: ROM:3D04J
		CALL	CREATE_VARSTRD
		PUSH	HL
		JP	LOC_16C
; =============== S U B	R O U T	I N E =======================================
CREATE_VARSTRD:				; CODE XREF: ROM:LOC_3D1AP
					; ROM:LOC_3D31P
		CALL	CP_VARSTRDOS
		NOP
		NOP
		CALL	C, CREATE_VARS
		LD	HL, TRD_5CC2	;  #C9.   TR-DOS 	BASIC
		RET
; END OF FUNCTION CREATE_VARSTRD
; ---------------------------------------------------------------------------
		NOP
		NOP
LOC_3D2F:				; DATA XREF: SUB_8+55O
					; COPY_BAS2VARS+3O ...
		NOP
		RET
; ---------------------------------------------------------------------------
LOC_3D31:				; CODE XREF: ROM:0114J	ROM:3D01J
		CALL	CREATE_VARSTRD
		PUSH	HL
		JP	IN_COMMAND_CPU
; ---------------------------------------------------------------------------
LOC_3D38:				; DATA XREF: CREATE_VARS+5O
		XOR	A
		OUT	(0F7H),	A
		IN	A, (0F7H)
		CP	1EH
		JR	Z, LOC_3D44
		CP	1FH
		RET	NZ
LOC_3D44:				; CODE XREF: ROM:3D3FJ
		RST	8
; ---------------------------------------------------------------------------
		DB 31H
; ---------------------------------------------------------------------------
		LD	A, 1
		LD	(TRD_5CEF), A	;  1   INTERFACE1
		RET
; =============== S U B	R O U T	I N E =======================================
CREATE_VARS:				; CODE XREF: CREATE_VARSTRD+5P
		XOR	A
		OUT	(0FFH),	A
		IN	A, (0F6H)
		LD	HL, LOC_3D38
		LD	DE, MEMBOT
		LD	BC, 14H
		LDIR
		LD	HL, LOC_3D67
		PUSH	HL
		LD	HL, LOC_3D2F
		PUSH	HL
		JP	MEMBOT
; END OF FUNCTION CREATE_VARS
; ---------------------------------------------------------------------------
LOC_3D67:				; DATA XREF: CREATE_VARS+10O
		LD	HL, SET_VARS
		PUSH	HL
		LD	HL, LOC_3D2F
		PUSH	HL
		LD	HL, 1655H
		PUSH	HL
		LD	HL, UNK_5BFF
		PUSH	HL
		LD	(HL), 0C9H
		LD	HL,  P_RAMT+1
		LD	BC, 70H
		RET
; =============== S U B	R O U T	I N E =======================================
PRINT_0D:				; CODE XREF: CP_END_DIR-147P
					; CP_END_DIR-144P ...
		LD	A, 0DH
; END OF FUNCTION PRINT_0D
; =============== S U B	R O U T	I N E =======================================
PRINT_A_:				; CODE XREF: J_PRINT_A_J
					; GET_OVERWRITE_+9P ...
		PUSH	HL
		PUSH	BC
		PUSH	DE
		PUSH	AF
		CALL	CP_INTERFACE1
		POP	AF
		CALL	PRINT_SYM
		CALL	CP_INTERFACE1
		POP	DE
		POP	BC
		POP	HL
		RET
; END OF FUNCTION PRINT_A_
; =============== S U B	R O U T	I N E =======================================
PRINT_SYM:				; CODE XREF: PRINT_A_+8P
		RST	20H
; ---------------------------------------------------------------------------
		DW 10H
; END OF FUNCTION PRINT_SYM
; ---------------------------------------------------------------------------
		RET
; =============== S U B	R O U T	I N E =======================================
COM_00:					; CODE XREF: ROM:1EEBP
					; LOAD_SECTOR:LOC_3FADP
					; DATA XREF: ...
		LD	A, 0BH
; END OF FUNCTION COM_00
; =============== S U B	R O U T	I N E =======================================
COM2VG_WAIT:				; CODE XREF: ROM:274CP
					; CP_PRESENT_DSK+2P ...
		OUT	(1FH), A
LOC_3D9C:				; CODE XREF: COM2VG_WAIT+10J
		PUSH	HL
		RST	20H
; ---------------------------------------------------------------------------
		DW 1F54H
; ---------------------------------------------------------------------------
		JR	C, LOC_3DA5
		RST	20H
; ---------------------------------------------------------------------------
		DW 1B7BH
; ---------------------------------------------------------------------------
LOC_3DA5:				; CODE XREF: COM2VG_WAIT+6J
		POP	HL
		IN	A, (0FFH)
		AND	80H
		JR	Z, LOC_3D9C
		RET
; END OF FUNCTION COM2VG_WAIT
; =============== S U B	R O U T	I N E =======================================
CP_PRESENT_DSK:				; CODE XREF: ACTIV_DEF_DSK+17P
		LD	A, 0BH
		CALL	COM2VG_WAIT
		LD	DE, 0
		IN	A, (1FH)
		AND	2
		LD	B, A
LOC_3DBA:				; CODE XREF: CP_PRESENT_DSK+16J
		IN	A, (1FH)
		AND	2
		CP	B
		RET	NZ
		INC	DE
		LD	A, E
		OR	D
		JR	NZ, LOC_3DBA
		JP	LOC_3EE7
; END OF FUNCTION CP_PRESENT_DSK
; =============== S U B	R O U T	I N E =======================================
ACTIV_DEF_DSK:				; CODE XREF: GET_PARAMS-1564P
		LD	A, (TRD_5D19)
COM_01:					; CODE XREF: CP_END_DIR+9P ROM:05E9P ...
		LD	(TRD_5CF6), A
		LD	HL, TRD_5D16
		LD	C, A
		LD	A, 3CH
		OR	C
		OUT	(0FFH),	A
		LD	(HL), A
		CALL	GET_TIME_HEAD
		AND	80H
		JR	Z, LOC_3DFA
		CALL	CP_PRESENT_DSK
		CALL	CP_TIME_GOHEAD	;    
		CALL	GET_TYPE_DSK
		CP	0FFH
		JR	NZ, LOC_3DFA
		PUSH	HL
		CALL	CP_DSK_TRACK
		POP	HL
		CP	50H
		LD	A, 0
		JR	NZ, LOC_3DF9
		LD	A, 80H
LOC_3DF9:				; CODE XREF: ACTIV_DEF_DSK+2DJ
		LD	(HL), A
LOC_3DFA:				; CODE XREF: ACTIV_DEF_DSK+15J
					; ACTIV_DEF_DSK+22J
		CALL	WR_NUM_TRACK
; END OF FUNCTION ACTIV_DEF_DSK
; =============== S U B	R O U T	I N E =======================================
PAUSE725779TAKTS:			; CODE XREF: CP_DSK_TRACK+10P
					; SUB_2F3A+18P	...
		LD	A, 50H
; END OF FUNCTION PAUSE725779TAKTS
; =============== S U B	R O U T	I N E =======================================
PAUSE_C_A:				; CODE XREF: STOP_MOTOR+AP
					; PAUSE_C_A+6J	...
		LD	C, 0FFH
LOC_3E01:				; CODE XREF: PAUSE_C_A+3J
		DEC	C
		JR	NZ, LOC_3E01
		DEC	A
		JR	NZ, PAUSE_C_A
		RET
; END OF FUNCTION PAUSE_C_A
; =============== S U B	R O U T	I N E =======================================
GET_TIME_HEAD:				; CODE XREF: CP_DSK_TRACKP
					; ACTIV_DEF_DSK+10P ...
		LD	DE, TRD_5CFA
LOC_3E0B:				; CODE XREF: GET_TYPE_DSK+3J
		LD	HL, (TRD_5CF6)
		ADD	HL, DE
		LD	A, (HL)
		RET
; END OF FUNCTION GET_TIME_HEAD
; =============== S U B	R O U T	I N E =======================================
GET_TYPE_DSK:				; CODE XREF: COM_18:CP_TYPE_DSKP
					; COPY_ON1DSK+17P ...
		LD	DE, TRD_5CC8	; 	  A
		JR	LOC_3E0B
; END OF FUNCTION GET_TYPE_DSK
; =============== S U B	R O U T	I N E =======================================
;    
CP_TIME_GOHEAD:				; CODE XREF: ACTIV_DEF_DSK+1AP
		CALL	GET_TIME_HEAD
		LD	B, 8
		LD	C, 4
LOC_3E1D:				; CODE XREF: CP_TIME_GOHEAD+2CJ
		LD	(HL), B
		LD	A, 0BH
		CALL	COM2VG_WAIT
		LD	A, 20H
		LD	B, 0BH
		CALL	HEAD_POSITION
		LD	B, (HL)
		LD	A, 1
		CALL	HEAD_POSITION
		IN	A, (1FH)
		AND	4
		JR	NZ, LOC_3E3F
		XOR	A
		CALL	HEAD_POSITION
		IN	A, (1FH)
		AND	4
		RET	NZ
LOC_3E3F:				; CODE XREF: CP_TIME_GOHEAD+1EJ
		INC	B
		DEC	C
		RET	Z
		JR	LOC_3E1D
; END OF FUNCTION CP_TIME_GOHEAD
; =============== S U B	R O U T	I N E =======================================
HEAD_POSITION:				; CODE XREF: CP_DSK_TRACK+8P
					; CP_DSK_TRACK+DP ...
		OUT	(7FH), A
		LD	A, B
		OR	18H
		JP	COM2VG_WAIT
; END OF FUNCTION HEAD_POSITION
; =============== S U B	R O U T	I N E =======================================
POSITIONIREN:				; CODE XREF: COM_02+2DP
		OUT	(7FH), A
		PUSH	BC
		LD	B, A
		IN	A, (3FH)
		CP	B
		POP	BC
		PUSH	AF
		LD	A, B
		OR	18H
		CALL	COM2VG_WAIT
		POP	AF
		RET	Z
		PUSH	BC
		CALL	PAUSE725779TAKTS
		POP	BC
		RET
; END OF FUNCTION POSITIONIREN
; =============== S U B	R O U T	I N E =======================================
COM_02:					; CODE XREF: COM_05+46P
					; LOAD_SECTOR+89P ...
		LD	C, A
		CALL	COM_16
		CALL	GET_TYPE_DSK
		AND	2
		CALL	NZ, SET_SIDE_DSK
		PUSH	BC
		BIT	7, (HL)
		JR	Z, LOC_3E83
		BIT	0, (HL)
		JR	NZ, LOC_3E83
		IN	A, (3FH)
		CP	C
		JR	Z, LOC_3E82
		RLCA
		OUT	(3FH), A
		LD	A, C
		RLCA
LOC_3E82:				; CODE XREF: COM_02+18J
		LD	C, A
LOC_3E83:				; CODE XREF: COM_02+FJ	COM_02+13J
		CALL	GET_TIME_HEAD
		LD	B, A
		IN	A, (3FH)
		CP	C
		PUSH	BC
		CALL	NZ, PAUSE725779TAKTS
		POP	BC
		LD	A, C
		CALL	POSITIONIREN
		POP	BC
		LD	A, C
		OUT	(3FH), A
		LD	A, (TRD_5CCD)	; #80- 
		OR	A
		RET	Z
		XOR	A
		LD	(TRD_5CCD), A	; #80- 
; END OF FUNCTION COM_02
; =============== S U B	R O U T	I N E =======================================
PAUSE_3_C_A:				; CODE XREF: ROM:1EF1P	ROM:1F0BP ...
		LD	B, 3
LOC_3EA2:				; CODE XREF: PAUSE_3_C_A+7J
		LD	A, 0FFH
		CALL	PAUSE_C_A
		DJNZ	LOC_3EA2
		RET
; END OF FUNCTION PAUSE_3_C_A
; =============== S U B	R O U T	I N E =======================================
SET_SIDE_DSK:				; CODE XREF: COM_02+9P
		LD	A, C
		OR	A
		RRA
		LD	C, A
		RET	NC
		JP	COM_17
; END OF FUNCTION SET_SIDE_DSK
; =============== S U B	R O U T	I N E =======================================
GET_NUM_TRACK:				; CODE XREF: WR_NUM_TRACKP
; FUNCTION CHUNK AT 01D3 SIZE 0000002E BYTES
; FUNCTION CHUNK AT 1C4A SIZE 00000006 BYTES
; FUNCTION CHUNK AT 271B SIZE 00000008 BYTES
		CALL	COM_16
LOC_3EB5:				; CODE XREF: ROM:1F0EP
		IN	A, (1FH)
		AND	80H
		LD	(TRD_5CCD), A	; #80- 
		IN	A, (3FH)
		LD	H, A
		CALL	HEAD_POSITION
		LD	C, 7FH
		LD	D, 1
		DI
		LD	A, 0C0H
		OUT	(1FH), A
		PUSH	BC
		LD	B, 3
LOC_3ECE:				; CODE XREF: GET_NUM_TRACK+25J
					; GET_NUM_TRACK+27J
		IN	A, (0FFH)
		AND	0C0H
		JR	NZ, LOC_3EF2
		INC	DE
		LD	A, E
		OR	D
		JR	NZ, LOC_3ECE
		DJNZ	LOC_3ECE
		POP	BC
		EI
		LD	A, 0D0H
		OUT	(1FH), A
		LD	A, (TRD_5CD1)
		CP	0FFH
		RET	Z
LOC_3EE7:				; CODE XREF: CP_PRESENT_DSK+18J
					; LOAD_SECTOR+44J
		CALL	SET_TAPELDERR
		LD	A, 0FFH
		LD	(TRD_5D17), A	;  ,  #AA
		JP	LOC_271B
; ---------------------------------------------------------------------------
LOC_3EF2:				; CODE XREF: GET_NUM_TRACK+20J
		POP	BC
		IN	H, (C)
LOC_3EF5:				; CODE XREF: GET_NUM_TRACK+47J
					; GET_NUM_TRACK+4EJ
		IN	A, (0FFH)
		AND	0C0H
		JR	Z, LOC_3EF5
		EI
		RET	M
		DI
		IN	A, (7FH)
		JR	LOC_3EF5
; END OF FUNCTION GET_NUM_TRACK
; =============== S U B	R O U T	I N E =======================================
COM_03:					; CODE XREF: COM_05+40P
					; DATA XREF: ROM:2896O
		LD	(TRD_5CFF), A
		RET
; END OF FUNCTION COM_03
; =============== S U B	R O U T	I N E =======================================
COM_04:					; CODE XREF: COM_05+3AP
					; DATA XREF: ROM:2899O
		LD	(TRD_5D00), HL
		RET
; END OF FUNCTION COM_04
; =============== S U B	R O U T	I N E =======================================
SAVE_SECTOR:				; CODE XREF: COM_05+52P
		LD	A, 0A0H
		JR	LOC_3F10
; END OF FUNCTION SAVE_SECTOR
; =============== S U B	R O U T	I N E =======================================
LOAD_SECTOR:				; CODE XREF: COM_05+4EP
		LD	A, 80H
LOC_3F10:				; CODE XREF: SAVE_SECTOR+2J
		LD	(TRD_5CFE), A
LOC_3F13:				; CODE XREF: LOAD_SECTOR+8FJ
		LD	D, 0AH
LOC_3F15:				; CODE XREF: LOAD_SECTOR+38J
					; LOAD_SECTOR+A9J
		PUSH	DE
		DI
		LD	A, (TRD_5CFF)
		INC	A
		OUT	(5FH), A
		LD	HL, (TRD_5D00)
		LD	C, 7FH
		LD	A, (TRD_5CFE)
		OUT	(1FH), A
		CP	0A0H
		PUSH	AF
		CALL	Z, WRITE_SEC
		POP	AF
		CALL	NZ, READ_SEC
		POP	DE
		EI
		IN	A, (1FH)
		LD	B, A
		AND	7FH
		RET	Z
LOC_3F39:				; CODE XREF: FORMAT_TREK+7DJ
		LD	HL, READ_ONLY	; READ ONLY
		AND	40H
		JR	NZ, LOC_3F4B
		LD	A, B
		AND	4
		JR	Z, LOC_3FA0
		DEC	D
		JR	NZ, LOC_3F15
LOC_3F48:				; CODE XREF: LOAD_SECTOR+93J
		LD	HL, TXT_DISCERROR_ ; DISC ERROR
LOC_3F4B:				; CODE XREF: LOAD_SECTOR+30J
		LD	A, 0D0H
		OUT	(1FH), A
		LD	A, B
		AND	1
		JP	NZ, LOC_3EE7
		IN	A, (3FH)
		OR	A
		JR	NZ, LOC_3F5F
		IN	A, (5FH)
		CP	0AH
		RET	Z
LOC_3F5F:				; CODE XREF: LOAD_SECTOR+4AJ
		PUSH	HL
		CALL	CLEAR_SCREEN
		POP	HL
		RST	18H
		LD	HL, TXT_TRK_	; TRACK
		RST	18H
		IN	A, (3FH)
		CALL	PRINT_CHISLO_A_
		LD	HL, TXT_SEC_	; SECTOR
		RST	18H
		IN	A, (5FH)
		CALL	PRINT_CHISLO_A_
		LD	HL, TXT_RIA_
		RST	18H
LOC_3F7B:				; CODE XREF: LOAD_SECTOR+79J
		CALL	GET_KEYS
		CP	49H ; 'I'       ; IGNORE-RET   #1E8E
		RET	Z
		CP	52H ; 'R'       ; RETRY
		JR	Z, PRESS_RETRY
		CP	41H ; 'A'       ; ABORT
		JR	NZ, LOC_3F7B
		CALL	SET_TAPELDERR	; PRESS	ABORT
		LD	A, 7
		LD	(TRD_5D0F), A	; 	 TR-DOS
		JP	END_COMAND
; ---------------------------------------------------------------------------
PRESS_RETRY:				; CODE XREF: LOAD_SECTOR+75J
		LD	A, (TRD_5CF5)
		CALL	COM_02
		CALL	PAUSE_3_C_A
		JP	LOC_3F13
; ---------------------------------------------------------------------------
LOC_3FA0:				; CODE XREF: LOAD_SECTOR+35J
		DEC	D
		JP	Z, LOC_3F48	; DISC ERROR
		PUSH	DE
		CALL	GET_TIME_HEAD
		AND	2
		JR	NZ, LOC_3FAD
		INC	(HL)
LOC_3FAD:				; CODE XREF: LOAD_SECTOR+9CJ
		CALL	COM_00
		LD	A, (TRD_5CF5)
		CALL	COM_02
		POP	DE
		JP	LOC_3F15
; END OF FUNCTION LOAD_SECTOR
; =============== S U B	R O U T	I N E =======================================
WRITE_SEC:				; CODE XREF: LOAD_SECTOR+1CP
		LD	B, 4
LOC_3FBC:				; CODE XREF: WRITE_SEC+BJ WRITE_SEC+DJ
		IN	A, (0FFH)
		AND	0C0H
		JR	NZ, LOC_3FD1
		INC	DE
		LD	A, E
		OR	D
		JR	NZ, LOC_3FBC
		DJNZ	LOC_3FBC
		RET
; END OF FUNCTION WRITE_SEC
; =============== S U B	R O U T	I N E =======================================
SUB_3FCA:				; CODE XREF: SUB_2D73+FP SUB_3FCA+4J ...
		IN	A, (0FFH)
		AND	0C0H
		JR	Z, SUB_3FCA
		RET	M
LOC_3FD1:				; CODE XREF: WRITE_SEC+6J
		OUTI
		JR	SUB_3FCA
; END OF FUNCTION SUB_3FCA
; =============== S U B	R O U T	I N E =======================================
READ_SEC:				; CODE XREF: LOAD_SECTOR+20P
		LD	B, 4
LOC_3FD7:				; CODE XREF: READ_SEC+BJ READ_SEC+DJ
		IN	A, (0FFH)
		AND	0C0H
		JR	NZ, LOC_3FEC
		INC	DE
		LD	A, E
		OR	D
		JR	NZ, LOC_3FD7
		DJNZ	LOC_3FD7
		RET
; END OF FUNCTION READ_SEC
; =============== S U B	R O U T	I N E =======================================
RD_DATAPORT:				; CODE XREF: FORMAT_TREK+99P
					; SUB_2F1B+FP ...
		IN	A, (0FFH)
		AND	0C0H
		JR	Z, RD_DATAPORT
		RET	M
LOC_3FEC:				; CODE XREF: READ_SEC+6J
		INI
		JR	RD_DATAPORT
; END OF FUNCTION RD_DATAPORT
; ---------------------------------------------------------------------------
		DB [ 10H ], 0FFH
; END OF 'ROM'
; ===========================================================================
; SEGMENT TYPE:	REGULAR
		SEGMENT	BASIC_VARS
		ORG 5B00H
